<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "../Red_Hat_CloudForms_SOAP_API.ent">
%BOOK_ENTITIES;
]>
<section id="Windows_PowerShell_GetVMProvisionRequest" remap="TID_14690">
	<title>Windows PowerShell: GetVMProvisionRequest</title>
	<programlisting>
<![CDATA[
[System.Net.ServicePointManager]::ServerCertificateValidationCallback = { $true }

$ip, $userid, $password = "https://evm_appl_address", "admin", "smartvm"
$cred = New-Object System.Management.Automation.PsCredential $userid, (convertto-securestring $password -asplaintext -force)

Write-Host "Connecting to EVM integrate web-services at $($ip)/vmdbws/wsdl"
$miqvmdb = New-WebServiceProxy -uri "$($ip)/vmdbws/wsdl" -Credential $cred -ErrorAction Stop -Namespace VmdbWs
Write-Host "Successfully connected to EVM integrate web-services version: $([string]::join(".", $miqvmdb.Version()))"

$param1 = "name=Test Template"
$param2 = "vm_name=ws_test"
$param3 = "owner_email=test@redhat.com|owner_last_name=admin|owner_first_name=admin"
$param4 = "network_location=Internal|cc=001"
$prov_options = New-Object VmdbWs.VmdbwsSupportProvisionOptions

$result = $miqvmdb.VmProvisionRequest("1.1", $param1, $param2, $param3, $param4, $prov_options)
Write-Host "VM Provision request created."
$result | ft

do {
	Sleep(10)
	$result = $miqvmdb.GetVmProvisionRequest($result.id)
	Write-Host "Status: $($result.status)  ReqState: $($result.request_state)  ApprovalState: $($result.approval_state)  LastMsg: $($result.message)"
} while ($result.request_state -ne "finished" -and $result.status -ne "Error")

Write-Host "Provision Request VM list"
$result.vms | ft

$vms = $miqvmdb.GetVmsByList($result.vms[0])
Write-Host "VM Properties"
$vms | fl

Write-Host "done"
]]>
</programlisting>
</section>