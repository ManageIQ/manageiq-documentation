<?xml version='1.0' encoding='utf-8' ?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "Security_Guide.ent">
%BOOK_ENTITIES;
]>
<chapter id="chap-Red_Hat_CloudForms-Security_Guide-Test_Chapter" lang="en-US">
	<title>Generating SSL Certificates</title>
  <para>
    It is important to properly secure SSL communication of your appliances. The appliance image ships with a default SSL certificate and it is recommended to change this certificate.
  </para>
  <para>
    The first step is to create a Certificate Signing Request using the <command>openssl</command> command:
  </para>
  <screen>
[root@ ~]# openssl req -new -newkey rsa:2048 -out appliance.csr -keyout appliance.key
  </screen>
  <para>
    This command generates a 2048-bit RSA private key and asks for a passphrase for the key.
  </para>
  <screen>
Generating a 2048 bit RSA private key
..................+++
...........................+++
writing new private key to 'appliance.key'
Enter PEM pass phrase: **********
Verifying - Enter PEM pass phrase: **********
  </screen>
  <para>
    The command then provides a questionaire requesting certain details for the key. Fill out this questionaire. For example:
  </para>
  <screen>
Country Name (2 letter code) [XX]:AU
State or Province Name (full name) []:Queensland
Locality Name (eg, city) [Default City]:Brisbane
Organization Name (eg, company) [Default Company Ltd]:Red Hat
Organizational Unit Name (eg, section) []:Customer Content Services
Common Name (eg, your name or your server's hostname) []:appliance.example.com
Email Address []:dmacpher@redhat.com

Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []:
An optional company name []:
  </screen>
  <para>
    This produces two files:
  </para>
  <itemizedlist>
    <listitem>
      <para>
        <filename>appliance.key</filename> - The private key
      </para>
    </listitem>
    <listitem>
      <para>
        <filename>appliance.csr</filename> - The Certificate Signing Request (CSR)
      </para>
    </listitem>
  </itemizedlist>
  <para>
    At this stage, you would send the CSR to a trusted Certificate Authority (CA) and in return they would send you a signed SSL certificate.
  </para>
  <para>
    As an alternative, you can create a self-signed certificate using the following <command>openssl</command> commands:
  </para>
  <screen>
[root@ ~]# openssl rsa -in appliance.key -out server.cer.key
[root@ ~]# openssl x509 -in appliance.csr -out server.cer -req -signkey server.cer.key -days 3650
  </screen>
  <para>
    This produces two files:
  </para>
  <itemizedlist>
    <listitem>
      <para>
        <filename>server.cer.key</filename> - The private key for your signed certificate
      </para>
    </listitem>
    <listitem>
      <para>
        <filename>server.cer</filename> - The self-signed certificate
      </para>
    </listitem>
  </itemizedlist>
  <para>
    Despite whether you used a trusted CA or self-signed the certificate, you should now have your SSL certificates for your appliance.
  </para>
  <para>
    Copy the SSL certificate files to the certificate directory on the appliance:
  </para>
  <screen>
[root@ ~]# cp ~/server.cer.key /var/www/miq/vmdb/certs/server.cer.key
[root@ ~]# cp ~/server.cer /var/www/miq/vmdb/certs/server.cer
  </screen>
  <para>
    After the SSL certificate files have copied, restart the appliance:
  </para>
  <screen>
[root@ ~]# service evmserverd restart
  </screen>
  <para>
    The appliance now uses the new SSL certificate.
  </para>
  <important>
    <para>
      Updates from the Red Hat Content Delivery Network might overwrite these certificate files. Make sure to copy the new SSL certificate files to the certificate directory after performing an update to your appliance.
    </para>
  </important>
</chapter>

