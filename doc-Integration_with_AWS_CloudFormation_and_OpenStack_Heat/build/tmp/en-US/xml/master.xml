<?xml version='1.0' encoding='utf-8' ?>
<!DOCTYPE book [
<!ENTITY % BOOK_ENTITIES SYSTEM "master.ent">
%BOOK_ENTITIES;
<!ENTITY % sgml.features "IGNORE">
<!ENTITY % xml.features "INCLUDE">
<!ENTITY % DOCBOOK_ENTS PUBLIC "-//OASIS//ENTITIES DocBook Character Entities V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/dbcentx.mod">
%DOCBOOK_ENTS;
]>
<book version="5.0" xml:lang="en-US" xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">
	<?asciidoc-toc maxdepth="3"?>
	<info>
		<title>Integration with AWS CloudFormation and OpenStack Heat</title>
		<subtitle>How to Install and Configure the Amazon CloudFormation and OpenStack Heat in Red Hat CloudForms environment</subtitle>
		 <date>2015-10-15</date>
		<xi:include href="Author_Group.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
		<authorinitials>CDT</authorinitials><productname>Red Hat CloudForms</productname>
		<productnumber>4.0</productnumber>
		<abstract>
			<para>
				This guide provides instructions on the implementation of Amazon CloudFormation and OpenStack Heat in Red Hat CloudForms, and discusses the various areas of integration. Information and procedures in this book are relevant to CloudForms Management Engine administrators.
			</para>
		</abstract>
	</info>
	<part xml:id="Introduction">
		<title>Introduction</title>
		<partintro>
			<simpara>
				AWS CloudFormation enables users to orchestrate the instantiation of multi-instance services via templates. You can use CloudFormation’s sample templates or create your own templates to describe the AWS resources, and any associated dependencies or runtime parameters, required to run your applications. Similarly, you can configure and monitor cloud resources in Red Hat Enterprise Linux OpenStack Platform using the Orchestration service. The Orchestration service provides a framework through which you can define an instance’s resource parameters (for example, floating IPs, volumes, or security groups) and properties (for example, key pairs, image to be used, or flavor) using OpenStack Heat templates.
			</simpara>
			<simpara>
				Instances deployed using templates through the orchestration service are known as stacks. A user can author the stack templates, or can upload them from other sources. Red Hat CloudForms has enabled CloudFormation and Heat integration, and now allows you to launch, delete, and update stacks using the dashboard.
			</simpara>
		</partintro>
		<chapter xml:id="Integration_with_AWS_CloudFormation_and_OpenStack_Heat">
			<title>Integration with AWS CloudFormation and OpenStack Heat</title>
			<simpara>
				Red Hat CloudForms' integration with AWS CloudFormation and OpenStack Heat provides an ability to:
			</simpara>
			<itemizedlist>
				<listitem>
					<simpara>
						Inventory all AWS CloudFormation and OpenStack Heat stacks and elements into CFME’s VMDB.
					</simpara>
				</listitem>
				<listitem>
					<simpara>
						Model the relationships of instances to their stacks, inclusive of the UI. Example, selecting an instance within a region that is within a stack, the UI shows this on the standard instance view.
					</simpara>
				</listitem>
				<listitem>
					<simpara>
						Model the stack and its elements in the UI.
					</simpara>
				</listitem>
			</itemizedlist>
			<note>
				<simpara>
					When importing a template into Red Hat CloudForms, the selected elements are converted according to their type. For example, lists convert to list boxes, and single items convert to text boxes.
				</simpara>
			</note>
		</chapter>
		<chapter xml:id="Cloud_Orchestration">
			<title>Cloud Orchestration</title>
			<simpara>
				Cloud Orchestration is a service that allows you to create, update and manage cloud resources and their software components as a single unit and then deploy them in an automated, repeatable way through a template. Templates use a human-readable syntax and can be defined in text files (thereby allowing users to check them into version control). Templates allow you to easily deploy and re-configure infrastructure for applications within your cloud. A user can author the stack templates, or can upload them from other sources.
			</simpara>
			<section xml:id="adding_a_new_orchestration_template">
				<title>Adding a New Orchestration Template</title>
				<simpara>
					Use this procedure to add new orchestration templates using the dashboard UI.
				</simpara>
				<orderedlist numeration="arabic">
					<listitem>
						<simpara>
							Navigate to Services → Catalog and select Orchestration Templates in the accordion menu.
						</simpara>
					</listitem>
					<listitem>
						<simpara>
							Click 
							<inlinemediaobject>
								<imageobject>
									<imagedata fileref="images/1847.png" format="PNG" />
								</imageobject>
								<textobject>
									<phrase>Configuration</phrase>
								</textobject>
							</inlinemediaobject>
							 Configuration, then click 
							<inlinemediaobject>
								<imageobject>
									<imagedata fileref="images/1848.png" format="PNG" />
								</imageobject>
								<textobject>
									<phrase>Green_Plus_Sign</phrase>
								</textobject>
							</inlinemediaobject>
							 Create a new Orchestration Template. The Adding a new Orchestration Template window is displayed. 
							<inlinemediaobject>
								<imageobject>
									<imagedata fileref="images/7148.png" format="PNG" />
								</imageobject>
								<textobject>
									<phrase>Adding_a_new_Orchestration_Template</phrase>
								</textobject>
							</inlinemediaobject>
						</simpara>
					</listitem>
					<listitem>
						<simpara>
							In Name, enter a name for the new template.
						</simpara>
					</listitem>
					<listitem>
						<simpara>
							In Description, enter a description for the template. Select Amazon CloudFormation or OpenStack Heat from the Template Type list. The default is Amazon CloudFormation.
						</simpara>
					</listitem>
					<listitem>
						<simpara>
							You can select the Draft box to create a draft template.
						</simpara>
					</listitem>
					<listitem>
						<simpara>
							Define your new template following the specification structure of the selected Template Type.
						</simpara>
					</listitem>
					<listitem>
						<simpara>
							Click Add.
						</simpara>
					</listitem>
				</orderedlist>
			</section>
			<section xml:id="editing_orchestration_templates">
				<title>Editing Orchestration Templates</title>
				<simpara>
					Use this procedure to edit orchestration templates using the dashboard UI.
				</simpara>
				<orderedlist numeration="arabic">
					<listitem>
						<simpara>
							Navigate to Services → Catalog and select Orchestration Templates in the accordion menu.
						</simpara>
					</listitem>
					<listitem>
						<simpara>
							Select the orchestration template you want to edit from the All Orchestration Templates list.
						</simpara>
					</listitem>
					<listitem>
						<simpara>
							Click 
							<inlinemediaobject>
								<imageobject>
									<imagedata fileref="images/1847.png" format="PNG" />
								</imageobject>
								<textobject>
									<phrase>Configuration</phrase>
								</textobject>
							</inlinemediaobject>
							 Configuration, then click 
							<inlinemediaobject>
								<imageobject>
									<imagedata fileref="images/1851.png" format="PNG" />
								</imageobject>
								<textobject>
									<phrase>Edit_Sign</phrase>
								</textobject>
							</inlinemediaobject>
							 Edit selected Orchestration Template. The Edit selected Orchestration Template window is displayed.
						</simpara>
					</listitem>
					<listitem>
						<simpara>
							You can only edit the Name and Description of a read-only template as there can be stacks associated with the selected template. For templates that are not read-only, you can edit all content in the template as required.
						</simpara>
					</listitem>
					<listitem>
						<simpara>
							Click Save.
						</simpara>
					</listitem>
				</orderedlist>
			</section>
			<section xml:id="copying_orchestration_templates">
				<title>Copying Orchestration Templates</title>
				<simpara>
					Use this procedure to copy an orchestration template to create a new template.
				</simpara>
				<orderedlist numeration="arabic">
					<listitem>
						<simpara>
							Navigate to Services → Catalog and select Orchestration Templates in the accordion menu.
						</simpara>
					</listitem>
					<listitem>
						<simpara>
							Click 
							<inlinemediaobject>
								<imageobject>
									<imagedata fileref="images/1847.png" format="PNG" />
								</imageobject>
								<textobject>
									<phrase>Configuration</phrase>
								</textobject>
							</inlinemediaobject>
							 Configuration, then click 
							<inlinemediaobject>
								<imageobject>
									<imagedata fileref="images/1859.png" format="PNG" />
								</imageobject>
								<textobject>
									<phrase>Copy</phrase>
								</textobject>
							</inlinemediaobject>
							 Copy selected Orchestration Template. The Copy selected Orchestration Template window is displayed.
						</simpara>
					</listitem>
					<listitem>
						<simpara>
							You can copy the selected template to create a new template, and include the changes as required. Note that in order to create the new template its content must be unique.
						</simpara>
					</listitem>
					<listitem>
						<simpara>
							Click Save.
						</simpara>
					</listitem>
				</orderedlist>
			</section>
			<section xml:id="deleting_orchestration_templates">
				<title>Deleting Orchestration Templates</title>
				<simpara>
					Use this procedure to delete orchestration templates using the dashboard UI.
				</simpara>
				<orderedlist numeration="arabic">
					<listitem>
						<simpara>
							Navigate to Services → Catalog and select Orchestration Templates in the accordion menu.
						</simpara>
					</listitem>
					<listitem>
						<simpara>
							Select the orchestration template you want to delete from the All Orchestration Templates list.
						</simpara>
					</listitem>
					<listitem>
						<simpara>
							Click 
							<inlinemediaobject>
								<imageobject>
									<imagedata fileref="images/1848.png" format="PNG" />
								</imageobject>
								<textobject>
									<phrase>Configuration</phrase>
								</textobject>
							</inlinemediaobject>
							 Configuration, then click 
							<inlinemediaobject>
								<imageobject>
									<imagedata fileref="images/1861.png" format="PNG" />
								</imageobject>
								<textobject>
									<phrase>Delete</phrase>
								</textobject>
							</inlinemediaobject>
							 Remove selected Orchestration Template.
						</simpara>
					</listitem>
					<listitem>
						<simpara>
							A warning window to confirm the permanent removal of the selected item from the VMDB appears.
						</simpara>
					</listitem>
					<listitem>
						<simpara>
							Click OK.
						</simpara>
					</listitem>
				</orderedlist>
				<simpara>
					This instantly deletes the selected orchestration template. Note that only non read-only templates can be removed.
				</simpara>
			</section>
		</chapter>
		<chapter xml:id="CloudFormation_Provisioning_via_Services">
			<title>CloudFormation Provisioning via Services</title>
			<simpara>
				After creating your template, you can add it as a catalog item to the Service Catalog. Stacks can then be created from templates and launched from the Service Catalog.
			</simpara>
		</chapter>
		<chapter xml:id="adding_a_new_catalog">
			<title>Adding a New Catalog</title>
			<simpara>
				Use this procedure to add a new catalog using the dashboard UI.
			</simpara>
			<simpara>
				<inlinemediaobject>
					<imageobject>
						<imagedata fileref="images/7149.png" format="PNG" />
					</imageobject>
					<textobject>
						<phrase>Adding_a_New_Catalog</phrase>
					</textobject>
				</inlinemediaobject>
			</simpara>
			<orderedlist numeration="arabic">
				<listitem>
					<simpara>
						Navigate to Services → Catalog and select Catalogs in the accordion menu. .Click 
						<inlinemediaobject>
							<imageobject>
								<imagedata fileref="images/1847.png" format="PNG" />
							</imageobject>
							<textobject>
								<phrase>Configuration</phrase>
							</textobject>
						</inlinemediaobject>
						 Configuration, then click 
						<inlinemediaobject>
							<imageobject>
								<imagedata fileref="images/1848.png" format="PNG" />
							</imageobject>
							<textobject>
								<phrase>Green_Plus_Sign</phrase>
							</textobject>
						</inlinemediaobject>
						 Add a New Catalog. The Adding a new Catalog window is displayed.
					</simpara>
				</listitem>
				<listitem>
					<simpara>
						In Basic Info, add Name and Description for the new catalog.
					</simpara>
				</listitem>
				<listitem>
					<simpara>
						You can assign catalog items in Assign Catalog Item.
					</simpara>
				</listitem>
				<listitem>
					<simpara>
						Click Add.
					</simpara>
				</listitem>
			</orderedlist>
		</chapter>
		<chapter xml:id="adding_a_new_service_dialog">
			<title>Adding a New Service Dialog</title>
			<simpara>
				Use this procedure to add a new service dialog based on the input parameters defined in the orchestration template.
			</simpara>
			<orderedlist numeration="arabic">
				<listitem>
					<simpara>
						Navigate to Services → Catalog and click Orchestration Templates in the accordion menu.
					</simpara>
				</listitem>
				<listitem>
					<simpara>
						From All Orchestration Templates, select the orchestration template you want to create a service dialog from.
					</simpara>
				</listitem>
				<listitem>
					<simpara>
						Click 
						<inlinemediaobject>
							<imageobject>
								<imagedata fileref="images/1847.png" format="PNG" />
							</imageobject>
							<textobject>
								<phrase>Configuration</phrase>
							</textobject>
						</inlinemediaobject>
						 Configuration, then click 
						<inlinemediaobject>
							<imageobject>
								<imagedata fileref="images/1848.png" format="PNG" />
							</imageobject>
							<textobject>
								<phrase>Green_Plus_Sign</phrase>
							</textobject>
						</inlinemediaobject>
						 Create Service Dialog from Orchestration Template. The Adding a new Service Dialog from Orchestration Template window is displayed. 
						<inlinemediaobject>
							<imageobject>
								<imagedata fileref="images/7156.png" format="PNG" />
							</imageobject>
							<textobject>
								<phrase>Adding_a_new_Service_Dialog_from_Orchestration_Template</phrase>
							</textobject>
						</inlinemediaobject>
					</simpara>
				</listitem>
				<listitem>
					<simpara>
						In Service Dialog Information, add a Service Dialog Name.
					</simpara>
				</listitem>
				<listitem>
					<simpara>
						Click Save.
					</simpara>
				</listitem>
			</orderedlist>
		</chapter>
		<chapter xml:id="adding_a_new_catalog_item">
			<title>Adding a New Catalog Item</title>
			<simpara>
				Use this procedure to add a new service catalog item using the dashboard UI.
			</simpara>
			<orderedlist numeration="arabic">
				<listitem>
					<simpara>
						Navigate to Services → Catalog and select Catalog Items in the accordion menu.
					</simpara>
				</listitem>
				<listitem>
					<simpara>
						Click images:1847.png[Configuration] Configuration, then click 
						<inlinemediaobject>
							<imageobject>
								<imagedata fileref="images/1848.png" format="PNG" />
							</imageobject>
							<textobject>
								<phrase>Green_Plus_Sign</phrase>
							</textobject>
						</inlinemediaobject>
						 Add a New Catalog Item. The Adding a new Service Catalog Item window is displayed. 
						<inlinemediaobject>
							<imageobject>
								<imagedata fileref="images/7146.png" format="PNG" />
							</imageobject>
							<textobject>
								<phrase>Adding_a_new_Service_Catalog_Item</phrase>
							</textobject>
						</inlinemediaobject>
					</simpara>
				</listitem>
				<listitem>
					<simpara>
						Choose Orchestration from Catalog Item Type.
					</simpara>
				</listitem>
				<listitem>
					<simpara>
						In Basic Info, add Name and Description. Select the Display in Catalog box. 
						<inlinemediaobject>
							<imageobject>
								<imagedata fileref="images/7147.png" format="PNG" />
							</imageobject>
							<textobject>
								<phrase>Basic_Info</phrase>
							</textobject>
						</inlinemediaobject>
					</simpara>
				</listitem>
				<listitem>
					<simpara>
						Select the Catalog, Dialog, and Orchestration Template from their respective list.
					</simpara>
				</listitem>
				<listitem>
					<simpara>
						Select Provisioning Entry Point. The default is
					</simpara>
				</listitem>
			</orderedlist>
			
<screen>/Cloud/Orchestration/Provisioning/StateMachines/Provision/default.</screen>
			<orderedlist numeration="arabic">
				<listitem>
					<simpara>
						Click Add.
					</simpara>
				</listitem>
			</orderedlist>
		</chapter>
		<chapter xml:id="ordering_service">
			<title>Ordering Service</title>
			<simpara>
				Use this procedure to order a service catalog item using the dashboard UI.
			</simpara>
			<orderedlist numeration="arabic">
				<listitem>
					<simpara>
						Navigate to Services → Catalog and select Service Catalogs in the accordion menu. From All Services catalogs, select the catalog item that you want to order. The Service window with the name and description of the service to be ordered is displayed. 
						<inlinemediaobject>
							<imageobject>
								<imagedata fileref="images/7172.png" format="PNG" />
							</imageobject>
							<textobject>
								<phrase>Service_Catalog</phrase>
							</textobject>
						</inlinemediaobject>
					</simpara>
				</listitem>
				<listitem>
					<simpara>
						Click Order. The Order Service window with Options and Parameter is displayed. 
						<inlinemediaobject>
							<imageobject>
								<imagedata fileref="images/7173.png" format="PNG" />
							</imageobject>
							<textobject>
								<phrase>Order_Service</phrase>
							</textobject>
						</inlinemediaobject>
					</simpara>
				</listitem>
				<listitem>
					<simpara>
						Enter stack name in Stack Name.
					</simpara>
				</listitem>
				<listitem>
					<simpara>
						The On Failure value is Rollback by default.
					</simpara>
				</listitem>
				<listitem>
					<simpara>
						Timeout is optional. You can type the number of seconds to timeout the provision at the provider side. Note that the number of seconds get converted (rounded) to minutes when ordering the provision through OpenStack. For example, 100 seconds rounds to two minutes.
					</simpara>
				</listitem>
				<listitem>
					<simpara>
						You can use the default parameter values from the template, or enter new values as appropriate. Note that the Parameters vary per dialog; therefore, the parameters shown in the above screenshot may or may not exist depending on the dialog.
					</simpara>
				</listitem>
				<listitem>
					<simpara>
						Click Submit.
					</simpara>
				</listitem>
			</orderedlist>
			<simpara>
				The order request is submitted. After a request has been approved, the various stages of fulfillment are executed. You can see the progress status of the provisioning process in Services → Requests.
			</simpara>
		</chapter>
		<chapter xml:id="orchestration_stacks">
			<title>Orchestration Stacks</title>
			<simpara>
				After ordering a service, you can see the progress state of the provisioning process in Services → Requests.
			</simpara>
			<orderedlist numeration="arabic">
				<listitem>
					<simpara>
						Initially, the Request State shows Pending with its Approval State as Pending Approval. 
						<inlinemediaobject>
							<imageobject>
								<imagedata fileref="images/7177.png" format="PNG" />
							</imageobject>
							<textobject>
								<phrase>Requests</phrase>
							</textobject>
						</inlinemediaobject>
					</simpara>
				</listitem>
				<listitem>
					<simpara>
						After the request is Approved, the various stages of fulfillment are executed, and reflect accordingly under Request State. 
						<inlinemediaobject>
							<imageobject>
								<imagedata fileref="images/7178.png" format="PNG" />
							</imageobject>
							<textobject>
								<phrase>Request_State</phrase>
							</textobject>
						</inlinemediaobject>
						<inlinemediaobject>
							<imageobject>
								<imagedata fileref="images/7179.png" format="PNG" />
							</imageobject>
							<textobject>
								<phrase>Request_State</phrase>
							</textobject>
						</inlinemediaobject>
					</simpara>
				</listitem>
				<listitem>
					<simpara>
						After the Request State is Finished, you can see the stack entry created in Clouds → Stacks. In the screen capture below, you can see the heat-stack we created from the catalog item ordered from the Service Catalog as shown in the previous section. 
						<inlinemediaobject>
							<imageobject>
								<imagedata fileref="images/7180.png" format="PNG" />
							</imageobject>
							<textobject>
								<phrase>Catalog_Item_State</phrase>
							</textobject>
						</inlinemediaobject>
					</simpara>
				</listitem>
				<listitem>
					<simpara>
						You can click on the stack to see a summary of its properties and relationships, and the instance(s) included in the stack. You can click on the instance(s) to see all instance details. 
						<inlinemediaobject>
							<imageobject>
								<imagedata fileref="images/7181.png" format="PNG" />
							</imageobject>
							<textobject>
								<phrase>Stack_Summary</phrase>
							</textobject>
						</inlinemediaobject>
					</simpara>
				</listitem>
			</orderedlist>
			<simpara>
				You have now deployed instances and its associated collection of resources (called a stack) using an orchestration template.
			</simpara>
		</chapter>
	</part>
</book>

