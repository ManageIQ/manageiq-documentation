<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" class="chrometwo"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Bare Metal Provisioning Guide</title><link rel="stylesheet" type="text/css" href="Common_Content/css/default.css" /><link rel="stylesheet" media="print" href="Common_Content/css/print.css" type="text/css" /><meta name="generator" content="publican v4.2.6" /><meta name="package" content="Red_Hat_CloudForms-Bare_Metal_Provisioning_Guide-3.2-en-US-0.0-0" /><meta name="description" content="A new feature in Red Hat CloudForms 3.2 provides the ability to provision bare metal machines using a Foreman provider, such as Red Hat Satellite 6. This guide shows how to add Red Hat Satellite 6 as a provider in Red Hat CloudForms Management Engine and provision bare metal machines from Satellite 6's Foreman Discovery service." /></head><body><div id="chrometwo"><div id="main"><p id="title"><a class="left" href="https://access.redhat.com"><img alt="Product Site" src="Common_Content/images//image_left.png" /></a><a class="right" href="https://access.redhat.com"><img alt="Documentation Site" src="Common_Content/images//image_right.png" /></a></p><div xml:lang="en-US" class="article" lang="en-US"><div class="titlepage"><div><div class="producttitle"><span xmlns:d="http://docbook.org/ns/docbook" class="productname">Red Hat CloudForms</span> <span xmlns:d="http://docbook.org/ns/docbook" class="productnumber">3.2</span></div><div><h1 class="title"><a id="idm262781575136"></a>Bare Metal Provisioning Guide</h1></div><div><h2 class="subtitle">A short guide to integrating Red Hat Satellite 6 with Red Hat CloudForms to provision bare metal machines.</h2></div><div><h3 class="corpauthor">
		<span class="inlinemediaobject"><object data="Common_Content/images/title_logo.svg" type="image/svg+xml"><img src="Common_Content/images/title_logo.png" alt="" /></object></span>

	</h3></div><div><div xml:lang="en-US" class="authorgroup" lang="en-US"><div class="author"><h3 class="author"><span class="firstname">Red Hat CloudForms Documentation Team</span> <span class="surname"></span></h3><div class="affiliation"><span xmlns:d="http://docbook.org/ns/docbook" class="orgname">Red Hat</span> <span xmlns:d="http://docbook.org/ns/docbook" class="orgdiv">Customer Content Services</span></div><code class="email"><a class="email" href="mailto:"></a></code></div></div></div><div><div class="legalnotice"><a id="idm262866169136"></a><h1 class="legalnotice">Legal Notice</h1><div class="para">
		Copyright <span class="trademark"></span>© 2015 | You need to change the HOLDER entity in the en-US/Bare_Metal_Provisioning_Guide.ent file |.
	</div><div class="para">
		This document is licensed by Red Hat under the <a href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>. If you distribute this document, or a modified version of it, you must provide attribution to Red Hat, Inc. and provide a link to the original. If the document is modified, all Red Hat trademarks must be removed.
	</div><div class="para">
		Red Hat, as the licensor of this document, waives the right to enforce, and agrees not to assert, Section 4d of CC-BY-SA to the fullest extent permitted by applicable law.
	</div><div class="para">
		Red Hat, Red Hat Enterprise Linux, the Shadowman logo, JBoss, MetaMatrix, Fedora, the Infinity Logo, and RHCE are trademarks of Red Hat, Inc., registered in the United States and other countries.
	</div><div class="para">
		<span class="trademark">Linux</span>® is the registered trademark of Linus Torvalds in the United States and other countries.
	</div><div class="para">
		<span class="trademark">Java</span>® is a registered trademark of Oracle and/or its affiliates.
	</div><div class="para">
		<span class="trademark">XFS</span>® is a trademark of Silicon Graphics International Corp. or its subsidiaries in the United States and/or other countries.
	</div><div class="para">
		<span class="trademark">MySQL</span>® is a registered trademark of MySQL AB in the United States, the European Union and other countries.
	</div><div class="para">
		<span class="trademark">Node.js</span>® is an official trademark of Joyent. Red Hat Software Collections is not formally related to or endorsed by the official Joyent Node.js open source or commercial project.
	</div><div class="para">
		The <span class="trademark">OpenStack</span>® Word Mark and OpenStack Logo are either registered trademarks/service marks or trademarks/service marks of the OpenStack Foundation, in the United States and other countries and are used with the OpenStack Foundation's permission. We are not affiliated with, endorsed or sponsored by the OpenStack Foundation, or the OpenStack community.
	</div><div class="para">
		All other trademarks are the property of their respective owners.
	</div></div></div><div><div class="abstract"><p class="title"><strong>Abstract</strong></p><div class="para">
			A new feature in Red Hat CloudForms 3.2 provides the ability to provision bare metal machines using a Foreman provider, such as Red Hat Satellite 6. This guide shows how to add Red Hat Satellite 6 as a provider in Red Hat CloudForms Management Engine and provision bare metal machines from Satellite 6's Foreman Discovery service.
		</div></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#idm262781570560">1. Defining the Workflow</a></span></dt><dt><span class="section"><a href="#idm262818867200">2. Defining the Hostgroup Hierarchy</a></span></dt><dt><span class="section"><a href="#idm262818865264">3. Adding a Satellite 6 Provider to CloudForms</a></span></dt><dt><span class="section"><a href="#idm262871474272">4. Triggering a Refresh of a Satellite 6 Provider</a></span></dt><dt><span class="section"><a href="#idm262871466320">5. Enabling the Foreman Discovery Plugin on a Satellite 6 Provider</a></span></dt><dt><span class="section"><a href="#idm262777697152">6. Discovering a Bare Metal Host in a Foreman provider</a></span></dt><dt><span class="section"><a href="#idm262777686128">7. Provisioning a Bare Metal Host in Red Hat CloudForms</a></span></dt><dt><span class="section"><a href="#idm262777684720">8. Reprovisioning a Bare Metal Host in Red Hat CloudForms</a></span></dt><dt><span class="section"><a href="#idm262777683312">9. Tagging a Bare Metal Host in Red Hat CloudForms</a></span></dt><dt><span class="appendix"><a href="#appe-Red_Hat_CloudForms-Bare_Metal_Provisioning_Guide-Revision_History">A. Revision History</a></span></dt><dt><span class="index"><a href="#idm262783320928">Index</a></span></dt></dl></div><div class="para">
		Red Hat CloudForms 3.2 provides functionality to provision and monitor bare metal machines through communication with Satellite 6. Satellite 6 is a subscription and system management tool that provides a way to provision hosts (both virtual and bare metal) and configure them using a set of Puppet modules. This guide provides a step-by-step workflow on how to provision bare metal hosts using Red Hat CloudForms 3.2 and Red Hat Satellite 6.
	</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm262781570560">
      ⁠</a>1. Defining the Workflow</h2></div></div></div><div class="para">
			This guide uses the following workflow:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="orderedlist"><ol><li class="listitem"><div class="para">
					Add Red Hat Satellite 6.0 as a Foreman provider to your Red Hat CloudForms Management Engine appliance.
				</div></li><li class="listitem"><div class="para">
					Refresh the state of your Red Hat Satellite 6.0 provider in Red Hat CloudForms Management Engine.
				</div></li><li class="listitem"><div class="para">
					Provision new bare metal hosts from Red Hat Satellite 6's Discovery service.
				</div></li><li class="listitem"><div class="para">
					Reprovision existing bare metal hosts from Red Hat Satellite 6's Discovery service.
				</div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm262818867200">
      ⁠</a>2. Defining the Hostgroup Hierarchy</h2></div></div></div><div class="para">
			Red Hat CloudForms Management Engine displays the Red Hat Satellite 6 infrastructure in a host group and host relationship. A host group defines a set of default values that hosts inherit when placed in that group. Hosts can belong to only one host group, but host groups can be nested in hierarchies. You can create a "base" or "parent" host group that represents all hosts in your organization, and then create nested or "child" host groups under that parent to provide specific settings.
		</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm262818865264">
      ⁠</a>3. Adding a Satellite 6 Provider to CloudForms</h2></div></div></div><div class="para">
			To start provisioning bare metal machines, you need at least one Foreman provider added to Red Hat CloudForms Management Engine. The following procedure show how to do this.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm262818863856">
      ⁠</a><p class="title"><strong>Procedure 1. Adding a Satellite 6 Provider to CloudForms</strong></p><ol class="1"><li class="step"><div class="para">
					Log in to your Red Hat CloudForms Management Engine UI as the administration user.
				</div></li><li class="step"><div class="para">
					Navigate to <span class="guimenu"><strong>Infrastructure</strong></span> → <span class="guisubmenu"><strong>Configuration Management</strong></span>. The providers list appears and should be empty.
				</div></li><li class="step"><div class="para">
					Select <span class="guimenu"><strong>Configuration</strong></span> → <span class="guisubmenu"><strong>Add a new Foreman Provider</strong></span>. A empty form for your new Satellite 6 provider appears.
				</div></li><li class="step"><div class="para">
					Enter a <span class="guilabel"><strong>Name</strong></span> for the provider. This is just a plain text name to help identify your provider in the Red Hat CloudForms Management Engine UI. For example, <code class="literal">Satellite 6</code>
				</div></li><li class="step"><div class="para">
					Enter a <span class="guilabel"><strong>URL</strong></span> for the provider. This is the root URL for the Satellite 6 server and can be either an IP address or a hostname. For example, <code class="literal">http://satellite6.example.com</code>
				</div></li><li class="step"><div class="para">
					Select <span class="guilabel"><strong>Verify SSL</strong></span> to use encrypted communication with the provider. This requires the SSL certificates from your Foreman provider. 

				</div></li><li class="step"><div class="para">
					Enter a <span class="guilabel"><strong>User ID</strong></span> for a user on the provider. Ideally, this would be a user in Satellite 6 with administrative access.
				</div></li><li class="step"><div class="para">
					Enter a <span class="guilabel"><strong>Password</strong></span> and enter it again to <span class="guilabel"><strong>Verify Password</strong></span>. Click the <span class="guilabel"><strong>Validate</strong></span> button to test your connection with the Satellite 6 server.
				</div></li><li class="step"><div class="para">
					Click <span class="guilabel"><strong>Save</strong></span> to confirm your settings and save the provider.
				</div></li></ol></div><div class="para">
			Red Hat CloudForms Management Enginer saves the Satellite 6 provider in its database and triggers a refresh of resources detected in the provider.
		</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm262871474272">
      ⁠</a>4. Triggering a Refresh of a Satellite 6 Provider</h2></div></div></div><div class="para">
			Your Satellite 6 provider can still create new hosts independently of Red Hat CloudForms. Your Red Hat CloudForms appliance detects these changes after an automatic refresh period. However, you can trigger a manual refresh to avoid waiting for the automatic refresh.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm262871472768">
      ⁠</a><p class="title"><strong>Procedure 2. Triggering a Refresh of a Satellite 6 Provider</strong></p><ol class="1"><li class="step"><div class="para">
					Navigate to <span class="guimenu"><strong>Infrastructure</strong></span> → <span class="guisubmenu"><strong>Configuration Management</strong></span>. The providers list appears.
				</div></li><li class="step"><div class="para">
					Select your Satellite 6 provider using the checkboxes and click <span class="guimenu"><strong>Configuration</strong></span> → <span class="guisubmenu"><strong>Refresh Relationships and Power States</strong></span>. This triggers the refresh.
				</div></li><li class="step"><div class="para">
					When the refresh complete, click on the Satellite 6 provider to check the updated contents.
				</div></li></ol></div><div class="para">
			The page now displays updated contents of the provider.
		</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm262871466320">
      ⁠</a>5. Enabling the Foreman Discovery Plugin on a Satellite 6 Provider</h2></div></div></div><div class="para">
			The Foreman Discovery plug-in in Red Hat Satellite Server adds Metal-as-a-Service (MaaS) features. Bare-metal hosts on Satellite Server-managed networks can be booted over the network through PXE into stripped-down Red Hat Enterprise Linux systems running from memory to collect and send hardware facts to the Satellite Server.
		</div><div class="para">
			After they have booted, these systems appear as discovered hosts on the Satellite Server. Administrators can use these collected hardware facts to provision systems, removing the need to manually collect MAC addresses and other hardware information and reducing the time required to provision hosts.
		</div><div class="para">
			After the provisioning configuration is complete, the Foreman discovery plug-in sends a reboot command to the discovered host and the installation begins. The host then moves from the <span class="guimenu"><strong>Discovered Hosts</strong></span> list in the Satellite Server to the <span class="guimenu"><strong>All Hosts</strong></span> list.
		</div><div class="para">
			This section provides a brief set of instructions for configuring Satellite 6 to use to Discovery plugin. For full instructions, see <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Satellite/6.0/html/User_Guide/chap-Configuring_the_Foreman_Discovery_Plugin.html#sect-Installing_the_Foreman_Discovery_Plugin">Chapter 11. Using the Foreman Discovery Plugin</a> in the <em class="citetitle">Red Hat Satellite 6 User Guide</em>.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm262871460384">
      ⁠</a><p class="title"><strong>Procedure 3. Enabling the Foreman Discovery Plugin on a Satellite 6 Provider</strong></p><ol class="1"><li class="step"><div class="para">
					Run the following command as the <code class="systemitem">root</code> user on the Satellite 6 server to install the Foreman Discovery plug-in:
				</div><pre class="screen">
[root@satellite6 ~]# yum install foreman-discovery-image
</pre><div class="para">
					This installs an image containing Foreman Discovery to the TFTP service on you Satellite 6 server.
				</div></li><li class="step"><div class="para">
					Red Hat Satellite 6 contains a Global PXE template that requires modification. In Red Hat Satellite 6.0, this template is locked from editing. To unlock this template, run the <span class="application"><strong>rake</strong></span> console on the Satellite 6.0 server.
				</div><pre class="screen">
[root@satellite6 ~]# foreman-rake console
</pre><div class="para">
					Enter the following commands in the console:
				</div><pre class="screen">
&gt; ct = ConfigTemplate.find_by_name("PXELinux global default"); ct.locked = false; ct.save!
&gt; exit
</pre><div class="para">
					This unlocks the template.
				</div></li><li class="step"><div class="para">
					Log into your Red Hat Satellite 6 UI and navigate to <span class="guimenu"><strong>Hosts</strong></span> → <span class="guimenuitem"><strong>Provisioning templates</strong></span>. Edit the <code class="literal">PXELinux global default template</code> and add the following lines:
				</div><pre class="screen">
LABEL discovery
MENU LABEL Foreman Discovery
MENU DEFAULT
KERNEL boot/foreman-discovery-image-latest.el6.iso-vmlinuz
APPEND rootflags=loop initrd=boot/foreman-discovery-image-latest.el6.iso-img root=live:/foreman.iso rootfstype=auto ro rd.live.image rd.live.check rd.lvm=0 rootflags=ro crashkernel=128M elevator=deadline max_loop=256 rd.luks=0 rd.md=0 rd.dm=0 rd.bootif=0 rd.neednet=0 nomodeset selinux=0 stateless foreman.url=<em class="replaceable">FOREMAN_URL</em>
IPAPPEND 2
</pre><div class="para">
					This adds an entry for Foreman Discovery when using the default PXE boot service for Satellite 6.
				</div><div class="para">
					The highlighted <code class="option">FOREMAN_URL</code> option on the APPEND line identifies the location of the Satellite 6 server. Ensure that this is set correctly in global settings or the discovered hosts will not register to Satellite 6.
				</div><div class="para">
					Also set the <em class="parameter"><code>ONTIMEOUT</code></em> parameter to <code class="literal">discovery</code> to make the <code class="option">Foreman Discovery</code> option the default:
				</div><pre class="screen">ONTIMEOUT discovery</pre><div class="para">
					When completed, save this template.
				</div></li><li class="step"><div class="para">
					Click <span class="guibutton"><strong>Build PXE Default</strong></span> to deploy the global default template file to the TFTP server.
				</div></li></ol></div><div class="para">
			This Foreman Discovery plugin is not enabled and configured. The next section tests the service by adding a new bare metal host.
		</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm262777697152">
      ⁠</a>6. Discovering a Bare Metal Host in a Foreman provider</h2></div></div></div><div class="para">
			Before provisioning a bare metal host, Satellite 6 needs to discover them. Satellite 6 achieves this through its Foreman Discovery service, which we configured in the previous section.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><div class="para">
					Start a new bare metal host and elect to start over the network from the boot options menu. This starts the host using the <acronym class="acronym">PXE</acronym> service.
				</div></li><li class="step"><div class="para">
					Select <code class="literal">Foreman Discovery</code> from the <span class="guilabel"><strong>PXE boot</strong></span> options menu. The host starts into the <span class="guilabel"><strong>Foreman Discovery</strong></span> screen and is automatically registered in the installer.
				</div></li><li class="step"><div class="para">
					Log into the Foreman provider and confirm that the host has been registered:
				</div><ol class="substeps a"><li class="step"><div class="para">
							Click <span class="guimenu"><strong>Hosts</strong></span> → <span class="guimenuitem"><strong>Discovered hosts</strong></span>.
						</div></li><li class="step"><div class="para">
							Click the name of the newly registered host to open the details page for the host, and review the details.
						</div></li></ol></li></ol></div><div class="para">
			The host is now included in the list of discovered hosts. Red Hat CloudForms Management Enginer can now provision them.
		</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm262777686128">
      ⁠</a>7. Provisioning a Bare Metal Host in Red Hat CloudForms</h2></div></div></div><div class="para">
		</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm262777684720">
      ⁠</a>8. Reprovisioning a Bare Metal Host in Red Hat CloudForms</h2></div></div></div><div class="para">
		</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm262777683312">
      ⁠</a>9. Tagging a Bare Metal Host in Red Hat CloudForms</h2></div></div></div><div class="para">
		</div></div><div xml:lang="en-US" class="appendix" lang="en-US"><h2 class="title"><a id="appe-Red_Hat_CloudForms-Bare_Metal_Provisioning_Guide-Revision_History">
      ⁠</a>A. Revision History</h2><div xmlns:d="http://docbook.org/ns/docbook" class="para"><p></p>
		<div class="revhistory"><table summary="Revision History"><tr><th align="left" valign="top" colspan="3"><strong>Revision History</strong></th></tr><tr><td align="left">Revision 0.0-0</td><td align="left">Thu May 7 2015</td><td align="left"><span class="author"><span class="firstname">Enter your first name here.</span> <span class="surname">Enter your surname here.</span></span></td></tr><tr><td align="left" colspan="3">
					<table border="0" summary="Simple list" class="simplelist"><tr><td>Initial creation by publican</td></tr></table>

				</td></tr></table></div>

	</div></div><div class="index"><div class="titlepage"><div><div><h2 class="title"><a id="idm262783320928">
      ⁠</a>Index</h2></div></div></div><div class="index"></div></div></div></div></div></body></html>