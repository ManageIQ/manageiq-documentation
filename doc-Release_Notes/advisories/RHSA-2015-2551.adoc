[[RHSA-2015-2551]]
=== RHSA-2015-2551

The bugs contained in this section are addressed by advisory RHSA-2015:2551. Further information about this advisory is available at https://access.redhat.com/errata/RHSA-2015:2551.html.

==== API

BZ#link:https://bugzilla.redhat.com/1127780[1127780]
------
As there was a need for an ability to modify tags outside of the user interface, this enhancement enables tag management such as (add, delete, list etc) through web services similar to the functionality a user would have through the user interface. This is now available via REST API.
------

BZ#link:https://bugzilla.redhat.com/1202556[1202556]
------
The new version of CloudForms Management Engine adds the ability to import reports using both the command line and the REST API. This feature addresses the need to import reports without using the CloudForms Management Engine user interface.
------

BZ#link:https://bugzilla.redhat.com/1238268[1238268]
------
The new version of CloudForms Management Engine adds the capability to retrieve Reporting reports with RESTapi. The reports are returned in the JSON format in response to port standard RESTapi inventory calls.
------

BZ#link:https://bugzilla.redhat.com/1257748[1257748]
------
The new version of CloudForms Management Engine adds the ablity to change a user's password using the REST API. This feature was added to address the need to change the CloudForms Management Engine's administrator's password during deployment from the Red Hat Cloud Infrastructure product.
------

==== Appliance

BZ#link:https://bugzilla.redhat.com/1124520[1124520]
------
The new version of CloudForms Management Engine adds the ability to dynamically update the virtual machine hardware reconfiguration dialog box based on the limits defined by the lowest virtual machine hardware definition. The hardware definitions were hard coded in the previous version limiting the ability to reconfigure a virtual machine's memory to a maximum of 16GB. The user is now able to reconfigure virtual machine memory as desired.
------

BZ#link:https://bugzilla.redhat.com/1159009[1159009]
------
There was a need to provide users the ability to change from one v2_key to another.  This need arose as a customer has a development and production environment with different encryption keys.  After exporting and importing an automate model, the new database could no longer access these keys. Previously, the keys could be deleted, but there was a need for a way to migrate the data from being encrypted with one key into another.

With this enhancement, fix_auth now converts old v2 keys.
------

BZ#link:https://bugzilla.redhat.com/1170760[1170760]
------
The new version of CloudForms Management Engine adds the ability to disable the admin user after adding LDAP as a user authentication mechanism. This feature adds the ability to protect the admin account from brute force attacks via the web user interface, as password constraints cannot otherwise be enforced for the admin account.
------

BZ#link:https://bugzilla.redhat.com/1174458[1174458]
------
In the previous version of CloudForms Management Engine, the password of the administrative user used to setup a trusted Active Directory forest would be logged to the evm log when saving the settings for the trust. This bug was a result of faulty programming logic, and was fixed by correcting the code. The administrative user's password is no longer logged when setting up a trusted Active Directory forest in the new version of CloudForms Management Engine.
------

BZ#link:https://bugzilla.redhat.com/1180768[1180768]
------
The appliance image for the new version of CloudForms Management Engine adds separate mount points for the /var, /var/log, /var/log/audit, /home and /tmp directories. This enhancement allows CloudForms Management Engine implementations to remain compliant with STIG (Security Technical Implementation Guide) requirements.
------

BZ#link:https://bugzilla.redhat.com/1182644[1182644]
------
The new version of CloudForms Management Engine adds the ability to run the CloudForms appliance console as a non-root user. This ability allows the implementation to remain compliant with STIG (Security Technical Implementation Guide) requirements.
------

BZ#link:https://bugzilla.redhat.com/1183092[1183092]
------
The new version of CloudForms Management Engine no longer changes, deletes or overwrites the /etc/init/control-alt-delete.override and /var/www/miq/system/LINK/etc/init/control-alt-delete.override files. Any change to these files would result in breaking STIG (Security Technical Implementation Guide) compliance. This ability allows the implementation to remain compliant with STIG requirements.
------

BZ#link:https://bugzilla.redhat.com/1183094[1183094]
------
In the previous version of CloudForms Management Engine, it was not possible to use an OCSP responder to serve CRLs as the Apache http server shipped in that version did not support OCSP. This resulted in a high administrative overhead. This issue was fixed by upgrading the Apache http server to version 2.5 in the new version of CloudForms Management Engine.
------

BZ#link:https://bugzilla.redhat.com/1206666[1206666]
------
The new version of CloudForms Management Engine removes the requirement to pass the LOCK_CONSOLE=false environment variable when starting the applicance console as the root user over a SSH connection. This makes it easier to start the console when operating in the Open Stack environment.
------

BZ#link:https://bugzilla.redhat.com/1221760[1221760]
------
The new version of CloudForms Management Engine adds the ability to do a full tree search when looking for users under a LDAP directory branch. This feature was added as the default configuration was not able to do a sub-tree search to find all users from the LDAP directory branch. This feature is available as a configuration option in the new version of CloudForms Management Engine.
------

BZ#link:https://bugzilla.redhat.com/1222591[1222591]
------
In Red Hat CloudForms 3.2 (CloudForms Management Engine 5.4) and above, the cloud-init function blocks SSH access for the root user to virtual machines hosted in Red Hat Enterprise Virtualization 3.4 environments. Note that this issue only occurs in Red Hat Enterprise Virtualization 3.4, and that cloud-init functions correctly for Red Hat Enterprise Virtualization 3.3 and Red Hat Enterprise Virtualization 3.5. This issue will be addressed in a future release.
------

BZ#link:https://bugzilla.redhat.com/1227426[1227426]
------
While migrating from the previous version of CloudForms Management Engine, some users would be deleted but the dashboard definitions for the users were not deleted from the database. This would result in the admin user's inability to generate widgets for groups containing these users. This bug was fixed by checking for and skipping over the residual data for deleted users. The admin user is able to generate widgets as expected in the new version of CloudForms Managetment Engine.
------

BZ#link:https://bugzilla.redhat.com/1238423[1238423]
------
While migrating from the previous version of CloudForms Management Engine, a process id out of range error would be displayed after the evmserverd service was started. This error was a result of invalid text being written to the evm pid file by the upgrade process. This error was fixed by verifying the content of the pid file before passing it to ps. The process id out of range error is no longer seen in the new version of CloudForms Management Engine.
------

BZ#link:https://bugzilla.redhat.com/1238443[1238443]
------
Migrating to the previous version of CloudForms Management Engine would fail with a DB:migrate failure error while un-installing rubyrep. This would happen as the replication workers had the VMDB password stored encrypted with the old key. This bug was fixed by ensuring that legacy keys were loaded before un-installing rubyrep, so the task could complete. Migrating to the new version of CloudForms Management Engine now succeeds as expected.
------

BZ#link:https://bugzilla.redhat.com/1247298[1247298]
------
Multi-tenancy provides a mechanism to group or isolate resources and identity via a single instance of the software serving multiple client organizations (tenants). It enables sharing of resources and costs across a large pool of users to allow for:
-Centralization of infrastructure in locations with lower costs (e.g. real estate, electricity)
-Peak-load capacity increases (users need not engineer for highest possible load-levels)
-Utilization and efficiency improvements for systems that are often only 10-20% utilized
------

BZ#link:https://bugzilla.redhat.com/1262984[1262984]
------
The new version of CloudForms Management Engine no longer ships with the outdated /var/www/miq/vmdb/certs/ca.cer certificate authority file. This file is no longer in use. Additionally, all references to the file in documentation have been removed.
------

BZ#link:https://bugzilla.redhat.com/1270148[1270148]
------
The new version of CloudForms Management Engine adds the ability to create tag names containing up to 50 characters. The previous version limited tag names to 30 characters. This increase in maximum tag name size was done to allow creation of tag names based on Cloud and OpenStack tenant names.
------

BZ#link:https://bugzilla.redhat.com/1278202[1278202]
------
Previously, there were permission denied errors when logging in with non-root users. This patch fixes the cfme-gemset RPM spec by separating the parts of the enable script that are for one-time setup into a setup script, and calling the setup script from the kickstart.
------

==== Automate

BZ#link:https://bugzilla.redhat.com/1126934[1126934]
------
There was a need to have a quota rule using the space actually consumed by the template, rather than enforce quota on space allocated. This enhancement consolidates quota code to help facilitate resolution. Quota can now be enforced based on used space.
------

BZ#link:https://bugzilla.redhat.com/1215990[1215990]
------
The new version of CloudForms Management Engine enhances the Automate engine to allow the on_entry and on_error methods of a state machine to advance to the next state under valid conditions. For on_entry methods, it checks if the method is required to run. For on_error methods, it handles and recovers from errors.
------

BZ#link:https://bugzilla.redhat.com/1227045[1227045]
------
The new version of CloudForms Management Engine adds the ability to filter service catalog items during deployment. The new deployment model allows the service designer to factor in the dynamic nature of the deployment process, where the user can select a sub-set of services. Automate will exclude all other catalog service items during deployment.
------

BZ#link:https://bugzilla.redhat.com/1236174[1236174]
------
The new version of CloudForms Management Engine enhances the Automate engine to support multiple state machines to be executed in a single workspace. This allows for one state machine to call another state machine in the same workspace. If any one of the state machines in the chain ends with a retry or error, all the state machines end with a retry or error correspondingly.
------

BZ#link:https://bugzilla.redhat.com/1238391[1238391]
------
In the previous version of CloudForms Management Engine, providing a root password in the Customize tab while provisioning a virtual machine resulted in the password being logged in clear text to the evm log. This was because the method used to dump object data did not define the filters for sensitive data. This bug was fixed by adding the filter options to the object dump method. The root password is no longer logged while provisioning a virtual machine in the new version of CloudForms Management Engine.
------

BZ#link:https://bugzilla.redhat.com/1254953[1254953]
------
There was a need to manage tags via Automate. This enhancement adds a new class method 'categories' to return an array of MiqAeService::MiqAeClassification objects, and exposes the entries method in the MiqAeService::MiqAeClassification to access the entries in a category.
Automate methods can now access categories and entries.
------

==== Control

BZ#link:https://bugzilla.redhat.com/1248848[1248848]
------
The new version of CloudForms Management Engine removes the user interface and code that provided support for Ruby expressions in conditions. This was done to enhance security of the CloudForms Management Engine appliance.
------

==== Performance

BZ#link:https://bugzilla.redhat.com/1204108[1204108]
------
In the previous version of CloudForms Management Engine, a user could experience long delays in switching between tabs when provisioning virtual machines. This delay was due to the time taken to log debug session data. This bug was fixed by logging debug session data only when running in debug mode. Switching tabs when provisioning is a lot faster in the new version of CloudForms Management Engine.
------

==== Providers

BZ#link:https://bugzilla.redhat.com/1140191[1140191]
------
The previous version of CloudForms Management Engine would fail to collect inventory from an OpenStack provider if accessing OpenStack security groups returned a HTTP 404 error due to the No-Op firewall operating in Neutron on OpenStack. This bug was fixed by changing code in the OpenStack connection library to handle HTTP 404 errors correctly. The new version of CloudForms Management Engine recovers correctly from not being able to collect security group information from OpenStack.
------

BZ#link:https://bugzilla.redhat.com/1218746[1218746]
------
The new version of CloudForms Management Engine adds multi-tenant support for orchestrating stacks. This feature adds the ability to collect stack information from all tenants during an orchestration refresh, adds the option to select the tenant in the orchestration provisioning dialog and the ability to operate the stack on the selected tenant.
------

BZ#link:https://bugzilla.redhat.com/1223536[1223536]
------
The previous version of CloudForms Management Engine had a bug in the OpenStack inventory gathering code, which limited its ability to find OpenStack server instances to a maximum of 1000 instances. The bug was a result of the inventory code not supporting paginated queries for OpenStack server instances. This bug was fixed by adding pagination support to the query for OpenStack server instances. The new version of CloudForms Management Engine is able to list all OpenStack server instances for an OpenStack provider.
------

BZ#link:https://bugzilla.redhat.com/1234871[1234871]
------
The previous version of CloudForms Management Engine would report an undefined method error when discovering virtual machines on a Microsoft system center virtual machine manager (SCVMM) provider, if it found a disk-less virtual machine. This bug was a result of the virtual machine storage discovery code always expecting virtual machines to have disks. This bug was fixed by changing the code to handle the case of disk-less virtual machines gracefully. Virtual machine discovery on SCVMM providers completes successfully in the new version of CloudForms Management Engine.
------

BZ#link:https://bugzilla.redhat.com/1250202[1250202]
------
In the previous version of CloudForms Management Engine, heat templates could be found only in the admin tenant, and no other tenant. This bug was caused by an outdated Fog gem. This bug was fixed by updating the Fog gem version available on the appliance. Heat templates are now found in all tenants in the new version of CloudForms Management Engine.
------

BZ#link:https://bugzilla.redhat.com/1260196[1260196]
------
The new version of CloudForms Management Engine collects and stores inventory information about disks available for flavours on cloud providers.
------

BZ#link:https://bugzilla.redhat.com/1263744[1263744]
------
Cloud tenants description field length limit causes inventory collection to fail when OpenStack tenant description is over 255 characters. As a result, during the initial discovery of an Openstack environment, CloudForms receives 404 error responses for different instances causing the inventory collection to fail.

Since OpenStack allows a tenant description value larger than 255 characters, CFME OpenStack inventory collection now supports tenant descriptions larger than 255 characters and inventory collection succeeds without any errors.
------

==== Provisioning

BZ#link:https://bugzilla.redhat.com/1216889[1216889]
------
After provisioning a virtual machine with more than 4 GB memory from CloudForms Management Engine 3.1, a virtual machine could not be powered on automatically. This happened because the memory reservation was larger than the allocated virtual machine memory. CloudForms 4.0 now validates memory reservation and reports an error message if it is larger than the allocated virtual machine's memory.
------

BZ#link:https://bugzilla.redhat.com/1234904[1234904]
------
Previously, the Virtual Machine Manager (VMM) server was  not loaded into the shell for Microsoft's System Center 2012 SP1 Virtual Machine Manager, causing virtual machine provisioning from templates to fail on System Center 2012 SP1 Virtual Machine Manager. System Center 2012 SP1 VMM environments now load the VMM server into the shell, and provisioning from a template succeeds.
------

BZ#link:https://bugzilla.redhat.com/1235822[1235822]
------
Previously, virtual machines on Red Hat Enterprise Virtualization Manager started slowly, and as a result the virtual machines could not run because they were in Powering Up status during the autostart_destination phase. This has been fixed by adding a loop in the code for the host to requeue a virtual machine's boot request. The virtual machine will automatically raise an error to fail the provisioning if it has not started after 120 attempts.
------

==== Reporting

BZ#link:https://bugzilla.redhat.com/1238287[1238287]
------
Previous CloudForms Management Engine versions did not report a high watermark for the number of virtual machine sockets on a provider's hypervisors over a one-month period. This functionality has been added to the current version of CloudForms Management Engine. A report can now be queued to collect watermark information for sockets on each hypervisor per provider.
------

BZ#link:https://bugzilla.redhat.com/1243695[1243695]
------
Previously, the chargeback report editor did not save the time zone selected in the Chargeback Interval field. This error in the chargeback report editor has been fixed, and a local time zone can now be saved in reports.
------

==== SmartState Analysis

BZ#link:https://bugzilla.redhat.com/1095243[1095243]
------
Previously, SmartState Analysis failed on Red Hat Enterprise Virtualization virtual machines that were stopped, returning the following error message: "no eligible proxy". This happened because the SmartState Analysis code involved hosts, while SmartState Analysis in Red Hat Enterprise Virtualization does not. The SmartState Analysis code now factors out proxies4job and related methods, implements Red Hat Enterprise Virtualization-specific versions, and ignores host affinity. As a result, SmartState Analysis on Red Hat Enterprise Virtualization stopped virtual machines performs correctly.
------

BZ#link:https://bugzilla.redhat.com/1202895[1202895]
------
In Red Hat Enterprise Virtualization 3.5, virtual machine OVF files no longer all reside on the master storage domain. As a result, performing SmartState Analysis on Red Hat Enterprise Virtualization 3.5 virtual machines residing on NFS storage domains failed due to a file not found error. The SmartState Analysis logic has been updated and it now runs successfully on those virtual machines.
------

==== Web UI

BZ#link:https://bugzilla.redhat.com/1095468[1095468]
------
There was a need for a feature to display NTP Settings on Zone Summary page for the ease of use when setting up Appliances. This has been implemented in this release - Description, SmartProxy Server IP, and NTP Servers displayed are visible for the zone under zone summary page.
------

BZ#link:https://bugzilla.redhat.com/1095470[1095470]
------
Previously, when editing a catalog configuration, the form offers an "Assign Buttons" box. This was caused because text was set incorrectly for the button. The display text for the button has been fixed and the form now correctly says “Assign Catalog Items”.
------

BZ#link:https://bugzilla.redhat.com/1193652[1193652]
------
Previously, the report editor handled tags on entities incorrectly, which produced reports based on EVM groups that did not display the correct tags. This caused custom tags such as 'vms.managed.department' and 'miq_templates.managed.department' to be stripped to 'managed.department' form before being added to col_order. This fix allows tags on entities to be saved correctly by the report editor.
------

BZ#link:https://bugzilla.redhat.com/1234465[1234465]
------
Previously, automate exports used Windows line endings. This was caused because 'textarea' form element added \r\n characters in the data for the newline characters.

With this release, 'miqSerializeForm' JS method was changed to replace '%0D%0A' with '%0A' in the serialized form data which has now fixed the issue and export is done correctly.
------

BZ#link:https://bugzilla.redhat.com/1234588[1234588]
------
Previously, there was an undefined method error when looking at bottlenecks under optimize using IE browser. This was caused due to double render issue of the bottlenecks page. 
This patch fixes the double render issue caused by partial_bottlenecks_tl_detail.html.haml being rendered directly as well as indirectly via _bottlenecks_tabs.html.haml
------

BZ#link:https://bugzilla.redhat.com/1248039[1248039]
------
Previously, when using the Automate Import / Export, if there was another domain available, user was unable to import into a new empty domain.  This was because there was no option to import into the same name domain.

This patch allows importing into a new domain with the same name as importing from which fixes the issue.
------

BZ#link:https://bugzilla.redhat.com/1252976[1252976]
------
Previously, Service Dialog Import / Export wasn't importing All of the Service Dialogs and required importing two to three times before dialogs got imported.

Added SlickGrid plugins related to selections and checkboxes. SlickGrid uses an auto-adaptive display, where if the screen is too small or if the dataset is too large, it removes/re-adds rows to the table as you scroll. This was causing the issue where some of the items in the table weren't being selected to import. The fix was to use SlickGrid's built in plugins for handling row selection, and then serializing the data from the grid itself instead of from the form which has now resolved the issue.
------

BZ#link:https://bugzilla.redhat.com/1256674[1256674]
------
Previously, when using the remote console, there were two mouse cursors, one inside and the other outside of the VM moving at different rates. This was due to the styling in HTML5 console canvases.
Disabling styling for HTML5 console canvases has resolved the issue as the cursors now move together at the same rate.
------

BZ#link:https://bugzilla.redhat.com/1263326[1263326]
------
Previously, clicking on "Migrate Selected Items" under lifecycle dropdown routed to an incorrect config screen. The caller method did not render flash message for sublist screens.

This patch fixes respective 'button' methods to render flash message partially when tasks (clone, migrate, publish) are not supported for selected items. This is when user tries to perform these tasks from a list view of VMs through relationships. Thereby, the correct screen displays and the issue is now resolved.
------

BZ#link:https://bugzilla.redhat.com/1278463[1278463]
------
Previously, datastore scans are only supported against VMware datastores, but the scan feature is displayed no matter the source of the datastore. This was caused because the option to scan a datastore should only be displayed if the datastore itself belongs to a VMware provider.
With this release, code was added to only allow SSA for VMware storage records. As a result, SSA button only shows when using a VMware datastore.
------

BZ#link:https://bugzilla.redhat.com/1280278[1280278]
------
Previously, there was no scrollbar in the group switcher list. Therefore, if a user was a member of many groups, one could not see all groups. 
With this release, a scrollbar has been added to the group switcher list. As a result, one can now see all groups.
------

