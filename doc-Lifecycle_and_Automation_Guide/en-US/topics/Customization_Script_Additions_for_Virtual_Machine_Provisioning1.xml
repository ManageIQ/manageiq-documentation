<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "../Lifecycle_and_Automation_Guide.ent">
%BOOK_ENTITIES;
]>
<section id="Customization_Script_Additions_for_Virtual_Machine_Provisioning1" remap="TID_15517">
	<title>Customization Script Additions for Virtual Machine and Instance Provisioning</title>
	<para />
	<informaltable frame="all">
		<tgroup cols="3">
			<colspec colwidth="1*" />
			<colspec colwidth="2*" />
			<colspec colwidth="6*" />
			<thead>
				<row>
					<entry>
						<para>
							Customization Type
						</para>
					</entry>
					<entry>
						<para>
							Reason to Include
						</para>
					</entry>
					<entry>
						<para>
							Script entries
						</para>
					</entry>
				</row>
			</thead>
			<tbody>
				<row>
					<entry>
						<para>
							Kickstart
						</para>
					</entry>
					<entry>
						<para>
							Takes the values from the <guilabel>Customize</guilabel> tab in <guilabel>Provisioning Dialog</guilabel> and substitutes them into the script.
						</para>
					</entry>
					<entry>
						<programlisting>
<![CDATA[
#Configure Networking based on values from provisioning dialog
<% if evm[:addr_mode].first == 'static' %>
  <% network_string = "network --onboot yes --device=eth0 --bootproto=static --noipv6" %>
  <% ["ip", :ip_addr, "netmask", :subnet_mask, "gateway", :gateway, "hostname", :hostname, "nameserver", :dns_servers].each_slice(2) do |ks_key, evm_key| %>
    <% network_string << " --#{ks_key} #{evm[evm_key]}" unless evm[evm_key].blank? %>
  <% end %>
<%= network_string %>
<% else %>
network --device=eth0 --bootproto=dhcp
<% end %>
]]>
</programlisting>
					</entry>
				</row>
				<row>
					<entry>
						<para>
							Kickstart
						</para>
					</entry>
					<entry>
						<para>
							Encrypts the root password from the <guilabel>Customize</guilabel> tab in the <guilabel>Provisioning Dialog</guilabel>.
						</para>
					</entry>
					<entry>
						<programlisting>
<![CDATA[
rootpw --iscrypted <%= MiqPassword.md5crypt(evm[:root_password]) %>
]]>
</programlisting>
					</entry>
				</row>
				<row>
					<entry>
						<para>
							Kickstart
						</para>
					</entry>
					<entry>
						<para>
							Sends status of the provision back to CloudForms Management Engine Server for display in the CloudForms Management Engine Console.
						</para>
					</entry>
					<entry>
						<programlisting>
<![CDATA[
# Callback to CFME during post-install
wget --no-check-certificate <%= evm[:post_install_callback_url] %>
]]>
</programlisting>
					</entry>
				</row>
				<row>
					<entry>
						<para>
							Sysprep
						</para>
					</entry>
					<entry>
						<para>
							Encrypts the root password from the <guilabel>Customize</guilabel> tab in the <guilabel>Provisioning Dialog</guilabel>. The value for the <guilabel>AdministratorPassword</guilabel> line must be inserted to use the password from the <guilabel>Provision Dialog</guilabel> and encrypt it.
						</para>
					</entry>
					<entry>
						<programlisting language="XML">
<![CDATA[
<UserAccounts>
  <AdministratorPassword>
    <Value><%= MiqPassword.sysprep_crypt(evm[:root_password]) %></Value>
    <PlainText>false</PlainText>
  </AdministratorPassword>
</UserAccounts>
]]>
</programlisting>
					</entry>
				</row>
			</tbody>
		</tgroup>
	</informaltable>
	<para />
</section>