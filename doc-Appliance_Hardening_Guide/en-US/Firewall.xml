<?xml version='1.0' encoding='utf-8' ?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "Security_Guide.ent">
%BOOK_ENTITIES;
]>
<section id="chap-Red_Hat_CloudForms-Security_Guide-Firewall" lang="en-US">
    <title>Configuring the Firewall</title>
    <para>
        A new appliance starts with a few standard ports open:
    </para>
    <itemizedlist>
        <listitem>
            <para>
                22 for SSH communication
            </para>
        </listitem>
        <listitem>
            <para>
                80 for HTTP access to the appliance
            </para>
        </listitem>
        <listitem>
            <para>
                443 for HTTPS access to the appliance
            </para>
        </listitem>
        <listitem>
            <para>
                5432 for the appliance database
            </para>
        </listitem>
    </itemizedlist>
    <para>
        You might need to restrict or open access to certain services on your appliance in the future. In such situations, use either one of the following methods:
    </para>
    <itemizedlist>
        <listitem>
            <para>
                Use <command>lokkit</command> to enable a service or port. For example, to open the LDAP port:
            </para>
            <screen>
                [root@ ~]# lokkit -p 389:tcp
            </screen>
        </listitem>
        <listitem>
            <para>
                Use <command>iptables</command> to define a specific firewall rules:
            </para>
            <screen>
                [root@ ~]# iptables -I INPUT -m state --state NEW -p tcp --dport 389 -j ACCEPT
                [root@ ~]# iptables-save > /etc/sysconfig/iptables
                [root@ ~]# service iptables restart
            </screen>
        </listitem>
        <listitem>
            <para>
                Edit <command>/etc/sysconfig/iptables</command> to view and define all firewall rules. Restart the <command>iptables</command> service after editing and saving the file.
            </para>
        </listitem>
    </itemizedlist>
    <para>
        The following table lists the appliance's main services and their respective ports.
    </para>
    <table frame="all">
        <title>Ports Used by Red Hat CloudForms Management Engine</title>
        <tgroup cols="6">
            <colspec colwidth="4*" />
            <colspec colwidth="2*" />
            <colspec colwidth="2*" />
            <colspec colwidth="2*" />
            <colspec colwidth="2*" />
            <colspec colwidth="4*" />
            <thead>
                <row>
                    <entry>
                        <para>
                            Initiator (CFME Role if applicable)
                        </para>
                    </entry>
                    <entry>
                        <para>
                            Receiver (CFME Role if applicable)
                        </para>
                    </entry>
                    <entry>
                        <para>
                            Application
                        </para>
                    </entry>
                    <entry>
                        <para>
                            TCP Port
                        </para>
                    </entry>
                    <entry>
                        <para>
                            UDP Port
                        </para>
                    </entry>
                    <entry>
                        <para>
                            Purpose/Reason
                        </para>
                    </entry>
                </row>
            </thead>
            <tbody>
                <row>
                    <entry>
                        <para>
                            Administrator (Internet Browser)
                        </para>
                    </entry>
                    <entry>
                        <para>
                            CFME Appliance (User Interface)
                        </para>
                    </entry>
                    <entry>
                        <para>
                            HTTPS
                        </para>
                    </entry>
                    <entry>
                        <para>
                            443
                        </para>
                    </entry>
                    <entry>
                        <para />
                    </entry>
                    <entry>
                        <para>
                            Access to CFME Appliance User Interface
                        </para>
                    </entry>
                </row>
                <row>
                    <entry>
                        <para>
                            Administrator (Internet Browser)
                        </para>
                    </entry>
                    <entry>
                        <para>
                            CFME Appliance (User Interface)
                        </para>
                    </entry>
                    <entry>
                        <para>
                            HTTP
                        </para>
                    </entry>
                    <entry>
                        <para>
                            80
                        </para>
                    </entry>
                    <entry>
                        <para />
                    </entry>
                    <entry>
                        <para>
                            Redirect Web Browser to HTTPS service (443)
                        </para>
                    </entry>
                </row>
                <row>
                    <entry>
                        <para>
                            Service Catalog or other integration through Web Service
                        </para>
                    </entry>
                    <entry>
                        <para>
                            CFME Appliance (Web Service)
                        </para>
                    </entry>
                    <entry>
                        <para>
                            HTTPS
                        </para>
                    </entry>
                    <entry>
                        <para>
                            443
                        </para>
                    </entry>
                    <entry>
                        <para />
                    </entry>
                    <entry>
                        <para>
                            Access to CFME Appliance Web Service
                        </para>
                    </entry>
                </row>
                <row>
                    <entry>
                        <para>
                            CFME Appliance
                        </para>
                    </entry>
                    <entry>
                        <para>
                            NFS Server
                        </para>
                    </entry>
                    <entry>
                        <para>
                            NFS
                        </para>
                    </entry>
                    <entry>
                        <para>
                            2049
                        </para>
                    </entry>
                    <entry>
                        <para>
                            2049
                        </para>
                    </entry>
                    <entry>
                        <para>
                            Embedded NFS VM scanning
                        </para>
                    </entry>
                </row>
                <row>
                    <entry>
                        <para>
                            CFME Appliance (User Interface)
                        </para>
                    </entry>
                    <entry>
                        <para>
                            Any Virtual Machine
                        </para>
                    </entry>
                    <entry>
                        <para>
                            TCP
                        </para>
                    </entry>
                    <entry>
                        <para>
                            903
                        </para>
                    </entry>
                    <entry>
                        <para />
                    </entry>
                    <entry>
                        <para>
                            VM Remote Console (if using MKS plugin)
                        </para>
                    </entry>
                </row>
                <row>
                    <entry>
                        <para>
                            CFME Appliance (User Interface)
                        </para>
                    </entry>
                    <entry>
                        <para>
                            Any Virtual Machine
                        </para>
                    </entry>
                    <entry>
                        <para>
                            TCP
                        </para>
                    </entry>
                    <entry>
                        <para>
                            5900-5999
                        </para>
                    </entry>
                    <entry>
                        <para />
                    </entry>
                    <entry>
                        <para>
                            VM Remote Console (if using VNC)
                        </para>
                    </entry>
                </row>
                <row>
                    <entry>
                        <para>
                            CFME Appliance (any role)
                        </para>
                    </entry>
                    <entry>
                        <para>
                            CFME Appliance running the VMDB (or MS SQL)
                        </para>
                    </entry>
                    <entry>
                        <para>
                            PostgreSQL Named Pipes
                        </para>
                    </entry>
                    <entry>
                        <para>
                            5432 (1433 MS SQL)
                        </para>
                    </entry>
                    <entry>
                        <para />
                    </entry>
                    <entry>
                        <para>
                            CFME Appliance connectivity to the CFME Database (PostgreSQL or MS SQL)
                        </para>
                    </entry>
                </row>
                <row>
                    <entry>
                        <para>
                            CFME Subordinate Region VMDB Appliance(Database Synchronization)
                        </para>
                    </entry>
                    <entry>
                        <para>
                            CFME Master Region VMDB Appliance
                        </para>
                    </entry>
                    <entry>
                        <para>
                            PostgreSQL Named Pipes
                        </para>
                    </entry>
                    <entry>
                        <para>
                            5432 (1433 MS SQL)
                        </para>
                    </entry>
                    <entry>
                        <para />
                    </entry>
                    <entry>
                        <para>
                            Regional VMDB node replication up to Master VMDB node (PostgreSQL only)
                        </para>
                    </entry>
                </row>
                <row>
                    <entry>
                        <para>
                            CFME Appliance(Authentication through LDAP)
                        </para>
                    </entry>
                    <entry>
                        <para>
                            LDAP Server (AD or other)
                        </para>
                    </entry>
                    <entry>
                        <para>
                            LDAP
                        </para>
                    </entry>
                    <entry>
                        <para>
                            389
                        </para>
                    </entry>
                    <entry>
                        <para />
                    </entry>
                    <entry>
                        <para>
                            LDAP integration
                        </para>
                    </entry>
                </row>
                <row>
                    <entry>
                        <para>
                            CFME Appliance (Authentication through LDAPs)
                        </para>
                    </entry>
                    <entry>
                        <para>
                            LDAP Server (AD or other)
                        </para>
                    </entry>
                    <entry>
                        <para>
                            LDAPs
                        </para>
                    </entry>
                    <entry>
                        <para>
                            636
                        </para>
                    </entry>
                    <entry>
                        <para />
                    </entry>
                    <entry>
                        <para>
                            LDAPS integration
                        </para>
                    </entry>
                </row>
                <row>
                    <entry>
                        <para>
                            SNMP Agent
                        </para>
                    </entry>
                    <entry>
                        <para>
                            CFME Appliance (Notifier)
                        </para>
                    </entry>
                    <entry>
                        <para>
                            SNMP (UDP)
                        </para>
                    </entry>
                    <entry>
                        <para />
                    </entry>
                    <entry>
                        <para>
                            161
                        </para>
                    </entry>
                    <entry>
                        <para>
                            SNMP Polling
                        </para>
                    </entry>
                </row>
                <row>
                    <entry>
                        <para>
                            CFME Appliance (Notifier)
                        </para>
                    </entry>
                    <entry>
                        <para>
                            SNMP Server
                        </para>
                    </entry>
                    <entry>
                        <para>
                            SNMP (TCP)
                        </para>
                    </entry>
                    <entry>
                        <para>
                            162
                        </para>
                    </entry>
                    <entry>
                        <para />
                    </entry>
                    <entry>
                        <para>
                            SNMP Trap Send
                        </para>
                    </entry>
                </row>
                <row>
                    <entry>
                        <para>
                            CFME Appliance (Notifier)
                        </para>
                    </entry>
                    <entry>
                        <para>
                            Mail server
                        </para>
                    </entry>
                    <entry>
                        <para>
                            SMTP
                        </para>
                    </entry>
                    <entry>
                        <para>
                            25
                        </para>
                    </entry>
                    <entry>
                        <para />
                    </entry>
                    <entry>
                        <para>
                            SNMP Trap Send
                        </para>
                    </entry>
                </row>
                <row>
                    <entry>
                        <para>
                            CFME Appliance (any role)
                        </para>
                    </entry>
                    <entry>
                        <para>
                            NTP Server
                        </para>
                    </entry>
                    <entry>
                        <para>
                            NTP
                        </para>
                    </entry>
                    <entry>
                        <para />
                    </entry>
                    <entry>
                        <para>
                            123
                        </para>
                    </entry>
                    <entry>
                        <para>
                            Time Source
                        </para>
                    </entry>
                </row>
                <row>
                    <entry>
                        <para>
                            CFME Appliance
                        </para>
                    </entry>
                    <entry>
                        <para>
                            CFME SmartProxy installed on Windows or Linux
                        </para>
                    </entry>
                    <entry>
                        <para>
                            HTTPS
                        </para>
                    </entry>
                    <entry>
                        <para>
                            1139
                        </para>
                    </entry>
                    <entry>
                        <para />
                    </entry>
                    <entry>
                        <para>
                            Communication with SmartProxy
                        </para>
                    </entry>
                </row>
                <row>
                    <entry>
                        <para>
                            CFME SmartProxy installed on Windows or Linux
                        </para>
                    </entry>
                    <entry>
                        <para>
                            CFME Appliance
                        </para>
                    </entry>
                    <entry>
                        <para>
                            HTTPS
                        </para>
                    </entry>
                    <entry>
                        <para>
                            443
                        </para>
                    </entry>
                    <entry>
                        <para />
                    </entry>
                    <entry>
                        <para>
                            SmartProxy Heartbeat
                        </para>
                    </entry>
                </row>
                <row>
                    <entry>
                        <para>
                            CFME Appliance
                        </para>
                    </entry>
                    <entry>
                        <para>
                            DNS Server
                        </para>
                    </entry>
                    <entry>
                        <para>
                            UDP
                        </para>
                    </entry>
                    <entry>
                        <para />
                    </entry>
                    <entry>
                        <para>
                            53
                        </para>
                    </entry>
                    <entry>
                        <para>
                            DNS Lookups
                        </para>
                    </entry>
                </row>
            </tbody>
        </tgroup>
    </table>
    <table frame="all">
        <title>Red Hat Enterprise Virtualization Ports Used by CloudForms Management Engine</title>
        <tgroup cols="6">
            <colspec colwidth="4*" />
            <colspec colwidth="2*" />
            <colspec colwidth="2*" />
            <colspec colwidth="2*" />
            <colspec colwidth="2*" />
            <colspec colwidth="4*" />
            <thead>
                <row>
                    <entry>
                        <para>
                            Initiator (CFME Role if applicable)
                        </para>
                    </entry>
                    <entry>
                        <para>
                            Receiver (CFME Role if applicable)
                        </para>
                    </entry>
                    <entry>
                        <para>
                            Application
                        </para>
                    </entry>
                    <entry>
                        <para>
                            TCP Port
                        </para>
                    </entry>
                    <entry>
                        <para>
                            UDP Port
                        </para>
                    </entry>
                    <entry>
                        <para>
                            Purpose/Reason
                        </para>
                    </entry>
                </row>
            </thead>
            <tbody>
                <row>
                    <entry>
                        <para>
                            CFME Appliance (SmartProxy)
                        </para>
                    </entry>
                    <entry>
                        <para>
                            RHEV-M Server
                        </para>
                    </entry>
                    <entry>
                        <para>
                            HTTPS
                        </para>
                    </entry>
                    <entry>
                        <para>
                            8443
                        </para>
                    </entry>
                    <entry>
                        <para />
                    </entry>
                    <entry>
                        <para>
                            API communications to RHEV-M environment (Inventory, Operations, SmartProxy)
                        </para>
                    </entry>
                </row>
                <row>
                    <entry>
                        <para>
                            CFME Appliance (C&amp;U)
                        </para>
                    </entry>
                    <entry>
                        <para>
                            RHEV-M Server
                        </para>
                    </entry>
                    <entry>
                        <para>
                            PostgreSQL
                        </para>
                    </entry>
                    <entry>
                        <para>
                            5432
                        </para>
                    </entry>
                    <entry>
                        <para />
                    </entry>
                    <entry>
                        <para>
                            RHEV-M History Database (Database connectivity not enabled by default). See <ulink url="https://access.redhat.com/site/solutions/63277">How to access RHEV-M Postgres DB from remote machine</ulink>.
                        </para>
                    </entry>
                </row>
                <row>
                    <entry>
                        <para>
                            CFME Appliance
                        </para>
                    </entry>
                    <entry>
                        <para>
                            RHEVH Hosts or RHEL Hypervisors
                        </para>
                    </entry>
                    <entry>
                        <para>
                            SSH
                        </para>
                    </entry>
                    <entry>
                        <para>
                            22
                        </para>
                    </entry>
                    <entry>
                        <para />
                    </entry>
                    <entry>
                        <para>
                            SSH connections.
                        </para>
                    </entry>
                </row>
                <row>
                    <entry>
                        <para>
                            CFME Appliance
                        </para>
                    </entry>
                    <entry>
                        <para>
                            RHEVH Hosts or RHEL Hypervisors
                        </para>
                    </entry>
                    <entry>
                        <para>
                            DirectLUN
                        </para>
                    </entry>
                    <entry>
                        <para />
                    </entry>
                    <entry>
                        <para />
                    </entry>
                    <entry>
                        <para>
                            Direct LUN hook must be installed and enabled for embedded VM scanning on FC or iSCSI storage devices. Not a tcp/udp connection.
                        </para>
                    </entry>
                </row>
            </tbody>
        </tgroup>
    </table>
    <table frame="all">
        <title>Red Hat OpenStack Platform Ports Used by CloudForms Management Engine</title>
        <tgroup cols="6">
            <colspec colwidth="4*" />
            <colspec colwidth="2*" />
            <colspec colwidth="2*" />
            <colspec colwidth="2*" />
            <colspec colwidth="2*" />
            <colspec colwidth="4*" />
            <thead>
                <row>
                    <entry>
                        <para>
                            Initiator (CFME Role if applicable)
                        </para>
                    </entry>
                    <entry>
                        <para>
                            Receiver (CFME Role if applicable)
                        </para>
                    </entry>
                    <entry>
                        <para>
                            Application
                        </para>
                    </entry>
                    <entry>
                        <para>
                            TCP Port
                        </para>
                    </entry>
                    <entry>
                        <para>
                            UDP Port
                        </para>
                    </entry>
                    <entry>
                        <para>
                            Purpose/Reason
                        </para>
                    </entry>
                </row>
            </thead>
            <tbody>
                <row>
                    <entry>
                        <para>
                            CFME Appliance
                        </para>
                    </entry>
                    <entry>
                        <para>
                            RHOS (Keystone)
                        </para>
                    </entry>
                    <entry>
                        <para>
                            HTTP REST API
                        </para>
                    </entry>
                    <entry>
                        <para>
                            5000
                        </para>
                    </entry>
                    <entry>
                        <para />
                    </entry>
                    <entry>
                        <para>
                            Authentication and Service Entry Point
                        </para>
                    </entry>
                </row>
                <row>
                    <entry>
                        <para>
                            CFME Appliance
                        </para>
                    </entry>
                    <entry>
                        <para>
                            RHOS (Nova)
                        </para>
                    </entry>
                    <entry>
                        <para>
                            HTTP REST API
                        </para>
                    </entry>
                    <entry>
                        <para>
                            8774
                        </para>
                    </entry>
                    <entry>
                        <para />
                    </entry>
                    <entry>
                        <para>
                            Compute Resources
                        </para>
                    </entry>
                </row>
                <row>
                    <entry>
                        <para>
                            CFME Appliance (C&amp;U)
                        </para>
                    </entry>
                    <entry>
                        <para>
                            RHOS (Ceilometer)
                        </para>
                    </entry>
                    <entry>
                        <para>
                            HTTP REST API
                        </para>
                    </entry>
                    <entry>
                        <para>
                            8777
                        </para>
                    </entry>
                    <entry>
                        <para />
                    </entry>
                    <entry>
                        <para>
                            Metrics for Capacity and Utilization
                        </para>
                    </entry>
                </row>
                <row>
                    <entry>
                        <para>
                            CFME Appliance
                        </para>
                    </entry>
                    <entry>
                        <para>
                            RHOS (Glance)
                        </para>
                    </entry>
                    <entry>
                        <para>
                            HTTP REST API
                        </para>
                    </entry>
                    <entry>
                        <para>
                            9292
                        </para>
                    </entry>
                    <entry>
                        <para />
                    </entry>
                    <entry>
                        <para>
                            Authentication and Service Entry Point
                        </para>
                    </entry>
                </row>
                <row>
                    <entry>
                        <para>
                            CFME Appliance
                        </para>
                    </entry>
                    <entry>
                        <para>
                            RHOS (AMQP)
                        </para>
                    </entry>
                    <entry>
                        <para>
                            AMQP
                        </para>
                    </entry>
                    <entry>
                        <para>
                            5672
                        </para>
                    </entry>
                    <entry>
                        <para />
                    </entry>
                    <entry>
                        <para>
                            Events Integration
                        </para>
                    </entry>
                </row>
                <row>
                    <entry>
                        <para>
                            CFME Appliance
                        </para>
                    </entry>
                    <entry>
                        <para>
                            RHOS (Neutron)
                        </para>
                    </entry>
                    <entry>
                        <para>
                            HTTP REST API
                        </para>
                    </entry>
                    <entry>
                        <para>
                            9696
                        </para>
                    </entry>
                    <entry>
                        <para />
                    </entry>
                    <entry>
                        <para>
                            Networking
                        </para>
                    </entry>
                </row>
                <row>
                    <entry>
                        <para>
                            CFME Appliance
                        </para>
                    </entry>
                    <entry>
                        <para>
                            RHOS (Cinder)
                        </para>
                    </entry>
                    <entry>
                        <para>
                            HTTP REST API
                        </para>
                    </entry>
                    <entry>
                        <para>
                            8776
                        </para>
                    </entry>
                    <entry>
                        <para />
                    </entry>
                    <entry>
                        <para>
                            Block Storage
                        </para>
                    </entry>
                </row>
            </tbody>
        </tgroup>
    </table>
    <table frame="all">
        <title>VMware vSphere Ports Used by CloudForms Management Engine</title>
        <tgroup cols="6">
            <colspec colwidth="4*" />
            <colspec colwidth="2*" />
            <colspec colwidth="2*" />
            <colspec colwidth="2*" />
            <colspec colwidth="2*" />
            <colspec colwidth="4*" />
            <thead>
                <row>
                    <entry>
                        <para>
                            Initiator (CFME Role if applicable)
                        </para>
                    </entry>
                    <entry>
                        <para>
                            Receiver (CFME Role if applicable)
                        </para>
                    </entry>
                    <entry>
                        <para>
                            Application
                        </para>
                    </entry>
                    <entry>
                        <para>
                            TCP Port
                        </para>
                    </entry>
                    <entry>
                        <para>
                            UDP Port
                        </para>
                    </entry>
                    <entry>
                        <para>
                            Purpose/Reason
                        </para>
                    </entry>
                </row>
            </thead>
            <tbody>
                <row>
                    <entry>
                        <para>
                            CFME Appliance(Management System Inventory, Management System Operations, C &amp; U Data Collection, SmartProxy)
                        </para>
                    </entry>
                    <entry>
                        <para>
                            vCenter
                        </para>
                    </entry>
                    <entry>
                        <para>
                            HTTPS
                        </para>
                    </entry>
                    <entry>
                        <para>
                            443
                        </para>
                    </entry>
                    <entry>
                        <para />
                    </entry>
                    <entry>
                        <para>
                            CFME Appliance running any of these roles will initiate communication with vCenter on this port.
                        </para>
                    </entry>
                </row>
                <row>
                    <entry>
                        <para>
                            CFME Appliance (SmartProxy)
                        </para>
                    </entry>
                    <entry>
                        <para>
                            ESX, ESXi Host
                        </para>
                    </entry>
                    <entry>
                        <para>
                            HTTPS
                        </para>
                    </entry>
                    <entry>
                        <para>
                            443
                        </para>
                    </entry>
                    <entry>
                        <para />
                    </entry>
                    <entry>
                        <para>
                            CFME Appliance
                        </para>
                    </entry>
                </row>
                <row>
                    <entry>
                        <para>
                            CFME Appliance (SmartProxy)
                        </para>
                    </entry>
                    <entry>
                        <para>
                            ESX Hosts(if analyzing VMs through Host)
                        </para>
                    </entry>
                    <entry>
                        <para>
                            SOAP over HTTPS
                        </para>
                    </entry>
                    <entry>
                        <para>
                            902
                        </para>
                    </entry>
                    <entry>
                        <para />
                    </entry>
                    <entry>
                        <para>
                            Communication from CFME Appliance to Hosts.
                        </para>
                    </entry>
                </row>
                <row>
                    <entry>
                        <para>
                            CFME Appliance (SmartProxy)
                        </para>
                    </entry>
                    <entry>
                        <para>
                            vCenter (if analyzing VMs through VC)
                        </para>
                    </entry>
                    <entry>
                        <para>
                            SOAP over HTTPS
                        </para>
                    </entry>
                    <entry>
                        <para>
                            902
                        </para>
                    </entry>
                    <entry>
                        <para />
                    </entry>
                    <entry>
                        <para>
                            Communication from CFME Appliance to vCenters.
                        </para>
                    </entry>
                </row>
                <row>
                    <entry>
                        <para>
                            CFME Appliance(SmartProxy)
                        </para>
                    </entry>
                    <entry>
                        <para>
                            ESX Hosts (not needed for ESXi)
                        </para>
                    </entry>
                    <entry>
                        <para>
                            SSH
                        </para>
                    </entry>
                    <entry>
                        <para>
                            22
                        </para>
                    </entry>
                    <entry>
                        <para />
                    </entry>
                    <entry>
                        <para>
                            CFME Appliance console access (ssh) to ESX hosts
                        </para>
                    </entry>
                </row>
            </tbody>
        </tgroup>
    </table>
    <important>
        <para>
            To provide your Red Hat CloudForms infrastructure with an extra layer of security, use a network layer firewall to restrict port access.
        </para>
    </important>
</section>
