<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "../Settings_and_Operations_Guide.ent">
%BOOK_ENTITIES;
]>
<section id="External_Authentication_httpd" remap="TID_41924">
	<title>External Authentication (httpd)</title>
	<para>
		When external authentication is enabled, users can log in to the CloudForms Management Engine appliance using their IPA server credentials. The appliance creates user accounts automatically and imports relevant information from the IPA Server.
	</para>
	<para>
		The appliance contains IPA client software for connecting to IPA servers, but it is not configured by default. External authentication is enabled by first configuring it in the web interface, then in the console. Disabling external authentication and returning to internal database authentication also requires steps in both the web interface and the console.
	</para>
	<formalpara>
		<title>Requirements</title>
		<para>
			<itemizedlist>
				<listitem>
					<para>
						For an appliance to leverage an IPA Server on the network, both the appliance and the IPA server must have their clocks synchronized or Kerberos and LDAP authentication fail.
					</para>
				</listitem>
				<listitem>
					<para>
						The IPA Server must be known by DNS and accessible by name. If DNS is not configured accordingly, the hosts files need to be updated to reflect both IPA server and the appliance on both virtual machines.
					</para>
				</listitem>
				<listitem>
					<para>
						For users to log in to the appliance using IPA server credentials, they must be members of at least one group on the IPA server which is also defined in the appliance. Navigate to <menuchoice><guimenu>Configure</guimenu><guisubmenu>Configuration</guisubmenu><guisubmenu>Access Control</guisubmenu><guisubmenu>Groups</guisubmenu></menuchoice> to administer groups.
					</para>
				</listitem>
			</itemizedlist>
		</para>
	</formalpara>
	<formalpara>
		<title>Configuring Appliance for External Authentication</title>
		<para>
			To configure the appliance for external authentication, first set up authentication using the web interface, then using the console.
		</para>
	</formalpara>
	<procedure>
		<title>Web Interface</title>
		<step>
			<para>
				Log in to the web interface as an administrative user.
			</para>
		</step>
		<step>
			<para>
				Navigate to <menuchoice><guimenu>Configure</guimenu><guisubmenu>Configuration</guisubmenu><guisubmenu>Zone</guisubmenu><guisubmenu>Server</guisubmenu><guisubmenu>NTP Servers</guisubmenu></menuchoice> or use the hosting provider of the virtual machine to synchronize the appliance's time with an NTP server.
			</para>
		</step>
		<step>
			<para>
				Navigate to <menuchoice><guimenu>Configure</guimenu><guisubmenu>Configuration</guisubmenu><guisubmenu>Authentication</guisubmenu></menuchoice>.
			</para>
		</step>
		<step>
			<para>
				Select a <guilabel>Session Timeout</guilabel> if required.
			</para>
		</step>
		<step>
			<para>
				Select <literal>External (httpd)</literal> in the <guilabel>Mode</guilabel> list.
			</para>
		</step>
		<step>
			<para>
				Select <guibutton>Enable Single Sign-On</guibutton> to allow single sign-on using Kerberos tickets from client machines that authenticate to the same IPA server as the appliance.
			</para>
		</step>
		<step>
			<para>
				In the <guilabel>Role Settings</guilabel> area, select <guilabel>Get User Groups from External Authentication (https)</guilabel>.
			</para>
		</step>
		<step>
			<para>
				Click <guibutton>Save</guibutton>.
			</para>
		</step>
	</procedure>
	<procedure>
		<title>Console</title>
		<step>
			<para>
				Log in to the appliance console using the user name <literal>admin</literal>.
			</para>
		</step>
		<step>
			<para>
				The summary screen displays: 
				<screen>External Auth:  not configured</screen> Press <userinput>Enter</userinput>.
			</para>
		</step>
		<step>
			<para>
				Enter <userinput>10</userinput> to select <literal>Configure External Authentication (httpd)</literal>.
			</para>
		</step>
		<step>
			<para>
				Enter the fully qualified hostname of the IPA Server, for example <literal>ipaserver.test.company.com</literal>.
			</para>
		</step>
		<step>
			<para>
				Enter the IPA server domain, for example <literal>test.company.com</literal>.
			</para>
		</step>
		<step>
			<para>
				Enter the IPA server realm, for example <literal>TEST.COMPANY.COM</literal>.
			</para>
		</step>
		<step>
			<para>
				Enter the IPA server principal, for example <literal>admin</literal>.
			</para>
		</step>
		<step>
			<para>
				Enter the password of the IPA server principal.
			</para>
		</step>
		<step>
			<para>
				Enter <userinput>y</userinput> to proceed.
			</para>
		</step>
	</procedure>
	<note>
		<para>
			If any of the following conditions are true, configuration fails: 
			<itemizedlist>
				<listitem>
					<para>
						The IPA server is not reachable by its FQDN
					</para>
				</listitem>
				<listitem>
					<para>
						The IPA server cannot reach the appliance by its FQDN
					</para>
				</listitem>
				<listitem>
					<para>
						The time is not synchronized between the appliance and the IPA server
					</para>
				</listitem>
				<listitem>
					<para>
						The IPA server <literal>admin</literal> password is entered incorrectly
					</para>
				</listitem>
			</itemizedlist>
		</para>
	</note>
	<formalpara>
		<title>Reverting to Internal Database Authentication</title>
		<para>
			To revert to internal database authentication, first configure authentication using the web interface, then using the console.
		</para>
	</formalpara>
	<procedure>
		<title>Web Interface</title>
		<step>
			<para>
				Log in to the web interface as an administrative user.
			</para>
		</step>
		<step>
			<para>
				Navigate to <menuchoice><guimenu>Configure</guimenu><guisubmenu>Configuration</guisubmenu><guisubmenu>Authentication</guisubmenu></menuchoice>.
			</para>
		</step>
		<step>
			<para>
				Select <literal>Database</literal> in the <guilabel>Mode</guilabel> list.
			</para>
		</step>
		<step>
			<para>
				Click <guibutton>Save</guibutton>.
			</para>
		</step>
	</procedure>
	<procedure>
		<title>Console</title>
		<step>
			<para>
				Log in to the appliance console using the user name <literal>admin</literal>.
			</para>
		</step>
		<step>
			<para>
				The summary screen displays: 
				<screen>External Auth:  IPA.server.FQDN</screen> Press <userinput>Enter</userinput>.
			</para>
		</step>
		<step>
			<para>
				Enter <userinput>10</userinput> to select <literal>Configure External Authentication (httpd)</literal>. The currently configured IPA server hostname and domain are displayed.
			</para>
		</step>
		<step>
			<para>
				Enter <userinput>y</userinput> to un-configure the IPA client.
			</para>
		</step>
	</procedure>
	<formalpara>
		<title>Optional Configuration Using the Appliance Console CLI</title>
		<para>
			In addition to using the appliance console, external authentication can optionally be configured and un-configured using the appliance console command line interface.
		</para>
	</formalpara>
	<para>
		Appliance console CLI command and relevant options include:
	</para>
	<programlisting>
/bin/appliance_console_cli --host &lt;appliance_fqdn&gt;
                           --ipaserver &lt;ipa_server_fqdn&gt;
                           --iparealm &lt;realm_of_ipa_server&gt;
                           --ipaprincipal &lt;ipa_server_principal&gt;
                           --ipapassword &lt;ipa_server_password&gt;
                           --uninstall-ipa
</programlisting>
	<variablelist>
		<varlistentry>
			<term>--host</term>
			<listitem>
				<para>
					updates the hostname of the appliance. If you performed this step using the console and made the necessary updates made to <filename>/etc/hosts</filename> if DNS is not properly configured, you can omit the <option>--host</option> option.
				</para>
			</listitem>
		</varlistentry>
		<varlistentry>
			<term>--iparealm</term>
			<listitem>
				<para>
					if omitted, the <literal>iparealm</literal> is based on the domain name of the ipaserver.
				</para>
			</listitem>
		</varlistentry>
		<varlistentry>
			<term>--ipaprincipal</term>
			<listitem>
				<para>
					if omitted, defaults to <literal>admin</literal>.
				</para>
			</listitem>
		</varlistentry>
	</variablelist>
	<example>
		<title>Configuring External Authentication</title>
		<screen>$ ssh root@appliance.test.company.com
[appliance]# /bin/appliance_console_cli --host appliance.test.company.com \
                                      --ipaserver ipaserver.test.company.com \
                                      --iparealm TEST.COMPANY.COM \
                                      --ipaprincipal admin \
                                      --ipapassword smartvm1
</screen>
	</example>
	<example>
		<title>Reverting to Internal Database Authentication</title>
		<screen>$ ssh root@appliance.test.company.com
[appliance]# /bin/appliance_console_cli --uninstall-ipa
</screen>
	</example>
</section>