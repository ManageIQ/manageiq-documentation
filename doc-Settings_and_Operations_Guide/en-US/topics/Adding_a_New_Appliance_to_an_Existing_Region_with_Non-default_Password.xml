<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "../Settings_and_Operations_Guide.ent">
%BOOK_ENTITIES;
]>
<section id="Adding_a_New_Appliance_to_an_Existing_Region_with_Non-default_Password" remap="TID_42027">
	<title>Adding a New Appliance to an Existing Region with Non-default Password</title>
	<procedure>
		<step>
			<para>
				Create the new appliance.
			</para>
		</step>
		<step>
			<para>
				Start it, but do not go into any of the configuration options, instead <command>SSH</command> into the new appliance.
			</para>
		</step>
		<step>
			<para>
				In the <filename>/var/www/miq/vmdb</filename> directory create a file called REGION. Its only contents should be the number of the Region that it is joining. (You could also just copy the REGION file from the VMDB Appliance.)
			</para>
		</step>
		<step>
			<para>
				Edit the <filename>database.yml</filename> file in the <filename>/var/www/miq/vmdb</filename> directory. (You may want to save off the original.) 
				<itemizedlist>
					<listitem>
						<para>
							Replace the contents of the <literal>"production"</literal> section with the contents of the <literal>"base"</literal> section.
						</para>
					</listitem>
					<listitem>
						<para>
							Edit the <literal>"host"</literal> parameter to match IP of the appliance hosting the VMDB.
						</para>
					</listitem>
					<listitem>
						<para>
							Save the new <filename>database.yml</filename>.
						</para>
					</listitem>
					<listitem>
						<para>
							Run the following command to change the password in the configuration file that emserverd uses to access the server: 
							<screen>/var/www/miq/vmdb/tools/fix_auth.rb --databaseyml --password newpassword
</screen>
						</para>
					</listitem>
				</itemizedlist>
			</para>
		</step>
		<step>
			<para>
				Restart the new worker appliance by typing: 
				<screen>service evmserverd restart</screen>
			</para>
		</step>
	</procedure>
</section>