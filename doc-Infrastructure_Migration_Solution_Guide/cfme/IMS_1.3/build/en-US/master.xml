<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE book [
<!ENTITY % sgml.features "IGNORE">
<!ENTITY % xml.features "INCLUDE">
<!ENTITY % DOCBOOK_ENTS PUBLIC "-//OASIS//ENTITIES DocBook Character Entities V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/dbcentx.mod">
%DOCBOOK_ENTS;
]>
<?asciidoc-toc maxdepth="3"?><book xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0">
<info>
<title>Infrastructure Migration Solution Guide</title><subtitle>Migrating from VMware to Red Hat Virtualization or Red Hat OpenStack Platform</subtitle>

<date>2019-09-16</date>
<productname>Red Hat Infrastructure Migration Solution</productname>
<productnumber>1.3</productnumber>
<abstract>
    <para>This guide describes how to migrate VMware virtual machines to Red Hat Virtualization 4.3 or Red Hat OpenStack Platform 13 or 14, using Red Hat CloudForms 5.0.</para>
</abstract>
<xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="Author_Group.xml"/>
</info>
<preface>
<title>Preface</title>
<simpara>Red Hat Infrastructure Migration Solution (IMS) 1.3 enables you to migrate virtual machines from VMware 5.5 (and later) to  Red Hat Virtualization or Red Hat OpenStack Platform, using Red Hat CloudForms:</simpara>
<variablelist>
<varlistentry>
<term>Red Hat Virtualization 4.3</term>
<listitem>
<simpara>Red Hat Virtualization provides a virtualization platform built on Red Hat Enterprise Linux. You can manage your virtual infrastructure, including hosts, virtual machines, networks, storage, and users, from a centralized graphical user interface or with a REST API. See <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.3/">Red Hat Virtualization 4.3</link> documentation for more information.</simpara>
<simpara>See <xref linkend="Migrating_from_vmware_to_rhv"/>.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>Red Hat OpenStack Platform 13 and 14</term>
<listitem>
<simpara>Red Hat OpenStack Platform provides a scaleable, fault-tolerant, private or public cloud based on Red Hat Enterprise Linux. See <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/14">Red Hat OpenStack Platform 13</link> or <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/14">Red Hat OpenStack Platform 14</link> documentation for more information.</simpara>
<simpara>See <xref linkend="Migrating_from_vmware_to_osp"/>.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>Red Hat CloudForms 5.0</term>
<listitem>
<simpara>Red Hat CloudForms is the environment in which you perform the migration. Red Hat CloudForms is a unified set of management tools for use across virtualized, private cloud, and public cloud platforms. See <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_cloudforms/5.0">Red Hat CloudForms 5.0</link> documentation for more information.</simpara>
</listitem>
</varlistentry>
</variablelist>
</preface>
<part xml:id="Migrating_from_vmware_to_rhv">
<title>Migrating from VMware to Red Hat Virtualization</title>
<partintro>
<simpara>The migration process involves the following tasks:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Planning the migration. See <xref linkend="Planning_the_migration_rhv"/>.</simpara>
</listitem>
<listitem>
<simpara>Preparing the VMware, Red Hat Virtualization, and CloudForms environments. See <xref linkend="Preparing_the_environment_for_migration_to_rhv"/>.</simpara>
</listitem>
<listitem>
<simpara>Migrating the virtual machines. See <xref linkend="Migrating_the_virtual_machines_rhv"/>.</simpara>
</listitem>
<listitem>
<simpara>Troubleshooting, if necessary. See <xref linkend="Troubleshooting_rhv"/>.</simpara>
</listitem>
</orderedlist>
</partintro>
<chapter xml:id="Planning_the_migration_rhv">
<title>Planning the migration</title>
<simpara>During the planning phase, you will formulate a specific migration goal, for example, "I want to migrate 2000 virtual machines, with 200 TB of data, in less than 6 months".</simpara>
<simpara>Review the following information to plan your migration:</simpara>
<itemizedlist>
<listitem>
<simpara><xref linkend="Questions_to_ask_before_migration_rhv"/> includes the following:</simpara>
<itemizedlist>
<listitem>
<simpara>What operating systems are supported?</simpara>
</listitem>
<listitem>
<simpara>How long will the migration take?</simpara>
</listitem>
<listitem>
<simpara>How many conversion hosts do I need?</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara><xref linkend="Recommendations_for_migration_rhv"/> provides guidelines on the following topics:</simpara>
<itemizedlist>
<listitem>
<simpara>Scheduling the migration</simpara>
</listitem>
<listitem>
<simpara>Distributing the workload</simpara>
</listitem>
<listitem>
<simpara>Deploying the conversion hosts</simpara>
</listitem>
<listitem>
<simpara>Controlling the migration process</simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
<simpara>The migration workflow describes the migration process in greater detail.</simpara>
<figure xml:id="Vmware_to_rhv_migration_workflow">
<title>VMware to Red Hat Virtualization migration workflow</title>
<mediaobject>
<imageobject>
<imagedata fileref="images/vmware_to_rhv_migration_workflow.png"/>
</imageobject>
<textobject><phrase>vmware to rhv migration workflow</phrase></textobject>
</mediaobject>
</figure>
<simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/circle_step_numbers/1.png" contentwidth="25"/>
</imageobject>
<textobject><phrase>25</phrase></textobject>
</inlinemediaobject> You create and run a migration plan in CloudForms.</simpara>
<simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/circle_step_numbers/2.png" contentwidth="25"/>
</imageobject>
<textobject><phrase>25</phrase></textobject>
</inlinemediaobject> CloudForms uses the migration plan to locate the source virtual machines.</simpara>
<simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/circle_step_numbers/3.png" contentwidth="25"/>
</imageobject>
<textobject><phrase>25</phrase></textobject>
</inlinemediaobject> CloudForms captures the ESXi host fingerprint for authentication during the virtual machine conversion process.</simpara>
<simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/circle_step_numbers/4.png" contentwidth="25"/>
</imageobject>
<textobject><phrase>25</phrase></textobject>
</inlinemediaobject> Using the attributes defined for the Red Hat Virtualization environment, CloudForms initiates communication with the conversion hosts (Red Hat Virtualization hosts with <literal>virt-v2v</literal> and <literal>virt-v2v-wrapper</literal> installed).</simpara>
<simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/circle_step_numbers/5.png" contentwidth="25"/>
</imageobject>
<textobject><phrase>25</phrase></textobject>
</inlinemediaobject> <literal>virt-v2v-wrapper</literal> connects to the source datastore through the ESXi host. <literal>virt-v2v</literal> streams the source disks to the target data domain and converts the source disks.</simpara>
<simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/circle_step_numbers/6.png" contentwidth="25"/>
</imageobject>
<textobject><phrase>25</phrase></textobject>
</inlinemediaobject> <literal>virt-v2v-wrapper</literal> creates a target Red Hat Virtualization virtual machine, using the source virtual machine’s metadata in order to maintain its attributes (tags, power state, MAC address, CPU count, memory, disks, and virtual machine name) after migration.</simpara>
<simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/circle_step_numbers/7.png" contentwidth="25"/>
</imageobject>
<textobject><phrase>25</phrase></textobject>
</inlinemediaobject> <literal>virt-v2v</literal> attaches the converted disks to the Red Hat Virtualization virtual machine. (The virtual machine’s power state is the same as the source virtual machine’s power state.)</simpara>
<simpara>The migration process is complete and the migration plan’s status is displayed in CloudForms.</simpara>
<section xml:id="Questions_to_ask_before_migration_rhv">
<title>Questions to ask before migration</title>
<simpara>The following questions can help you to estimate the resources and time required for migration.</simpara>
<variablelist>
<varlistentry>
<term>What am I migrating?</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>Identify the VMware virtual machines that you will be migrating.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>What is the maximum number of disks or virtual machines that I can migrate?</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>There is no maximum number of disks or virtual machines that you can migrate. However, you may not want to migrate all your virtual machines at the same time, in order to minimize the impact on your users.</simpara>
<important>
<simpara>If you exceed the capabilities of your environment, the migrations will fail. This situation could affect existing applications running on virtual machines attached to the network and storage.</simpara>
</important>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>What operating systems can I migrate?</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>You can migrate any guest operating system that is certified and supported for use with the Red Hat Virtualization Hypervisor. See <link xlink:href="https://access.redhat.com/articles/973163">Certified Guest Operating Systems in Red Hat OpenStack Platform and Red Hat Virtualization</link>.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>What am I missing?</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>Identify resource gaps, such as bandwidth, storage, licenses, or a suitable maintenance window, before you begin the migration.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>What impact will the migration have on my users?</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>Assess the effects the migration may have on a production environment.</simpara>
<simpara>It may be possible to migrate your applications in phases, without downtime at the application layer, if the applications are distributed in a high-availability architecture.</simpara>
</listitem>
<listitem>
<simpara>Check whether users will lose access to critical applications.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>How long will the migration take?</term>
<listitem>
<simpara>There is no formula to estimate how long the actual migration will take. This is determined on a case-by-case basis.</simpara>
<simpara>The following example is provided as a guide:</simpara>
<example>
<title>Red Hat Virtualization migration</title>
<itemizedlist>
<listitem>
<simpara>Duration of migration: 1:15:53 (hh:mm:ss)</simpara>
</listitem>
<listitem>
<simpara>10 virtual machines</simpara>
</listitem>
<listitem>
<simpara>Total data migrated: 1000 GB</simpara>
</listitem>
<listitem>
<simpara>Hardware:</simpara>
<itemizedlist>
<listitem>
<simpara>Strong host (40 cores, 500 GB RAM)</simpara>
</listitem>
<listitem>
<simpara>Fast SSD XtremIO storage</simpara>
</listitem>
<listitem>
<simpara>Fibre Channel 8 interface for host-to-storage connection</simpara>
</listitem>
<listitem>
<simpara>10 GbE network interface cards for all other connections</simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
</example>
</listitem>
</varlistentry>
<varlistentry>
<term>How many conversion hosts do I need?</term>
<listitem>
<simpara>The number of conversion hosts you create depends on the size of your migration. All the virtual machines in a migration plan are migrated at the same time, in parallel. The number of virtual machines that you can migrate simultaneously depends on your infrastructure capabilities. Each migration requires a certain amount of network bandwidth, I/O throughput, and processing power for the conversion process.</simpara>
<simpara>Multiple conversion hosts provide load-balancing and better performance, even for small migrations.</simpara>
<simpara>Conversion hosts are limited to a maximum of ten concurrent migrations, unless you change the default values.</simpara>
<simpara>You should test your environment thoroughly before the migration to determine how many migrations it can support without negative effects, for example, five conversion hosts, each running ten concurrent migrations.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>Should I migrate my virtual machines with VDDK or SSH?</term>
<listitem>
<simpara>You can migrate your virtual machines with either the VMware Virtual Disk Development Kit (VDDK) or SSH. VDDK is the default because it is much faster than SSH and easier to configure.</simpara>
<simpara>VDDK is limited to 20 concurrent migrations per conversion host, because of network limitations, and 10 concurrent migrations per VMware hypervisor, unless you increase the hypervisor’s NFC service memory.</simpara>
<simpara>If you cannot use VDDK, SSH transformation is a fallback option.</simpara>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="Recommendations_for_migration_rhv">
<title>Recommendations and best practices</title>
<simpara>The following recommendations will help to minimize the impact of the migration on your environment.</simpara>
<itemizedlist>
<title>Scheduling the migration</title>
<listitem>
<simpara>Schedule your migration carefully, to minimize the impact on your users.</simpara>
</listitem>
<listitem>
<simpara>Prepare your users for downtime.</simpara>
</listitem>
<listitem>
<simpara>Stagger the migration schedules.</simpara>
</listitem>
<listitem>
<simpara>Move critical applications during maintenance windows.</simpara>
</listitem>
</itemizedlist>
<itemizedlist>
<title>Distributing the migration workload</title>
<listitem>
<simpara>Create migration groups, so that you are not migrating all of your virtual machines at the same time, keeping in mind the following considerations:</simpara>
<itemizedlist>
<listitem>
<simpara>How are the virtual machines grouped now?</simpara>
</listitem>
<listitem>
<simpara>Which virtual machines should be migrated together?</simpara>
</listitem>
<listitem>
<simpara>Which workloads or linked applications should be migrated together?</simpara>
</listitem>
<listitem>
<simpara>What applications must remain available?</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Consider which parts of the workload to migrate first:</simpara>
<itemizedlist>
<listitem>
<simpara>Databases</simpara>
</listitem>
<listitem>
<simpara>Applications</simpara>
</listitem>
<listitem>
<simpara>Web servers</simpara>
</listitem>
<listitem>
<simpara>Load balancers</simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
<itemizedlist>
<title>Deploying the conversion hosts</title>
<listitem>
<simpara>Create a sufficient number of conversion hosts for your migration, with sufficient resources.</simpara>
</listitem>
<listitem>
<simpara>Create multiple conversion hosts for load-balancing. The virtual machines in a migration plan are automatically distributed among the conversion hosts. This decreases the load on the conversion hosts and allows you to increase the concurrent migrations beyond the limits of a single conversion host.</simpara>
</listitem>
</itemizedlist>
<itemizedlist>
<title>Controlling the migration process</title>
<listitem>
<simpara>Create multiple migration plans for finer control.</simpara>
</listitem>
<listitem>
<simpara>Perform test migrations with different maximum numbers of concurrent migrations to assess the capabilities of your environment’s infrastructure.</simpara>
</listitem>
</itemizedlist>
</section>
</chapter>
<chapter xml:id="Preparing_the_environment_for_migration_to_rhv">
<title>Preparing the environment for migration</title>
<simpara>Preparing your environment for migration involves the following tasks:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Preparing the VMware environment. See <xref linkend="Preparing_the_vmware_environment_for_rhv"/>.</simpara>
</listitem>
<listitem>
<simpara>Preparing the target environment. See <xref linkend="Preparing_the_1_3_rhv_environment"/>.</simpara>
</listitem>
<listitem>
<simpara>Configuring the conversion hosts. See <xref linkend="Configuring_the_1_2_rhv_conversion_hosts_for_vddk"/>.</simpara>
</listitem>
</orderedlist>
<note>
<simpara>The virtual disks are converted with the VMware Virtual Disk Development Kit (VDDK). If you cannot use VDDK, SSH transformation is a fallback option. See <xref linkend="Configuring_the_rhv_environment_for_ssh_transformation"/>.</simpara>
</note>
<section xml:id="Preparing_the_vmware_environment_for_rhv">
<title>Preparing the VMware environment</title>
<simpara>Preparing the VMware environment for migration involves the following tasks:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Extending the VMware network. See <xref linkend="Preparing_the_vmware_network_rhv"/>.</simpara>
</listitem>
<listitem>
<simpara>Preparing the VMware virtual machines. See <xref linkend="Preparing_the_vmware_virtual_machines_for_rhv"/>.</simpara>
</listitem>
<listitem>
<simpara>(Optional) Configuring a VMware hypervisor for more than ten concurrent migrations from that hypervisor. See <xref linkend="Configuring_vmware_hypervisor_for_more_than_10_concurrent_vddk_migrations_rhv"/>.</simpara>
</listitem>
</orderedlist>
<section xml:id="Preparing_the_vmware_network_rhv">
<title>Preparing the VMware network</title>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Extend the VMware network to the Red Hat Virtualization environment.</simpara>
</listitem>
<listitem>
<simpara>Ensure that the VMware network provides high throughput (10 GbE) and does not affect production virtual machines (for example, a backup network).</simpara>
</listitem>
</orderedlist>
<important>
<itemizedlist>
<listitem>
<simpara>The network configuration must not be changed in any way during the migration.</simpara>
</listitem>
<listitem>
<simpara>IP addresses, VLANs, and other network configuration must not be changed before or after migration because the conversion process preserves the source virtual machine MAC addresses.</simpara>
</listitem>
</itemizedlist>
</important>
</section>
<section xml:id="Preparing_the_vmware_virtual_machines_for_rhv">
<title>Preparing the VMware virtual machines</title>
<simpara>Perform the following steps on each VMware virtual machine that you are migrating:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Install VMware Tools to capture IP addresses.</simpara>
<simpara>To download and install VMware Tools, see <link xlink:href="https://www.vmware.com/support/ws5/doc/new_guest_tools_ws.html">VMware Workstation 5.0: Installing VMware Tools</link>.</simpara>
</listitem>
<listitem>
<simpara>Unmount mounted ISO/CDROM disks.</simpara>
</listitem>
<listitem>
<simpara>Ensure that attached disks are not encrypted.</simpara>
</listitem>
<listitem>
<simpara>Ensure that each NIC has no more than one IPv4 and/or one IPv6 address.</simpara>
</listitem>
<listitem>
<simpara>Ensure that the virtual machine names contain only upper- or lower-case letters, numbers, underscores (<literal>_</literal>), hyphens (<literal>-</literal>), or periods (<literal>.</literal>).</simpara>
<note>
<simpara>International characters and spaces are not permitted.</simpara>
</note>
</listitem>
<listitem>
<simpara>Ensure that the virtual machine names do not duplicate names of virtual machines in the Red Hat Virtualization environment.</simpara>
</listitem>
</orderedlist>
<simpara>If you are performing more than ten concurrent migrations from a VMware hypervisor, you must configure the hypervisor to support the additional connections. See <xref linkend="Configuring_vmware_hypervisor_for_more_than_10_concurrent_vddk_migrations_rhv"/>.</simpara>
</section>
<section xml:id="Configuring_vmware_hypervisor_for_more_than_10_concurrent_vddk_migrations_rhv">
<title>Configuring a VMware hypervisor for more than ten concurrent migrations</title>
<simpara>If you are performing more than ten concurrent migrations from a VMware hypervisor using VDDK transformation, the migration will fail because the hypervisor’s NFC service memory buffer is limited to ten parallel connections. See <link xlink:href="https://pubs.vmware.com/vsphere-6-5/topic/com.vmware.vddk.pg.doc/vddkDataStruct.5.5.html#1025227">VMware vSphere 6.5 NFC session connection limits</link> and <link xlink:href="http://libguestfs.org/virt-v2v.1.html#vddk:-esxi-nfc-service-memory-limits">Virt-v2v. VDDK: ESXi NFC service memory limits</link> for details.</simpara>
<simpara>You can increase the hypervisor’s NFC service memory to enable additional connections for migrations.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Log in to a VMware hypervisor.</simpara>
</listitem>
<listitem>
<simpara>Change the value of <literal>maxMemory</literal> to <literal>1000000000</literal> in <literal>/etc/vmware/hostd/config.xml</literal>:</simpara>
<screen>      &lt;nfcsvc&gt;
         &lt;path&gt;libnfcsvc.so&lt;/path&gt;
         &lt;enabled&gt;true&lt;/enabled&gt;
         &lt;maxMemory&gt;1000000000&lt;/maxMemory&gt;
         &lt;maxStreamMemory&gt;10485760&lt;/maxStreamMemory&gt;
      &lt;/nfcsvc&gt;</screen>
</listitem>
<listitem>
<simpara>Restart <literal>hostd</literal>:</simpara>
<screen># /etc/init.d/hostd restart</screen>
<simpara>You do not need to reboot the VMware hypervisor.</simpara>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="Preparing_the_1_3_rhv_environment">
<title>Preparing the Red Hat Virtualization environment</title>
<simpara>Preparing the Red Hat Virtualization environment involves the following key steps:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Installing and configuring Red Hat Virtualization 4.3. See <xref linkend="Installing_rhv_4_3"/>.</simpara>
</listitem>
<listitem>
<simpara>Installing and configuring CloudForms 5.0. See <xref linkend="Installing_cf_5_0_with_rhv"/>.</simpara>
</listitem>
</orderedlist>
<note>
<simpara>The virtual disks are converted with the VMware Virtual Disk Development Kit (VDDK). If you cannot use VDDK, SSH transformation is a fallback option. See <xref linkend="Configuring_the_rhv_environment_for_ssh_transformation"/>.</simpara>
</note>
<section xml:id="Target_prerequisites_rhv">
<title>Prerequisites</title>
<simpara>The following prerequisites apply:</simpara>
<itemizedlist>
<listitem>
<simpara>BIOS settings of physical hosts adjusted for optimal performance (rather than power-saving), according to the vendor’s recommendations</simpara>
</listitem>
<listitem>
<simpara>C1E halt state disabled, if applicable</simpara>
</listitem>
</itemizedlist>
<itemizedlist xml:id="ref_Software_compatibility_matrix_rhv" mark="discrete">
<listitem>
<simpara>Compatible software versions:</simpara>
<table frame="all" rowsep="1" colsep="1">
<title>Software compatibility</title>
<tgroup cols="4">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="25*"/>
<colspec colname="col_3" colwidth="25*"/>
<colspec colname="col_4" colwidth="25*"/>
<thead>
<row>
<entry align="left" valign="top">Software</entry>
<entry align="left" valign="top">IMS 1.1</entry>
<entry align="left" valign="top">IMS 1.2</entry>
<entry align="left" valign="top">IMS 1.3</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>VMware</simpara></entry>
<entry align="center" valign="top" namest="col_2" nameend="col_4"><simpara>5.5 or later</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Red Hat Virtualization</simpara></entry>
<entry align="left" valign="top"><simpara>4.2.8</simpara></entry>
<entry align="center" valign="top" namest="col_3" nameend="col_4"><simpara>4.3.4 or later</simpara></entry>
</row>
<row>
<entry align="left" valign="top" morerows="1"><simpara>CloudForms</simpara></entry>
<entry align="left" valign="top"><simpara>4.7.0, with CFME 5.10.3</simpara></entry>
<entry align="left" valign="top"><simpara>4.7.6, with CFME 5.10.5</simpara></entry>
<entry align="left" valign="top"><simpara>5.0, with CFME xxxx</simpara></entry>
</row>
<row>
<entry align="left" valign="top" namest="col_1" nameend="col_3"><simpara><emphasis role="strong">CFME 5.10.4 does not support migration.</emphasis>
You can use CFME 5.10.4 to manage the Red Hat Virtualization environment. Only the migration functionality is affected.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</listitem>
</itemizedlist>
</section>
<section xml:id="Installing_rhv_4_3">
<title>Installing and configuring Red Hat Virtualization 4.3</title>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Install Red Hat Virtualization Manager 4.3.4 on the Manager machine. See <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.3/html-single/installation_guide/#part-Installing_the_Red_Hat_Virtualization_Manager">Installing the Red Hat Virtualization Manager</link> in the <emphasis>Red Hat Virtualization Installation Guide</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Install Red Hat Virtualization Host 4.3.4 or Red Hat Enterprise Linux 7.6 on the host machines. See <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.3/html-single/installation_guide/#Installing_RHVH">Installing Red Hat Virtualization Host</link> or <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.3/html-single/installation_guide/#Red_Hat_Enterprise_Linux_Hosts">Installing Red Hat Enterprise Linux Hosts</link> in the <emphasis>Red Hat Virtualization Installation Guide</emphasis>.</simpara>
<note>
<simpara>Some of these hosts will be deployed as conversion hosts. The number of conversion hosts depends on your migration size and infrastructure capabilities.</simpara>
</note>
</listitem>
<listitem>
<simpara>Enable the following ports in the conversion host network:</simpara>
<itemizedlist>
<listitem>
<simpara>22 - SSH</simpara>
</listitem>
<listitem>
<simpara>443 - CloudForms, Red Hat Virtualization Manager, and VDDK</simpara>
</listitem>
<listitem>
<simpara>902 - CloudForms to VMware</simpara>
</listitem>
<listitem>
<simpara>5480 - Conversion hosts to vCenter</simpara>
<simpara>For details, see <link xlink:href="https://access.redhat.com/articles/417343">Ports used by Red Hat CloudForms Management Engine 5.1 and above</link>.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Create and attach data and ISO storage domains to the data center, ensuring that the data domains have sufficient space for the migrated virtual machines. See <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.3/html-single/administration_guide/#chap-Storage">Storage</link> in the <emphasis>Red Hat Virtualization Administration Guide</emphasis>.</simpara>
<note>
<simpara>IMS only supports shared storage, such as NFS, iSCSI, or FCP. Local storage is not supported.</simpara>
<simpara>Although the ISO storage domain has been deprecated in RHV 4.3, it is required for migration.</simpara>
</note>
</listitem>
<listitem>
<simpara>Upload the VirtIO and RHV Guest Tools image files to the ISO storage domain. See <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.3/html-single/administration_guide/#Uploading_the_VirtIO_and_Guest_Tool_Image_Files_to_an_ISO_Storage_Domain">Uploading the VirtIO and Guest Tool Image Files to an ISO Storage Domain</link> in the <emphasis>Red Hat Virtualization Administration Guide</emphasis>.</simpara>
<simpara>The VirtIO file name must include the version number (<literal>virtio-win-<emphasis>version</emphasis>.iso</literal>). The guest tools are required for migrating Windows virtual machines.</simpara>
</listitem>
<listitem>
<simpara>Optionally, you can create a MAC address pool that includes the MAC addresses of the VMware virtual machines to be migrated. See <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.3/html/administration_guide/sect-mac_address_pools#Creating_MAC_Address_Pools">Creating MAC Address Pools</link> in the <emphasis>Red Hat Virtualization Administration Guide</emphasis>.</simpara>
<important>
<simpara>If the Red Hat Virtualization MAC address pool range overlaps the VMware MAC address range, you must ensure that the MAC addresses of the migrating virtual machines do not duplicate those of existing virtual machines. Otherwise, the migration will fail.</simpara>
<simpara>If you do not create a MAC address pool, the migrated virtual machines will not have MAC addresses in the same range as virtual machines created in Red Hat Virtualization.</simpara>
</important>
</listitem>
</orderedlist>
</section>
<section xml:id="Installing_cf_5_0_with_rhv">
<title>Installing and configuring CloudForms 5.0</title>
<caution>
<simpara>Removing or changing a provider will cause errors in the infrastructure mappings and migration plans.</simpara>
</caution>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Install Red Hat CloudForms 5.0 or later on the Manager machine. See <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_cloudforms/5.0/html/installing_red_hat_cloudforms_on_red_hat_virtualization">Installing Red Hat CloudForms on Red Hat Virtualization</link>.</simpara>
<note>
<simpara>CFME 5.10.4 does not support migration.</simpara>
</note>
</listitem>
<listitem>
<simpara>Add VMware to CloudForms as a provider. See <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_cloudforms/5.0/html-single/managing_providers/#vmware_vcenter_providers">Adding a VMware vCenter Provider</link>.</simpara>
</listitem>
<listitem>
<simpara>Add Red Hat Virtualization to CloudForms as a provider. <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_cloudforms/5.0/html-single/managing_providers/#adding_a_red_hat_virtualization_provider">Adding a Red Hat Virtualization Provider</link> in <emphasis>Red Hat CloudForms: Managing Providers</emphasis>.</simpara>
</listitem>
</orderedlist>
<simpara>Configure your conversion hosts with CloudForms to use the VMware Virtual Disk Development Kit (VDDK).</simpara>
<note>
<simpara>The virtual disks are converted with the VMware Virtual Disk Development Kit (VDDK). If you cannot use VDDK, SSH transformation is a fallback option. See <xref linkend="Configuring_the_rhv_environment_for_ssh_transformation"/>.</simpara>
</note>
</section>
<section xml:id="Configuring_the_1_2_rhv_conversion_hosts_for_vddk">
<title>Configuring the conversion hosts</title>
<itemizedlist>
<title>Prerequisite</title>
<listitem>
<simpara>Download and save the VMware Virtual Disk Development Kit.</simpara>
</listitem>
</itemizedlist>
<bridgehead xml:id="Downloading_vddk_for_rhv" renderas="sect4">Downloading the VMware Virtual Disk Development Kit</bridgehead>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Navigate to <link xlink:href="https://www.vmware.com/support/pubs/">VMware Documentation</link>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">VMware SDK &amp; API Product Documentation</emphasis> to expand.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">VMware Virtual Disk Development Kit (VDDK)</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Latest Releases</emphasis> and select the latest VDDK release.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Download SDKs</emphasis> to download the VDDK archive file.</simpara>
</listitem>
<listitem>
<simpara>Save the VDDK archive file in an HTTP-accessible location and record its path.</simpara>
</listitem>
</orderedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>In CloudForms, click <menuchoice><guimenu>Compute</guimenu> <guisubmenu>Migration</guisubmenu> <guimenuitem>Migration Settings</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Conversion Hosts</emphasis> tab, click <emphasis role="strong">Configure Conversion Host</emphasis>. The <emphasis role="strong">Configure Conversion Host</emphasis> wizard is displayed.</simpara>
<simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/Conversion_host_configuration_ui.png"/>
</imageobject>
<textobject><phrase>Conversion host configuration ui</phrase></textobject>
</inlinemediaobject></simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Location</emphasis> screen, add the provider details:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Select a <emphasis role="strong">Provider Type</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select a <emphasis role="strong">Provider</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select a <emphasis role="strong">Cluster</emphasis> and click <emphasis role="strong">Next</emphasis>.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Host(s)</emphasis> screen, select one or more hosts from the dropdown list and click <emphasis role="strong">Next</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Authentication</emphasis> screen, add the conversion hosts' SSH key and the transformation method:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Click <emphasis role="strong">Browse</emphasis> to browse to the SSH private key or paste it in the <emphasis role="strong">Conversion host SSH private key</emphasis> field.</simpara>
<simpara>The Manager deploys a private SSH key on the conversion hosts in order to send commands and run playbooks. The default key file is <literal>/etc/pki/ovirt-engine/keys/engine_id_rsa</literal> on the Manager machine.</simpara>
</listitem>
<listitem>
<simpara>Select <emphasis role="strong">VDDK</emphasis> as the <emphasis role="strong">Transformation method</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Enter the path of the VDDK package in the <emphasis role="strong">VDDK library path</emphasis> field and click <emphasis role="strong">Validate</emphasis>. Wait for validation to complete.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Configure</emphasis>.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Results</emphasis> screen, wait for the conversion host configuration to finish and click <emphasis role="strong">Close</emphasis>.</simpara>
<simpara>The configured conversion hosts and status information, including error messages, appear in the <emphasis role="strong">Configured Conversion Hosts</emphasis> list.</simpara>
</listitem>
</orderedlist>
<simpara>If an error occurs, you can download a host’s log by clicking the <emphasis role="strong">More Actions</emphasis> icon (<inlinemediaobject>
<imageobject>
<imagedata fileref="images/More_actions_icon.png"/>
</imageobject>
<textobject><phrase>7</phrase></textobject>
</inlinemediaobject>) and selecting <emphasis role="strong">Download Log</emphasis>.</simpara>
<simpara>You can click the <emphasis role="strong">Retry</emphasis> button if the conversion host configuration failed for reasons unconnected with your environment.</simpara>
<simpara>(Optional) Click <emphasis role="strong">Remove</emphasis> to remove the configuration from a configured conversion host.</simpara>
<simpara>You can migrate your virtual machines.</simpara>
<simpara>(Optional) You can verify the conversion hosts in a browser. See <xref linkend="Verifying_rhv_conversion_hosts_in_browser"/>.</simpara>
</section>
<section xml:id="Verifying_rhv_conversion_hosts_in_browser">
<title>Verifying the conversion hosts in a browser</title>
<simpara>You can verify your conversion hosts in a browser by using the CloudForms API:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>In the address bar of a browser, enter the following:</simpara>
<screen>https://<emphasis>CloudForms_FQDN</emphasis>/api/conversion_hosts <co xml:id="CO1-1"/></screen>
<calloutlist>
<callout arearefs="CO1-1">
<para><literal>CloudForms_FQDN</literal> is the FQDN of the CloudForms machine.</para>
</callout>
</calloutlist>
<simpara>A log-in screen is displayed.</simpara>
</listitem>
<listitem>
<simpara>Enter your CloudForms <emphasis role="strong">Username</emphasis> and <emphasis role="strong">Password</emphasis> and click <emphasis role="strong">Sign in</emphasis>.</simpara>
<simpara>The conversion hosts and their IDs are displayed in JSON format:</simpara>
<screen>{"name":"conversion_hosts","count":3,"subcount":3,"pages":1,"resources":[{"href":"https://cloudforms.example.com/api/conversion_hosts/10000000000001"},{"href":"https://cloudforms.example.com/api/conversion_hosts/10000000000002"},{"href":"https://cloudforms.example.com/api/conversion_hosts/10000000000003"}],"actions":[{"name":"create","method":"post","href":"https://cloudforms.example.com/api/conversion_hosts"},{"name":"edit","method":"post","href":"https://cloudforms.example.com/api/conversion_hosts"},{"name":"delete","method":"post","href":"https://cloudforms.example.com/api/conversion_hosts"}],"links":{"self":"https://cloudforms.example.com/api/conversion_hosts?offset=0","first":"https://cloudforms.example.com/api/conversion_hosts?offset=0","last":"https://cloudforms.example.com/api/conversion_hosts?offset=0"}}</screen>
</listitem>
</orderedlist>
</section>
</section>
</chapter>
<chapter xml:id="Migrating_the_virtual_machines_rhv">
<title>Migrating the virtual machines</title>
<simpara>Migrating the virtual machines involves the following key tasks:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Mapping the resources of your VMware and Red Hat Virtualization environments. See <xref linkend="Creating_an_infrastructure_mapping_for_rhv"/>.</simpara>
</listitem>
<listitem>
<simpara>Checking for migration conditions with prerequisites. See <xref linkend="Checking_for_migration_prerequisites_rhv"/>.</simpara>
</listitem>
<listitem>
<simpara>Creating and running a migration plan. See <xref linkend="Creating_a_migration_plan_in_cloudforms_rhv"/>.</simpara>
</listitem>
</orderedlist>
<simpara>Optionally, you can change the maximum number of concurrent migrations for conversion hosts or providers to control the migration process.</simpara>
<section xml:id="Creating_an_infrastructure_mapping_for_rhv">
<title>Creating an infrastructure mapping</title>
<simpara>The infrastructure mapping maps the resources of your VMware and Red Hat Virtualization environments.</simpara>
<important>
<simpara>If you add or remove providers or provider objects from an infrastructure mapping, the mapping will have missing resource errors. You must delete the infrastructure mapping and create a new one.</simpara>
</important>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guisubmenu>Migration</guisubmenu> <guimenuitem>Infrastructure Mappings</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Create Infrastructure Mapping</emphasis>. The <emphasis role="strong">Create Infrastructure Mapping</emphasis> wizard is displayed.</simpara>
<simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/Creating_infrastructure_mapping.png"/>
</imageobject>
<textobject><phrase>Creating infrastructure mapping</phrase></textobject>
</inlinemediaobject></simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">General</emphasis> screen, add the infrastructure mapping details:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Enter the infrastructure mapping <emphasis role="strong">Name</emphasis> and (optional) <emphasis role="strong">Description</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Target Provider</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Next</emphasis>.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Map Compute</emphasis> screen, map the source and target clusters:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Select a <emphasis role="strong">Source Provider \ Datacenter \ Cluster</emphasis> and a <emphasis role="strong">Target Provider \ Datacenter \ Cluster</emphasis>.</simpara>
<simpara>If the target cluster does not contain a conversion host, a warning icon (<inlinemediaobject>
<imageobject>
<imagedata fileref="images/warning.png" contentdepth="15px"/>
</imageobject>
<textobject><phrase>warning</phrase></textobject>
</inlinemediaobject>) appears. You can create and save an infrastructure mapping, but you must configure the conversion hosts before running a migration plan.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Add Mapping</emphasis>. You can map additional clusters.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Next</emphasis>.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Map Storage</emphasis> screen, map the source and target storage:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Select a <emphasis role="strong">Source Provider \ Datacenter \ Datastore</emphasis> and <emphasis role="strong">Target Datastores</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Add Mapping</emphasis>. You can map additional datastores.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Next</emphasis>.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Map Networks</emphasis> screen, map the source and target networks:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Select a source cluster from the drop-down list.</simpara>
</listitem>
<listitem>
<simpara>Select one or more networks from <emphasis role="strong">Source Provider \ Datacenter \ Network</emphasis> and <emphasis role="strong">Target Project \ Network</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Add Mapping</emphasis>. You can map the networks of additional source clusters.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Create</emphasis>.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Results</emphasis> screen, click <emphasis role="strong">Close</emphasis>. The infrastructure mapping is saved in <menuchoice><guimenu>Compute</guimenu> <guisubmenu>Migration</guisubmenu> <guimenuitem>Infrastructure Mappings</guimenuitem></menuchoice>.</simpara>
</listitem>
</orderedlist>
<simpara>You can click an infrastructure mapping element to view its details:</simpara>
<formalpara>
<title>Infrastructure Mappings list</title>
<para><inlinemediaobject>
<imageobject>
<imagedata fileref="images/Infra_mappings_list.png"/>
</imageobject>
<textobject><phrase>Infra mappings list</phrase></textobject>
</inlinemediaobject></para>
</formalpara>
<simpara>After you have created an infrastructure mapping, check for migration prerequisites.</simpara>
<simpara>If these conditions do not apply, you can create a migration plan. See <xref linkend="Creating_a_migration_plan_in_cloudforms_rhv"/>.</simpara>
</section>
<section xml:id="Checking_for_migration_prerequisites_rhv">
<title>Checking for migration prerequisites</title>
<simpara>Check your migration for the following conditions, which have prerequisites:</simpara>
<variablelist>
<varlistentry>
<term>You are migrating previously migrated virtual machines</term>
<listitem>
<simpara>Add previously migrated machines to the migration plan with a CSV file. A CSV file is also recommended for large migrations.</simpara>
<simpara>See <xref linkend="Creating_a_csv_file_to_add_virtual_machines_to_the_migration_plan_rhv"/>.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>You are using Ansible playbooks for premigration/postmigration tasks</term>
<listitem>
<simpara>Create an Ansible repository and add credentials and playbooks to CloudForms.</simpara>
<simpara>See <xref linkend="Adding_ansible_playbooks_to_cloudforms_rhv"/>.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>You are migrating virtual machines running RHEL or other Linux operating system</term>
<listitem>
<simpara>Create a RHEL premigration playbook to preserve IP addresses and select this playbook when you create a migration plan.</simpara>
<simpara>See <xref linkend="Adding_ansible_playbooks_to_cloudforms_rhv"/> and <xref linkend="Creating_a_rhel_premigration_playbook_rhv"/>.</simpara>
</listitem>
</varlistentry>
</variablelist>
<section xml:id="Creating_a_csv_file_to_add_virtual_machines_to_the_migration_plan_rhv">
<title>Creating a CSV file to add virtual machines to the migration plan</title>
<simpara>If you are migrating virtual machines that were migrated in the past, you should create a CSV file to add the virtual machines to the migration plan, because the migration plan cannot discover them automatically.</simpara>
<note>
<simpara>A CSV file is recommended for large migrations because it is faster than manually selecting individual virtual machines.</simpara>
</note>
<table frame="all" rowsep="1" colsep="1">
<title>CSV file fields</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="75*"/>
<thead>
<row>
<entry align="left" valign="top">Field</entry>
<entry align="left" valign="top">Comments</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>Name</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Virtual machine name. <emphasis role="strong">Required</emphasis></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>Host</literal></simpara></entry>
<entry align="left" valign="top"><simpara><emphasis role="strong">Optional</emphasis>. Only required if virtual machines have identical <literal>Name</literal> fields.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>Provider</literal></simpara></entry>
<entry align="left" valign="top"><simpara><emphasis role="strong">Optional</emphasis>. Only required if virtual machines have identical <literal>Name</literal> and <literal>Host</literal> fields.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<formalpara>
<title>CSV file example</title>
<para>
<screen>Name,Host,Provider
vm01,host1,vSphere3
vm02,host1,vSphere3
vm03,host1,vSphere3</screen>
</para>
</formalpara>
</section>
<section xml:id="Adding_ansible_playbooks_to_cloudforms_rhv">
<title>Adding Ansible playbooks to CloudForms for premigration and postmigration tasks</title>
<simpara>You can add Ansible playbooks to CloudForms to perform automated premigration and postmigration tasks on specific virtual machines, for example:</simpara>
<itemizedlist>
<listitem>
<simpara>Removing webservers from a load-balancing pool before migration and returning them to the pool after migration</simpara>
</listitem>
<listitem>
<simpara>Running <literal>fstrim</literal> after migration to reduce the space required by virtual machines migrating to Red Hat OpenStack Platform with Ceph storage</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Enable the <literal>Embedded Ansible</literal> server role in CloudForms. See <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_cloudforms/4.7/html/managing_providers/automation_management_providers#enabling-embedded-ansible-server-role">Enabling the Embedded Ansible Server Role</link> in <emphasis>Red Hat CloudForms: Managing Providers</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Add an Ansible playbook repository. See <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_cloudforms/4.7/html/managing_providers/automation_management_providers#adding-a-playbook-repository">Adding a Playbook Repository</link> in <emphasis>Red Hat CloudForms: Managing Providers</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Add the credentials of each virtual machine that you are migrating. See <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_cloudforms/4.7/html/managing_providers/automation_management_providers#ansible-credentials">Credentials</link> in <emphasis>Red Hat CloudForms: Managing Providers</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Add your playbook as an Ansible service catalog item. See <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_cloudforms/4.7/html-single/provisioning_virtual_machines_and_instances/#create-playbook-service-catalog-item">Creating an Ansible Playbook Service Catalog Item</link> in <emphasis>Red Hat CloudForms: Provisioning Virtual Machines and Instances</emphasis>.</simpara>
</listitem>
</orderedlist>
<simpara>You will select the playbooks and the virtual machines on which they run in the <emphasis role="strong">Advanced Options</emphasis> screen when you create the migration plan.</simpara>
</section>
<section xml:id="Creating_a_rhel_premigration_playbook_rhv">
<title>Creating a <literal>RHEL premigration</literal> playbook for RHEL/Linux source virtual machines</title>
<simpara>If you are migrating virtual machines running RHEL or other Linux operating system, you can create a <literal>RHEL premigration</literal> playbook to ensure that the IP addresses are accessible after migration. The <literal>RHEL premigration</literal> playbook calls the Ansible <literal>ims.rhel_premigration</literal> role.</simpara>
<simpara>To install the role with Ansible Galaxy, see <link xlink:href="https://galaxy.ansible.com/fdupont_redhat/ims_rhel_pre_migration">ims_rhel_pre_migration</link>. This role is not included in the IMS installation.</simpara>
<simpara>The <literal>ims.rhel_premigration</literal> role performs the following tasks on the VMware virtual machines:</simpara>
<itemizedlist>
<listitem>
<simpara>Preserves the static IP address configuration by creating udev rules to associate the virtual machine’s MAC address with its interface name</simpara>
</listitem>
<listitem>
<simpara>Installs the Red Hat Virtualization guest agent. The guest agent reports the new virtual machine’s IP address and installed applications to the Manager.</simpara>
</listitem>
</itemizedlist>
<note>
<simpara>The <literal>ims.rhel_premigration</literal> role assumes that either the <literal>rhel-6-server-rpms</literal> or the <literal>rhel-7-server-rpms</literal> repository is enabled in the source virtual machine when it installs <literal>qemu-guest-agent</literal>. If you have disabled the repository, re-enable it in the RHEL premigration playbook.</simpara>
</note>
<formalpara>
<title><literal>RHEL premigration</literal> playbook example</title>
<para>
<programlisting language="yml" linenumbering="unnumbered">---
- hosts: all
  roles:
    - role: ims.rhel_pre_migration</programlisting>
</para>
</formalpara>
<simpara>You can create a migration plan. See <xref linkend="Creating_a_migration_plan_in_cloudforms_rhv"/>.</simpara>
</section>
</section>
<section xml:id="Creating_a_migration_plan_in_cloudforms_rhv">
<title>Creating and running a migration plan</title>
<simpara>Before you perform a large migration, you should perform several test migrations with different maximum numbers of concurrent migrations for your conversion hosts or providers. This will enable you to assess the capabilities of your environment’s infrastructure.</simpara>
<simpara>You can create and run a migration plan in CloudForms with the following options:</simpara>
<itemizedlist>
<listitem>
<simpara>Running a migration plan immediately</simpara>
</listitem>
<listitem>
<simpara><link linkend="Scheduling_a_saved_migration_plan_rhv">Scheduling a migration plan to run in the future</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="Viewing_migration_plan_progress_rhv">Viewing a migration plan in progress</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="Canceling_a_migration_plan_rhv">Canceling a migration plan in progress</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="Retrying_a_failed_migration_plan_rhv">Retrying a failed migration plan</link></simpara>
</listitem>
</itemizedlist>
<note>
<simpara>A CSV file is optional, but recommended, for large migrations because it is faster than manually selecting each virtual machine.</simpara>
</note>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guisubmenu>Migration</guisubmenu> <guimenuitem>Migration Plans</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Create Migration Plan</emphasis>. The <emphasis role="strong">Create Migration Plan</emphasis> wizard is displayed.</simpara>
<simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/Create_Migration_Plan_screen.png"/>
</imageobject>
<textobject><phrase>Create Migration Plan screen</phrase></textobject>
</inlinemediaobject></simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">General</emphasis> screen, add the details of the migration plan:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Select an infrastructure mapping from the drop-down list.</simpara>
</listitem>
<listitem>
<simpara>Enter the migration plan <emphasis role="strong">Name</emphasis> and (optional) <emphasis role="strong">Description</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select a virtual machine discovery method:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Choose from a list of VMs discovered in the selected infrastructure mapping</emphasis></simpara>
<simpara>If the virtual machines cannot be discovered, check that the source datastores and networks in the infrastructure mapping are correct.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Import a CSV file with a list of VMs to be migrated</emphasis>.</simpara>
<simpara>A CSV file is required for previously migrated source virtual machines and recommended for large migrations.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Next</emphasis>.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">VMs</emphasis> screen, select the virtual machines for migration:</simpara>
<itemizedlist>
<listitem>
<simpara>If you selected <emphasis role="strong">Choose from a list of VMs discovered in the selected infrastructure mapping</emphasis>, select the virtual machines for migration.</simpara>
<simpara>You can search for virtual machines by <emphasis role="strong">VM Name</emphasis>, <emphasis role="strong">Data Center</emphasis>, <emphasis role="strong">Cluster</emphasis>, and <emphasis role="strong">Folder</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>If you selected <emphasis role="strong">Import a CSV file with a list of VMs to be migrated</emphasis>:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Click <emphasis role="strong">Import</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Browse to the CSV file and click <emphasis role="strong">Open</emphasis>.</simpara>
<simpara>If the virtual machines cannot be added to the migration plan, check the CSV file format and fields for errors.</simpara>
<note>
<simpara>If the <emphasis role="strong">Create Migration Plan</emphasis> wizard freezes, refresh the web page, check the CSV file for errors (for example, virtual machines with duplicate <literal>Name</literal> fields and no other fields to distinguish them), and create a new migration plan.</simpara>
</note>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Next</emphasis>.</simpara>
</listitem>
</orderedlist>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Advanced Options</emphasis> screen, select the playbook service options:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Select a premigration and/or postmigration playbook service from the dropdown lists.</simpara>
</listitem>
<listitem>
<simpara>Select the virtual machines on which to run the playbook services.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Next</emphasis>.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Schedule</emphasis> screen, select a schedule option and click <emphasis role="strong">Create</emphasis>:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Save migration plan to run later</emphasis></simpara>
<simpara>The migration plan is saved in <emphasis role="strong">Migration Plans Not Started</emphasis> and will not run unless you schedule it or click <emphasis role="strong">Migrate</emphasis> to run the scheduled migration plan immediately.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Start migration immediately</emphasis></simpara>
<simpara>The migration plan may take some time to complete. Progress bars indicate the amount of transferred data, the number of migrated virtual machines, and the elapsed time. See <xref linkend="Viewing_migration_plan_progress_rhv"/> for details.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Results</emphasis> screen, click <emphasis role="strong">Close</emphasis>.</simpara>
</listitem>
</orderedlist>
<simpara>When the migration plan has finished, click <emphasis role="strong">Migration Plans Complete</emphasis> to view the status of the migration plan. The completed migration plan shows the status of the migrated virtual machines.</simpara>
<simpara>In the migration plans list, you can click the <emphasis role="strong">More Actions</emphasis> icon (<inlinemediaobject>
<imageobject>
<imagedata fileref="images/More_actions_icon.png"/>
</imageobject>
<textobject><phrase>7</phrase></textobject>
</inlinemediaobject>) to archive, edit, or delete a migration plan.</simpara>
<section xml:id="Scheduling_a_saved_migration_plan_rhv">
<title>Scheduling a saved migration plan</title>
<simpara>To schedule a saved migration plan to run in the future:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <emphasis role="strong">Migration Plans Not Started</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Schedule</emphasis> button of a migration plan.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Schedule Migration Plan</emphasis> window, select a date and time and click <emphasis role="strong">Schedule</emphasis>. The plan’s status is <emphasis role="strong">Migration Scheduled</emphasis> with the date and time.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Viewing_migration_plan_progress_rhv">
<title>Viewing a migration plan in progress</title>
<simpara>To view the progress of a migration plan:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <emphasis role="strong">Migration Plans in Progress</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click a migration plan name to view its details, including the status of the migrating virtual machines.</simpara>
</listitem>
</orderedlist>
<note>
<simpara>The counter in <menuchoice><guimenu>Compute</guimenu> <guisubmenu>Migration</guisubmenu> <guimenuitem>Migration Plans</guimenuitem></menuchoice> may be a few seconds ahead of the counter in the migration plan details view. This is because the <emphasis role="strong">Migration Plans</emphasis> counter displays the total time for running the migration plan, while the details counter displays the time for migrating the virtual machines.</simpara>
</note>
</section>
<section xml:id="Canceling_a_migration_plan_rhv">
<title>Canceling a migration plan in progress</title>
<simpara>To cancel a migration plan in progress:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <emphasis role="strong">Migration Plans in Progress</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select a migration plan and click <emphasis role="strong">Cancel Migration</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Cancel Migrations</emphasis> to confirm the cancellation. The canceled migration appears in <emphasis role="strong">Migration Plans Complete</emphasis> with a red <literal>x</literal> indicating that the plan did not complete successfully.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Retrying_a_failed_migration_plan_rhv">
<title>Retrying a failed migration plan</title>
<simpara>To retry a migration plan that failed because of external circumstances (for example, power outage):</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Delete all objects created by the failed migration plan:</simpara>
<itemizedlist>
<listitem>
<simpara>Delete newly created virtual machines to avoid name conflicts with migrating VMware virtual machines.</simpara>
</listitem>
<listitem>
<simpara>Delete converted disks to free up space.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guisubmenu>Migration</guisubmenu> <guimenuitem>Migration Plans</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Migration Plans Complete</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Retry</emphasis> button beside the failed migration plan.</simpara>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="Changing_the_maximum_number_of_concurrent_migrations_rhv">
<title>Changing the maximum number of concurrent migrations</title>
<simpara>You can change the maximum number of concurrent migrations for conversion hosts or providers to control the impact of the migration process on your infrastructure.</simpara>
<simpara>The provider setting has priority over the conversion host setting. For example, if the maximum number of concurrent migrations is <literal>20</literal> for a provider and <literal>3</literal> for five conversion hosts, the maximum number of concurrent migrations is <literal>20</literal>, not <literal>15</literal> (<literal>5</literal> conversion hosts <literal>x 3</literal> concurrent migrations per host).</simpara>
<simpara>An increase in the maximum number of concurrent migrations affects all migration plans immediately. Virtual machines that are queued to migrate will migrate in greater numbers.</simpara>
<simpara>A decrease maximum number of concurrent migrations affects only future migration plans. Migration plans that are in progress will use the limit that was set when the plan was created.</simpara>
<variablelist>
<varlistentry>
<term>Changing the maximum number of concurrent migrations for all conversion hosts or providers</term>
<listitem>
</listitem>
</varlistentry>
</variablelist>
<caution>
<simpara>If you are using VDDK transformation, the number of concurrent migrations must not exceed <literal>20</literal>. Otherwise, network overload will cause the migration to fail.</simpara>
</caution>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guisubmenu>Migration</guisubmenu> <guimenuitem>Migration Settings</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Migration Throttling</emphasis> tab, select a value for <emphasis role="strong">Maximum concurrent migrations per conversion host</emphasis> or <emphasis role="strong">Maximum concurrent migrations per provider</emphasis> and click <emphasis role="strong">Apply</emphasis>.</simpara>
<simpara>The value of <emphasis role="strong">Maximum concurrent migrations per conversion host</emphasis> is constrained so that it cannot be greater than <emphasis role="strong">Maximum concurrent migrations per provider</emphasis>.</simpara>
<note>
<simpara>In the current release, the <emphasis role="strong">Maximum concurrent migrations per conversion host</emphasis> interface control does not work.</simpara>
</note>
</listitem>
</orderedlist>
<variablelist>
<varlistentry>
<term>Changing the maximum number of concurrent migrations for a specific conversion host</term>
<listitem>
<orderedlist numeration="arabic">
<listitem>
<simpara>Enter the following command:</simpara>
</listitem>
</orderedlist>
<screen># curl -sk -u <emphasis>username</emphasis>:_password_ <emphasis>https://<emphasis>CloudForms_FQDN</emphasis>/api/conversion_hosts/<emphasis>conversion_host_id</emphasis></emphasis> -X POST -d <emphasis>{"action": "edit", "resource": {"max_concurrent_tasks": <emphasis>15</emphasis>}}</emphasis> <co xml:id="CO2-1"/> <co xml:id="CO2-2"/> <co xml:id="CO2-3"/> <co xml:id="CO2-4"/></screen>
</listitem>
</varlistentry>
</variablelist>
<calloutlist>
<callout arearefs="CO2-1">
<para><literal>username</literal> and <literal>password</literal> are the username and password for CloudForms.</para>
</callout>
<callout arearefs="CO2-2">
<para><literal>CloudForms_FQDN</literal> is the FQDN of the CloudForms machine.</para>
</callout>
<callout arearefs="CO2-3">
<para>To obtain a <literal>conversion_host_id</literal>, enter the following command:</para>
<screen># curl -sk -u <emphasis>username:password</emphasis> <emphasis>https://<emphasis>CloudForms_FQDN</emphasis>/api/conversion_hosts/</emphasis></screen>
</callout>
<callout arearefs="CO2-4">
<para><literal>max_concurrent_tasks</literal> is the maximum number of concurrent migrations. The default is <literal>10</literal>.</para>
</callout>
</calloutlist>
</section>
</chapter>
<chapter xml:id="Troubleshooting_rhv">
<title>Troubleshooting</title>
<simpara>To identify errors, you can review the migration logs. See <xref linkend="Migration_logs_rhv"/>.</simpara>
<simpara>You can check these common issues and mistakes:</simpara>
<itemizedlist>
<listitem>
<simpara>Infrastructure mapping errors. See <xref linkend="Infrastructure_mapping_errors_rhv"/>.</simpara>
</listitem>
<listitem>
<simpara>Migration plan errors. See <xref linkend="Migration_plan_errors_rhv"/>.</simpara>
</listitem>
<listitem>
<simpara>IP address errors. See <xref linkend="IP_address_errors_rhv"/>.</simpara>
</listitem>
<listitem>
<simpara>Environment configuration errors. See <xref linkend="Environment_configuration_errors_rhv"/>.</simpara>
</listitem>
</itemizedlist>
<simpara><xref linkend="Known_issues_rhv"/> provides information about issues that will be addressed in a future release.</simpara>
<section xml:id="Migration_logs_rhv">
<title>Migration logs</title>
<simpara>You can check the following logs to identify the cause of a migration error:</simpara>
<itemizedlist>
<listitem>
<simpara>Conversion host logs. See <xref linkend="conversion_host_playbook_logs_rhv"/>.</simpara>
</listitem>
<listitem>
<simpara>Playbook logs, if you are using premigration or postmigration Ansible playbooks. See <xref linkend="conversion_host_playbook_logs_rhv"/>.</simpara>
</listitem>
<listitem>
<simpara>CloudForms migration log. See <xref linkend="Cloudforms_migration_log_rhv"/>.</simpara>
</listitem>
</itemizedlist>
<section xml:id="conversion_host_playbook_logs_rhv">
<title>Downloading the conversion host and playbook logs</title>
<simpara>You can download the conversion host and playbooks logs in CloudForms.</simpara>
<simpara>When disk migration starts, two logs are created in the conversion host:</simpara>
<itemizedlist>
<listitem>
<simpara><literal>virt-v2v</literal>: Debug output from <literal>virt-v2v</literal> itself. This log tracks the core of the virtual machine migration process, including <literal>libguestfs</literal> traces and disk migration details.</simpara>
</listitem>
<listitem>
<simpara><literal>virt-v2v-wrapper</literal>: Log of the daemonizing wrapper for <literal>virt-v2v</literal>. This log traces the orchestration of the virtual machine conversion on the conversion host, including disk migration percentages and <literal>virt-v2v</literal> error reporting.</simpara>
</listitem>
</itemizedlist>
<important>
<simpara>If you open a <link xlink:href="https://access.redhat.com/support/cases/#/case/new">Red Hat Support call</link>, you will need to submit both the <literal>virt-v2v</literal> log and <literal>virt-v2v-wrapper</literal> log for analysis and troubleshooting.</simpara>
</important>
<simpara>To access the conversion host logs and the playbook logs:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guisubmenu><emphasis role="strong">Migration</emphasis></guisubmenu> <guimenuitem>Migration Plans</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click a completed migration plan to view its details.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Download Log</emphasis> of a virtual machine and select a log from the dropdown list:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Premigration log</emphasis> This option only appears if a premigration playbook is used.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Migration log</emphasis> The <emphasis role="strong">Migration log</emphasis> is the <literal>virt-v2v</literal> log.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Virt-v2v-wrapper log</emphasis></simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Postmigration log</emphasis> This option only appears if a postmigration playbook is used.</simpara>
</listitem>
</itemizedlist>
</listitem>
</orderedlist>
</section>
<section xml:id="Cloudforms_migration_log_rhv">
<title>Accessing the CloudForms migration log</title>
<orderedlist numeration="arabic">
<listitem>
<simpara>Log into the CloudForms machine using SSH.</simpara>
</listitem>
<listitem>
<simpara>The migration log is <literal>/var/www/miq/vmdb/log/automation.log</literal>.</simpara>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="Infrastructure_mapping_errors_rhv">
<title>Infrastructure mapping errors</title>
<itemizedlist>
<listitem>
<simpara><literal>Networks missing</literal>, <literal>Datastores missing</literal>, and <literal>Clusters missing</literal> error messages: If you create an infrastructure mapping and then change a provider or refresh the Red Hat Virtualization hosts, the provider’s object IDs change. Delete the infrastructure mapping and create a new one.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="Migration_plan_errors_rhv">
<title>Migration plan errors</title>
<itemizedlist>
<listitem>
<simpara>If the virtual machines are being migrated for the first time and are not discovered by the migration plan, check the source datastores and networks in the infrastructure mapping.</simpara>
</listitem>
<listitem>
<simpara>If the virtual machines have been migrated in the past, they cannot be discovered by the migration plan. Use a CSV file to add the virtual machines to the migration plan.</simpara>
</listitem>
<listitem>
<simpara>If the virtual machines cannot be added to the migration plan with a CSV file, check the CSV file format and fields. Create a new migration plan with the updated CSV file.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Create Migration Plan</emphasis> wizard hangs while importing a CSV file. This error is caused by an invalid CVS file (for example, virtual machines with a duplicate <literal>Name</literal> field and no <literal>Host</literal>/<literal>Provider</literal> field to distinguish them, or with a duplicate <literal>Name</literal> field and duplicate <literal>Host</literal>/<literal>Provider</literal> fields). Refresh the web page.</simpara>
</listitem>
<listitem>
<simpara><literal>Denied State</literal> error (IMS 1.1). If a migration plan fails immediately and the migration plan displays a <literal>Denied State</literal> error message, check that you have created and configured the conversion hosts correctly. Cancel the migration plan and run it again.</simpara>
</listitem>
<listitem>
<simpara><literal>Unable to migrate VMs because no conversion host was configured at the time of the attempted migration. See the product documentation for information on configuring conversion hosts.</literal> (IMS 1.2) You can create and save a migration plan whose infrastructure mapping does not contain conversion hosts, but you cannot run the migration plan without conversion hosts. Cancel the migration plan, create the conversion hosts, and run the migration plan again.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="IP_address_errors_rhv">
<title>IP address errors</title>
<itemizedlist>
<listitem>
<simpara>If the IP address of a migrated RHEL (or other Linux-based operating system) virtual machine is not accessible, you must create a <literal>RHEL premigration</literal> playbook and add it to the migration plan.</simpara>
</listitem>
<listitem>
<simpara>If a migrated virtual machine does not have an IP address:</simpara>
<itemizedlist>
<listitem>
<simpara>Check that you installed VMware Tools on the VMware virtual machine before migration.</simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
</section>
<section xml:id="Environment_configuration_errors_rhv">
<title>Environment configuration errors</title>
<itemizedlist xml:id="VMware_environment_errors_rhv">
<title>VMware</title>
<listitem>
<simpara>A VMware virtual machine cannot be migrated if it has any of the following conditions:</simpara>
<itemizedlist>
<listitem>
<simpara>Mounted ISO/CDROM disk</simpara>
</listitem>
<listitem>
<simpara>Encrypted disk</simpara>
</listitem>
<listitem>
<simpara>Invalid name, containing spaces or special characters</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>If you are performing more than ten concurrent migrations from a single VMware hypervisor, you must increase the hypervisor’s NFC service memory.</simpara>
</listitem>
</itemizedlist>
<itemizedlist xml:id="rhv_environment_errors">
<title>Red Hat Virtualization</title>
<listitem>
<simpara>Name conflict: VMware virtual machine has the same name as a Red Hat Virtualization virtual machine.</simpara>
</listitem>
<listitem>
<simpara>MAC address conflict: VMware virtual machine has the same MAC address as a Red Hat Virtualization virtual machine in a MAC address pool.</simpara>
</listitem>
<listitem>
<simpara>SSH transformation only:</simpara>
<itemizedlist>
<listitem>
<simpara>If you are using SSSD with single sign-on, you must reinstall <literal>ipa-client</literal> without OpenSSH.</simpara>
</listitem>
<listitem>
<simpara>Check that the conversion host does not have an existing private SSH key in <literal>/var/lib/vdsm/.ssh/id_rsa</literal>. Conversion host configuration does not overwrite old SSH keys. They must be deleted manually.</simpara>
</listitem>
<listitem>
<simpara>Check that you enabled SSH access on the VMware hypervisors and correctly configured your conversion hosts for SSH transformation.</simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
</section>
<section xml:id="Known_issues_rhv">
<title>Known Issues</title>
<simpara>The following issues will be addressed in a future release:</simpara>
<itemizedlist>
<listitem>
<simpara>BZ#1666799: <link xlink:href="https://bugzilla.redhat.com/show_bug.cgi?id=1666799">Canceling migration does not stop creating volume, instance, and network port on OpenStack Platform or VMs on Red Hat Virtualization</link></simpara>
</listitem>
<listitem>
<simpara>BZ#1678385: <link xlink:href="https://bugzilla.redhat.com/show_bug.cgi?id=1678385">Virtual machine with name containing spaces (<emphasis>rhel 7</emphasis>) fails to migrate using SSH and VDDK transformation</link></simpara>
</listitem>
<listitem>
<simpara>BZ#1699343: <link xlink:href="https://bugzilla.redhat.com/show_bug.cgi?id=1699343">Migration plan CSV import validation does not work if file contains empty/archived/orphan/invalid VM name</link></simpara>
</listitem>
<listitem>
<simpara>BZ#1698761: <link xlink:href="https://bugzilla.redhat.com/show_bug.cgi?id=1698761">"Maximum concurrent migrations per conversion host" interface control does not work</link></simpara>
</listitem>
<listitem>
<simpara>BZ#716283: <link xlink:href="https://bugzilla.redhat.com/show_bug.cgi?id=1716283">Migrating virtual machines are not distributed correctly among the conversion hosts</link></simpara>
</listitem>
<listitem>
<simpara>BZ#1726939: <link xlink:href="https://bugzilla.redhat.com/show_bug.cgi?id=1726939">Run the preflight check of migration task before waiting for a conversion host</link>. Currently, the preflight check that monitors the migration is performed after a conversion host is assigned to the task. As a result, the total volume of the Datastores reported in <emphasis role="strong">Migration Plans In Progress</emphasis> reflects the total volume of the virtual machines that are currently migrating, not the total volume of the migration plan. When all the virtual machines have started to migrate, the correct value of the total volume is displayed.</simpara>
</listitem>
<listitem>
<simpara>BZ#666799: <link xlink:href="https://bugzilla.redhat.com/show_bug.cgi?id=1666799">Canceling migration does not stop creating virtual machines on RHV</link>. If you cancel a migration, you must delete migrated virtual machines and disks in the Administration Portal.</simpara>
</listitem>
<listitem>
<simpara>BZ#1669176: <link xlink:href="https://bugzilla.redhat.com/show_bug.cgi?id=1669176">Refreshing the hosts causes the network(s) and datastore to disappear from infrastructure mappings</link></simpara>
</listitem>
<listitem>
<simpara>CloudForms CFME 5.10.4 does not support migration. Use the following versions for migration:</simpara>
<itemizedlist>
<listitem>
<simpara>Red Hat Virtualization 4.2: CFME 5.10.3</simpara>
</listitem>
<listitem>
<simpara>Red Hat Virtualization 4.3: CFME 5.10.5</simpara>
<note>
<simpara>You can use CFME 5.10.4 to manage Red Hat Virtualization 4.3. Only the migration functionality is affected.</simpara>
</note>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
</section>
</chapter>
<appendix xml:id="Configuring_the_rhv_environment_for_ssh_transformation">
<title>Configuring the Red Hat Virtualization environment for SSH transformation</title>
<simpara>You can configure your environment for SSH transformation if you cannot use VDDK.</simpara>
<simpara>Configuring your environment involves the following additional steps:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Configuring the VMware hypervisors. See <xref linkend="Configuring_the_vmware_hypervisors_for_ssh_transformation_rhv"/>.</simpara>
</listitem>
<listitem>
<simpara>(Optional) Reinstalling <literal>ipa-client</literal> if you are configuring your conversion hosts for SSSD with single sign-on. See <xref linkend="Reinstalling_ipa_client"/>.</simpara>
</listitem>
<listitem>
<simpara>Configuring the conversion hosts. See <xref linkend="Configuring_the_rhv_conversion_hosts_for_ssh"/>.</simpara>
</listitem>
<listitem>
<simpara>Copying the VMware keys to the conversion hosts. See <xref linkend="Copying_vmware_keys_to_rhv_conversion_hosts"/>.</simpara>
</listitem>
</orderedlist>
<section xml:id="Configuring_the_vmware_hypervisors_for_ssh_transformation_rhv">
<title>Configuring the VMware hypervisors for SSH transformation</title>
<simpara>For SSH transformation, you must configure the VMware hypervisors for passwordless access by sharing a conversion host’s public SSH key with the hypervisors.</simpara>
<important>
<simpara>A single SSH key pair is recommended because the key pair is used only for virtual machine conversion and it simplifies conversion host management.</simpara>
<simpara>If you wish to use a dedicated SSH key pair for each conversion host, you can copy the public key of each conversion host to all the VMware hypervisors.</simpara>
</important>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Enable SSH access on each VMware hypervisor. For instructions, navigate to <link xlink:href="https://docs.vmware.com/en/VMware-vSphere/index.html">VMware vSphere Documentation</link> and enter <literal>Enable ESXi Shell and SSH Access with the Direct Console User Interface]</literal> in the <emphasis role="strong">Search</emphasis> field.</simpara>
<simpara>You can collect the SSH public keys of the VMware hypervisors at this stage, to copy to the conversion hosts.</simpara>
</listitem>
<listitem>
<simpara>Generate an SSH key pair without a passphrase:</simpara>
<screen># ssh-keygen -N ''</screen>
</listitem>
<listitem>
<simpara>Copy the public SSH key to <literal>/etc/ssh/keys-root/authorized_keys</literal> on <emphasis role="strong">each</emphasis> VMware hypervisor.</simpara>
<simpara>You will use the private SSH key to configure the conversion hosts.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Reinstalling_ipa_client">
<title>Reinstalling <literal>ipa-client</literal></title>
<simpara>If you are using SSH transformation and configuring your conversion hosts for SSSD with single sign-on, you must reinstall <literal>ipa-client</literal> without the OpenSSH client. Otherwise, SSH will fail for the <literal>vdsm</literal> user. See <link xlink:href="https://bugzilla.redhat.com/show_bug.cgi?id=1544379">BZ#1544379: ipa-client-install changes system-wide SSH configuration</link> for more information. This issue cannot be resolved by modifying the configuration file because the file is restored during upgrades.</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Log in to the Manager machine using SSH.</simpara>
</listitem>
<listitem>
<simpara>Uninstall <literal>ipa-client</literal>:</simpara>
<screen># ipa-client-install --uninstall</screen>
</listitem>
<listitem>
<simpara>Reinstall <literal>ipa-client</literal> without OpenSSH:</simpara>
<screen># ipa-client-install --no-ssh</screen>
</listitem>
</orderedlist>
</section>
<section xml:id="Configuring_the_rhv_conversion_hosts_for_ssh">
<title>Configuring the conversion hosts</title>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>In CloudForms, click <menuchoice><guimenu>Compute</guimenu> <guisubmenu>Migration</guisubmenu> <guimenuitem>Migration Settings</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Conversion Hosts</emphasis> tab, click <emphasis role="strong">Configure Conversion Host</emphasis>. The <emphasis role="strong">Configure Conversion Host</emphasis> wizard is displayed.</simpara>
<simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/Conversion_host_configuration_ui.png"/>
</imageobject>
<textobject><phrase>Conversion host configuration ui</phrase></textobject>
</inlinemediaobject></simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Location</emphasis> screen, add the provider details:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Select a <emphasis role="strong">Provider Type</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select a <emphasis role="strong">Provider</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select a <emphasis role="strong">Cluster</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Next</emphasis>.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Host(s)</emphasis> screen, select one or more hosts from the dropdown list and click <emphasis role="strong">Next</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Authentication</emphasis> screen, add the conversion hosts' SSH key and the transformation method:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Click <emphasis role="strong">Browse</emphasis> to browse to the SSH private key or paste it in the <emphasis role="strong">Conversion host SSH private key</emphasis> field.</simpara>
<simpara>The Manager deploys a private SSH key on the conversion hosts in order to send commands and run playbooks. The default key file is <literal>/etc/pki/ovirt-engine/keys/engine_id_rsa</literal> on the Manager machine.</simpara>
</listitem>
<listitem>
<simpara>Select <emphasis role="strong">SSH</emphasis> as the <emphasis role="strong">Transformation method</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Browse</emphasis> to browse to the SSH private key you created for enabling SSH access on the VMware hypervisors or paste it in the <emphasis role="strong">VMware hypervisors SSH private key</emphasis> field.</simpara>
<important>
<simpara>If a host already has an SSH private key, you must delete the key manually in <literal>/var/lib/vdsm/.ssh/id_rsa</literal> before configuring it as a conversion host. Conversion host configuration does not overwrite existing keys.</simpara>
</important>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Configure</emphasis>.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Results</emphasis> screen, wait for the conversion host configuration to finish and click <emphasis role="strong">Close</emphasis>.</simpara>
<simpara>The configured conversion hosts and status information, including error messages, appear in the <emphasis role="strong">Configured Conversion Hosts</emphasis> list.</simpara>
</listitem>
</orderedlist>
<simpara>If an error occurs, you can download a host’s log by clicking the <emphasis role="strong">More Actions</emphasis> icon (<inlinemediaobject>
<imageobject>
<imagedata fileref="images/More_actions_icon.png"/>
</imageobject>
<textobject><phrase>7</phrase></textobject>
</inlinemediaobject>) and selecting <emphasis role="strong">Download Log</emphasis>.</simpara>
<simpara>You can click the <emphasis role="strong">Retry</emphasis> button if the conversion host configuration failed for reasons unconnected with your environment.</simpara>
<simpara>(Optional) Click <emphasis role="strong">Remove</emphasis> to remove the configuration from a configured conversion host.</simpara>
</section>
<section xml:id="Copying_vmware_keys_to_rhv_conversion_hosts">
<title>Copying the VMware SSH keys to the conversion hosts</title>
<simpara>Copy the SSH public keys of the VMware hypervisors to the conversion hosts. You can collect the VMware keys either when you configure the VMware hypervisors for SSH transformation or by using <literal>ssh-keyscan</literal>:</simpara>
<itemizedlist>
<listitem>
<simpara><link linkend="Copying_collected_ssh_keys_rhv">Copying keys collected during VMware hypervisor configuration</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="Copying_keys_ssh_keyscan_rhv">Copying keys collected with <literal>ssh-keyscan</literal></link></simpara>
</listitem>
</itemizedlist>
<section xml:id="Copying_collected_ssh_keys_rhv">
<title>Copying keys collected during VMware hypervisor configuration</title>
<orderedlist numeration="arabic">
<listitem>
<simpara>Copy the VMware keys to <literal>/var/lib/vdsm/.ssh/known_hosts</literal> on each conversion host.</simpara>
</listitem>
<listitem>
<simpara>Verify the SSH connection by connecting to each VMware hypervisor as <literal>vdsm</literal>:</simpara>
<screen># sudo -u vdsm ssh root@<emphasis>esx1.example.com</emphasis></screen>
<simpara>If the connection fails, check that the VMware hypervisor has SSH access enabled and that you copied the correct keys.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Copying_keys_ssh_keyscan_rhv">
<title>Copying keys collected with <literal>ssh-keyscan</literal></title>
<caution>
<simpara>You must run <literal>ssh-keyscan</literal> for each VMware hypervisor. Otherwise your conversion hosts will not have all the VMware hypervisor keys and the migration will fail.</simpara>
</caution>
<orderedlist numeration="arabic">
<listitem>
<simpara>Run <literal>ssh-keyscan</literal> for each VMware hypervisor and copy its public key to <literal>known_hosts</literal>, as in the following example:</simpara>
<screen># ssh-keyscan <emphasis>esx1_IP</emphasis> &gt; /var/lib/vdsm/.ssh/known_hosts <co xml:id="CO3-1"/>
# ssh-keyscan <emphasis>esx2_IP</emphasis> &gt;&gt; /var/lib/vdsm/.ssh/known_hosts
# ssh-keyscan <emphasis>esx3_IP</emphasis> &gt;&gt; /var/lib/vdsm/.ssh/known_hosts</screen>
<calloutlist>
<callout arearefs="CO3-1">
<para>You must use the IP address, not the host name, of the VMware hypervisor.</para>
</callout>
</calloutlist>
</listitem>
<listitem>
<simpara>Change the ownership of the <literal>known_hosts</literal> file to <literal>vdsm</literal> user and <literal>kvm</literal> group:</simpara>
<screen># chown 36:36 /var/lib/vdsm/.ssh/known_hosts</screen>
</listitem>
<listitem>
<simpara>Verify the SSH connection by connecting to each VMware hypervisor as <literal>vdsm</literal>:</simpara>
<screen># sudo -u vdsm ssh root@<emphasis>esx1.example.com</emphasis></screen>
<simpara>If the connection fails, check that the VMware hypervisor has SSH access enabled and that you copied the correct keys.</simpara>
</listitem>
</orderedlist>
</section>
</section>
</appendix>
</part>
<part xml:id="Migrating_from_vmware_to_osp">
<title>Migrating from VMware to Red Hat OpenStack Platform</title>
<partintro>
<simpara>The migration process involves the following tasks:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Planning the migration. See <xref linkend="Planning_the_migration_osp"/>.</simpara>
</listitem>
<listitem>
<simpara>Preparing the VMware, Red Hat OpenStack Platform, and CloudForms environments. See <xref linkend="Preparing_the_environment_for_migration_to_osp"/>.</simpara>
</listitem>
<listitem>
<simpara>Migrating the virtual machines. See <xref linkend="Migrating_the_virtual_machines_osp"/>.</simpara>
</listitem>
<listitem>
<simpara>Troubleshooting, if necessary. See <xref linkend="Troubleshooting_osp"/>.</simpara>
</listitem>
</orderedlist>
<note>
<simpara>The virtual disks are converted with the VMware Virtual Disk Development Kit (VDDK). If you cannot use VDDK, SSH transformation is a fallback option. See <xref linkend="Configuring_the_osp_environment_for_ssh_transformation"/>.</simpara>
</note>
</partintro>
<chapter xml:id="Planning_the_migration_osp">
<title>Planning the migration</title>
<simpara>During the planning phase, you will formulate a specific migration goal, for example, "I want to migrate 2000 virtual machines, with 200 TB of data, in less than 6 months".</simpara>
<simpara>Review the following information to plan your migration:</simpara>
<itemizedlist>
<listitem>
<simpara><xref linkend="Questions_to_ask_before_migration_osp"/> includes the following:</simpara>
<itemizedlist>
<listitem>
<simpara>What operating systems are supported?</simpara>
</listitem>
<listitem>
<simpara>How long will the migration take?</simpara>
</listitem>
<listitem>
<simpara>How many conversion hosts do I need?</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara><xref linkend="Recommendations_for_migration_osp"/> provides guidelines on the following topics:</simpara>
<itemizedlist>
<listitem>
<simpara>Scheduling the migration</simpara>
</listitem>
<listitem>
<simpara>Distributing the workload</simpara>
</listitem>
<listitem>
<simpara>Deploying the conversion hosts</simpara>
</listitem>
<listitem>
<simpara>Controlling the migration process</simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
<simpara>The migration workflow describes the migration process in greater detail.</simpara>
<figure xml:id="Vmware_to_osp_migration_workflow">
<title>VMware to Red Hat OpenStack Platform migration workflow</title>
<mediaobject>
<imageobject>
<imagedata fileref="images/vmware_to_osp_migration_workflow.png"/>
</imageobject>
<textobject><phrase>vmware to osp migration workflow</phrase></textobject>
</mediaobject>
</figure>
<simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/circle_step_numbers/1.png" contentwidth="25"/>
</imageobject>
<textobject><phrase>25</phrase></textobject>
</inlinemediaobject> You create and run a migration plan in CloudForms.</simpara>
<simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/circle_step_numbers/2.png" contentwidth="25"/>
</imageobject>
<textobject><phrase>25</phrase></textobject>
</inlinemediaobject> CloudForms uses the migration plan to locate the source virtual machines.</simpara>
<simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/circle_step_numbers/3.png" contentwidth="25"/>
</imageobject>
<textobject><phrase>25</phrase></textobject>
</inlinemediaobject> CloudForms captures the ESXi host fingerprint for authentication during the virtual machine conversion process.</simpara>
<simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/circle_step_numbers/4.png" contentwidth="25"/>
</imageobject>
<textobject><phrase>25</phrase></textobject>
</inlinemediaobject> Using the attributes defined for the Red Hat OpenStack Platform environment, CloudForms initiates communication with the conversion hosts (Red Hat OpenStack Platform instances created from a conversion host appliance, with <literal>virt-v2v</literal> and <literal>virt-v2v-wrapper</literal> installed).</simpara>
<simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/circle_step_numbers/5.png" contentwidth="25"/>
</imageobject>
<textobject><phrase>25</phrase></textobject>
</inlinemediaobject> <literal>virt-v2v-wrapper</literal> connects to the source datastore through the ESXi host. <literal>virt-v2v</literal> streams the source disks to the target data domain and converts the source disks.</simpara>
<simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/circle_step_numbers/6.png" contentwidth="25"/>
</imageobject>
<textobject><phrase>25</phrase></textobject>
</inlinemediaobject> After the source disks are converted, <literal>virt-v2v</literal> detaches the volumes from the conversion host, migrates the volumes to the destination project, and creates the network ports defined in the infrastructure mapping.</simpara>
<simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/circle_step_numbers/7.png" contentwidth="25"/>
</imageobject>
<textobject><phrase>25</phrase></textobject>
</inlinemediaobject> <literal>virt-v2v-wrapper</literal> creates the target Red Hat OpenStack Platform instance with the flavor and security group defined in the migration plan. <literal>virt-v2v</literal> attaches the newly created network ports and the disks mapped in the block storage to the instance and the instance is powered on.</simpara>
<simpara>The migration process is complete and the migration plan’s status is displayed in CloudForms.</simpara>
<section xml:id="Questions_to_ask_before_migration_osp">
<title>Questions to ask before migration</title>
<simpara>The following questions can help you to estimate the resources and time required for migration.</simpara>
<variablelist>
<varlistentry>
<term>What am I migrating?</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>Identify the VMware virtual machines that you will be migrating.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>What is the maximum number of disks or virtual machines that I can migrate?</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>There is no maximum number of disks or virtual machines that you can migrate. However, you may not want to migrate all your virtual machines at the same time, in order to minimize the impact on your users.</simpara>
<important>
<simpara>If you exceed the capabilities of your environment, the migrations will fail. This situation could affect existing applications running on virtual machines attached to the network and storage.</simpara>
</important>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>What operating systems can I migrate?</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>You can migrate any guest operating system that is certified and supported for use with the Red Hat Virtualization Hypervisor. See <link xlink:href="https://access.redhat.com/articles/973163">Certified Guest Operating Systems in Red Hat OpenStack Platform and Red Hat Virtualization</link>.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>What am I missing?</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>Identify resource gaps, such as bandwidth, storage, licenses, or a suitable maintenance window, before you begin the migration.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>What impact will the migration have on my users?</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>Assess the effects the migration may have on a production environment.</simpara>
<simpara>It may be possible to migrate your applications in phases, without downtime at the application layer, if the applications are distributed in a high-availability architecture.</simpara>
</listitem>
<listitem>
<simpara>Check whether users will lose access to critical applications.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>How long will the migration take?</term>
<listitem>
<simpara>There is no formula to estimate how long the actual migration will take. This is determined on a case-by-case basis.</simpara>
<simpara>The following example is provided as a guide:</simpara>
<example>
<title>Red Hat OpenStack Platform migration</title>
<itemizedlist>
<listitem>
<simpara>Duration of migration: 2:13:00 (hh:mm:ss)</simpara>
</listitem>
<listitem>
<simpara>20 virtual machines</simpara>
</listitem>
<listitem>
<simpara>2 conversion hosts, maximum of 10 concurrent conversions</simpara>
</listitem>
<listitem>
<simpara>Total data migrated: 1000 GB</simpara>
</listitem>
<listitem>
<simpara>Hardware:</simpara>
<itemizedlist>
<listitem>
<simpara>Strong host (40 cores, 500 GB RAM)</simpara>
</listitem>
<listitem>
<simpara>Fast SSD XtremIO storage</simpara>
</listitem>
<listitem>
<simpara>Fibre Channel 8 interface for host-to-storage connection</simpara>
</listitem>
<listitem>
<simpara>10 GbE network interface cards for all other connections</simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
</example>
</listitem>
</varlistentry>
<varlistentry>
<term>How many conversion hosts do I need?</term>
<listitem>
<simpara>The number of conversion hosts you create depends on the size of your migration. All the virtual machines in a migration plan are migrated at the same time, in parallel. The number of virtual machines that you can migrate simultaneously depends on your infrastructure capabilities. Each migration requires a certain amount of network bandwidth, I/O throughput, and processing power for the conversion process.</simpara>
<simpara>Multiple conversion hosts provide load-balancing and better performance, even for small migrations.</simpara>
<simpara>Conversion hosts are limited to a maximum of ten concurrent migrations, unless you change the default values.</simpara>
<simpara>You should test your environment thoroughly before the migration to determine how many migrations it can support without negative effects, for example, five conversion hosts, each running ten concurrent migrations.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>Should I migrate my virtual machines with VDDK or SSH?</term>
<listitem>
<simpara>You can migrate your virtual machines with either the VMware Virtual Disk Development Kit (VDDK) or SSH. VDDK is the default because it is much faster than SSH and easier to configure.</simpara>
<simpara>VDDK is limited to 20 concurrent migrations per conversion host, because of network limitations, and 10 concurrent migrations per VMware hypervisor, unless you increase the hypervisor’s NFC service memory.</simpara>
<simpara>If you cannot use VDDK, SSH transformation is a fallback option.</simpara>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="Recommendations_for_migration_osp">
<title>Recommendations and best practices</title>
<simpara>The following recommendations will help to minimize the impact of the migration on your environment.</simpara>
<itemizedlist>
<title>Scheduling the migration</title>
<listitem>
<simpara>Schedule your migration carefully, to minimize the impact on your users.</simpara>
</listitem>
<listitem>
<simpara>Prepare your users for downtime.</simpara>
</listitem>
<listitem>
<simpara>Stagger the migration schedules.</simpara>
</listitem>
<listitem>
<simpara>Move critical applications during maintenance windows.</simpara>
</listitem>
</itemizedlist>
<itemizedlist>
<title>Distributing the migration workload</title>
<listitem>
<simpara>Create migration groups, so that you are not migrating all of your virtual machines at the same time, keeping in mind the following considerations:</simpara>
<itemizedlist>
<listitem>
<simpara>How are the virtual machines grouped now?</simpara>
</listitem>
<listitem>
<simpara>Which virtual machines should be migrated together?</simpara>
</listitem>
<listitem>
<simpara>Which workloads or linked applications should be migrated together?</simpara>
</listitem>
<listitem>
<simpara>What applications must remain available?</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Consider which parts of the workload to migrate first:</simpara>
<itemizedlist>
<listitem>
<simpara>Databases</simpara>
</listitem>
<listitem>
<simpara>Applications</simpara>
</listitem>
<listitem>
<simpara>Web servers</simpara>
</listitem>
<listitem>
<simpara>Load balancers</simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
<itemizedlist>
<title>Deploying the conversion hosts</title>
<listitem>
<simpara>Create a sufficient number of conversion hosts for your migration, with sufficient resources.</simpara>
</listitem>
<listitem>
<simpara>Create multiple conversion hosts for load-balancing. The virtual machines in a migration plan are automatically distributed among the conversion hosts. This decreases the load on the conversion hosts and allows you to increase the concurrent migrations beyond the limits of a single conversion host.</simpara>
</listitem>
</itemizedlist>
<itemizedlist>
<title>Controlling the migration process</title>
<listitem>
<simpara>Create multiple migration plans for finer control.</simpara>
</listitem>
<listitem>
<simpara>Perform test migrations with different maximum numbers of concurrent migrations to assess the capabilities of your environment’s infrastructure.</simpara>
</listitem>
</itemizedlist>
</section>
</chapter>
<chapter xml:id="Preparing_the_environment_for_migration_to_osp">
<title>Preparing the environment for migration</title>
<simpara>Preparing your environment for migration involves the following tasks:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Preparing the VMware environment. See <xref linkend="Preparing_the_vmware_environment_for_osp"/>.</simpara>
</listitem>
<listitem>
<simpara>Preparing the target environment. See <xref linkend="Preparing_the_1_3_osp_environment"/>.</simpara>
</listitem>
<listitem>
<simpara>Configuring the conversion hosts. See <xref linkend="Configuring_the_1_2_osp_conversion_hosts_for_vddk"/>.</simpara>
</listitem>
</orderedlist>
<note>
<simpara>The virtual disks are converted with the VMware Virtual Disk Development Kit (VDDK). If you cannot use VDDK, SSH transformation is a fallback option. See <xref linkend="Configuring_the_osp_environment_for_ssh_transformation"/>.</simpara>
</note>
<section xml:id="Preparing_the_vmware_environment_for_osp">
<title>Preparing the VMware environment</title>
<simpara>Preparing the VMware environment for migration involves the following tasks:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Extending the VMware network. See <xref linkend="Preparing_the_vmware_network_osp"/>.</simpara>
</listitem>
<listitem>
<simpara>Preparing the VMware virtual machines. See <xref linkend="Preparing_the_vmware_virtual_machines_for_osp"/>.</simpara>
</listitem>
<listitem>
<simpara>(Optional) Configuring a VMware hypervisor for more than ten concurrent migrations from that hypervisor. See <xref linkend="Configuring_vmware_hypervisor_for_more_than_10_concurrent_vddk_migrations_osp"/>.</simpara>
</listitem>
</orderedlist>
<section xml:id="Preparing_the_vmware_network_osp">
<title>Preparing the VMware network</title>
<simpara>Extend the VMware network to the Red Hat OpenStack Platform environment.</simpara>
<important>
<itemizedlist>
<listitem>
<simpara>The network configuration must not be changed in any way during the migration.</simpara>
</listitem>
<listitem>
<simpara>IP addresses, VLANs, and other network configuration must not be changed before or after migration because the conversion process preserves the source virtual machine MAC addresses.</simpara>
</listitem>
</itemizedlist>
</important>
</section>
<section xml:id="Preparing_the_vmware_virtual_machines_for_osp">
<title>Preparing the VMware virtual machines</title>
<simpara>Perform the following steps on each VMware virtual machine that you are migrating:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Install VMware Tools to capture IP addresses.</simpara>
<simpara>To download and install VMware Tools, see <link xlink:href="https://www.vmware.com/support/ws5/doc/new_guest_tools_ws.html">VMware Workstation 5.0: Installing VMware Tools</link>.</simpara>
</listitem>
<listitem>
<simpara>Unmount mounted ISO/CDROM disks.</simpara>
</listitem>
<listitem>
<simpara>Ensure that attached disks are not encrypted.</simpara>
</listitem>
<listitem>
<simpara>Ensure that each NIC has no more than one IPv4 and/or one IPv6 address.</simpara>
</listitem>
<listitem>
<simpara>Ensure that the virtual machine names contain only upper- or lower-case letters, numbers, underscores (<literal>_</literal>), hyphens (<literal>-</literal>), or periods (<literal>.</literal>).</simpara>
<note>
<simpara>International characters and spaces are not permitted.</simpara>
</note>
</listitem>
<listitem>
<simpara>Ensure that the virtual machine names do not duplicate names of virtual machines in the Red Hat OpenStack Platform tenant.</simpara>
</listitem>
</orderedlist>
<simpara>If you are performing more than ten concurrent migrations from a VMware hypervisor, you must configure the hypervisor to support the additional connections. See <xref linkend="Configuring_vmware_hypervisor_for_more_than_10_concurrent_vddk_migrations_osp"/>.</simpara>
</section>
<section xml:id="Configuring_vmware_hypervisor_for_more_than_10_concurrent_vddk_migrations_osp">
<title>Configuring a VMware hypervisor for more than ten concurrent migrations</title>
<simpara>If you are performing more than ten concurrent migrations from a VMware hypervisor using VDDK transformation, the migration will fail because the hypervisor’s NFC service memory buffer is limited to ten parallel connections. See <link xlink:href="https://pubs.vmware.com/vsphere-6-5/topic/com.vmware.vddk.pg.doc/vddkDataStruct.5.5.html#1025227">VMware vSphere 6.5 NFC session connection limits</link> and <link xlink:href="http://libguestfs.org/virt-v2v.1.html#vddk:-esxi-nfc-service-memory-limits">Virt-v2v. VDDK: ESXi NFC service memory limits</link> for details.</simpara>
<simpara>You can increase the hypervisor’s NFC service memory to enable additional connections for migrations.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Log in to a VMware hypervisor.</simpara>
</listitem>
<listitem>
<simpara>Change the value of <literal>maxMemory</literal> to <literal>1000000000</literal> in <literal>/etc/vmware/hostd/config.xml</literal>:</simpara>
<screen>      &lt;nfcsvc&gt;
         &lt;path&gt;libnfcsvc.so&lt;/path&gt;
         &lt;enabled&gt;true&lt;/enabled&gt;
         &lt;maxMemory&gt;1000000000&lt;/maxMemory&gt;
         &lt;maxStreamMemory&gt;10485760&lt;/maxStreamMemory&gt;
      &lt;/nfcsvc&gt;</screen>
</listitem>
<listitem>
<simpara>Restart <literal>hostd</literal>:</simpara>
<screen># /etc/init.d/hostd restart</screen>
<simpara>You do not need to reboot the VMware hypervisor.</simpara>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="Preparing_the_1_3_osp_environment">
<title>Preparing the Red Hat OpenStack Platform environment</title>
<simpara>Preparing the Red Hat OpenStack Platform environment involves the following key steps:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Installing and configuring Red Hat OpenStack Platform 13 or 14. See <xref linkend="Installing_osp_13_14"/>.</simpara>
</listitem>
<listitem>
<simpara>Installing and configuring CloudForms 5_0. See <xref linkend="Installing_cf_5_0_with_osp"/>.</simpara>
</listitem>
<listitem>
<simpara>Creating the conversion hosts. See <xref linkend="Creating_osp_conversion_hosts"/>.</simpara>
</listitem>
</orderedlist>
<note>
<simpara>The virtual disks are converted with the VMware Virtual Disk Development Kit (VDDK). If you cannot use VDDK, SSH transformation is a fallback option. See <xref linkend="Configuring_the_osp_environment_for_ssh_transformation"/>.</simpara>
</note>
<section xml:id="Target_prerequisites_osp">
<title>Prerequisites</title>
<simpara>The following prerequisites apply:</simpara>
<itemizedlist>
<listitem>
<simpara>BIOS settings of physical hosts adjusted for optimal performance (rather than power-saving), according to the vendor’s recommendations</simpara>
</listitem>
<listitem>
<simpara>C1E halt state disabled, if applicable</simpara>
</listitem>
</itemizedlist>
<itemizedlist xml:id="ref_Software_compatibility_matrix_osp" mark="discrete">
<listitem>
<simpara>Compatible software versions:</simpara>
<table frame="all" rowsep="1" colsep="1">
<title>Software compatibility</title>
<tgroup cols="4">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="25*"/>
<colspec colname="col_3" colwidth="25*"/>
<colspec colname="col_4" colwidth="25*"/>
<thead>
<row>
<entry align="left" valign="top">Software</entry>
<entry align="left" valign="top">IMS 1.1</entry>
<entry align="left" valign="top">IMS 1.2</entry>
<entry align="left" valign="top">IMS 1.3</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>VMware</simpara></entry>
<entry align="center" valign="top" namest="col_2" nameend="col_4"><simpara>5.5 or later</simpara></entry>
</row>
<row>
<entry align="left" valign="top" morerows="1"><simpara>CloudForms</simpara></entry>
<entry align="left" valign="top"><simpara>4.7.0, with CFME 5.10.3</simpara></entry>
<entry align="left" valign="top"><simpara>4.7.6, with CFME 5.10.3</simpara></entry>
<entry align="left" valign="top"><simpara>5.0, with CFME xxxx</simpara></entry>
</row>
<row>
<entry align="left" valign="top" namest="col_1" nameend="col_3"><simpara><emphasis role="strong">CFME 5.10.4 does not support migration.</emphasis></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Red Hat OpenStack Platform</simpara></entry>
<entry align="center" valign="top" namest="col_2" nameend="col_4"><simpara>13 or later</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>RHOSP V2V Image for Red Hat OpenStack Director</simpara></entry>
<entry align="left" valign="top"><simpara>14.0.2</simpara></entry>
<entry align="center" valign="top" namest="col_3" nameend="col_4"><simpara>14.0.3</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</listitem>
</itemizedlist>
</section>
<section xml:id="Installing_osp_13_14">
<title>Installing and configuring Red Hat OpenStack Platform 13 or 14</title>
<orderedlist numeration="arabic">
<listitem>
<simpara>Install Red Hat OpenStack Platform 13 or 14. See <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/13/html-single/director_installation_and_usage/">Red Hat OpenStack Platform Director Installation and Usage 13</link> or <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/14/html-single/director_installation_and_usage/">Red Hat OpenStack Platform Director Installation and Usage 14</link>.</simpara>
</listitem>
<listitem>
<simpara>Create provider networks for the target instances to preserve the IP addresses of the source virtual machines. See <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/14/html-single/networking_guide/#create_a_network">Create a network</link> in the <emphasis>Red Hat OpenStack Platform Networking Guide</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Create a project for the conversion hosts and whatever destination projects you require for the target instances. See <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/14/html-single/users_and_identity_management_guide/#create_a_project">Create a Project</link> in the <emphasis>Red Hat OpenStack Platform Users and Identity Management Guide</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Ensure that the <literal>admin</literal> user has <literal>member</literal> and <literal>admin</literal> roles in the conversion and destination projects. See <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/14/html-single/users_and_identity_management_guide/#edit_a_project">Edit a Project</link> in the <emphasis>Red Hat OpenStack Platform Users and Identity Management Guide</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Set at least one volume type for the target block storage. See <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/14/html-single/storage_guide/#section-create-volume">Create a Volume</link> and <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/14/html-single/storage_guide/#section-volume-retype">Changing a Volume’s Type (Volume Re-typing)</link> in the <emphasis>Red Hat OpenStack Platform Storage Guide</emphasis>. Otherwise, CloudForms cannot detect the storage when you create the infrastructure mapping.</simpara>
</listitem>
<listitem>
<simpara>Ensure that the storage backends have sufficient space for the migrated virtual machines.</simpara>
<important>
<simpara>If you are using Red Hat Ceph Storage, you will require three times the space of the source virtual machines for the migrated virtual machines. A Ceph storage cluster, by default, creates two copies of an object in a replicated storage pool, for a total of three copies. See <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_ceph_storage/3/html-single/architecture_guide/index#concept-arch-data-copies-arch">Data Copies</link> in the <emphasis>Red Hat Ceph Storage Architecture Guide</emphasis>.</simpara>
<simpara>The migrated disks use all of the space because it is preallocated. For example, a source virtual machine with a 100 GB disk requires 300 GB of storage, regardless of how much data the disk actually contains. To save storage space, you can use the <literal>fstrim</literal> command on the migrated virtual machines as a postmigration task or playbook.</simpara>
</important>
</listitem>
<listitem>
<simpara>Configure security groups with the following ports enabled:</simpara>
<itemizedlist>
<listitem>
<simpara>For the conversion hosts and CloudForms: port 22 (SSH)</simpara>
</listitem>
<listitem>
<simpara>For CloudForms: port 443 (HTTPS)</simpara>
<note>
<simpara>Outbound traffic is enabled by default. If you have changed this setting, enable ports 902 (CloudForms to VMware) and 5480 (conversion hosts to vCenter).</simpara>
</note>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Create flavors for the source virtual machines. If you do not create custom flavors, CloudForms will try to map each source virtual machine to an existing flavor.</simpara>
</listitem>
<listitem>
<simpara>Ensure that the event monitor workers are running. See <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_cloudforms/4.7/html/general_configuration/configuration#server-diagnostics">Server Diagnostics</link> in <emphasis>Red Hat CloudForms General Configuration</emphasis>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Installing_cf_5_0_with_osp">
<title>Installing and configuring CloudForms 5.0</title>
<caution>
<simpara>Removing or changing a provider will cause errors in the infrastructure mappings and migration plans.</simpara>
</caution>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Install Red Hat CloudForms 5.0. See <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_cloudforms/5.0/html-single/installing_red_hat_cloudforms_on_red_hat_openstack_platform/">Installing Red Hat CloudForms on Red Hat OpenStack Platform</link>.</simpara>
<note>
<simpara>CFME 5.10.4 does not support migration.</simpara>
</note>
</listitem>
<listitem>
<simpara>Enable SmartState Analysis:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>In the header bar, click <menuchoice><guimenu>Administrator</guimenu> <guimenuitem>Configuration</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>In the left pane, in <emphasis role="strong">Settings</emphasis>, click <menuchoice><guimenu>CFME Regions</guimenu> <guisubmenu>Zones</guisubmenu> <guimenuitem>Server</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>In the right pane, in the <emphasis role="strong">Server</emphasis> tab, set <emphasis role="strong">SmartState Analysis</emphasis> to <emphasis role="strong">On</emphasis> and click <emphasis role="strong">Save</emphasis>.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Add VMware to CloudForms as a provider. See <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_cloudforms/5.0/html-single/managing_providers/#vmware_vcenter_providers">Adding a VMware vCenter Provider</link> in <emphasis>Red Hat CloudForms: Managing Providers</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Add Red Hat OpenStack Platform to CloudForms as a cloud provider. See <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_cloudforms/5.0/html-single/managing_providers/index#adding_openstack_cloud_providers">Adding an OpenStack Infrastructure Provider</link> in <emphasis>Red Hat CloudForms: Managing Providers</emphasis>.</simpara>
<important>
<simpara>Do not complete the fields in the <emphasis role="strong">RSA key pair</emphasis> tab. You will add the SSH private key when you configure the conversion hosts.</simpara>
</important>
</listitem>
</orderedlist>
<note>
<simpara>If Red Hat OpenStack Platform has been active for a while, you must wait for CloudForms to update its event history before attempting to use the provider. Check the cloud provider timeline to verify that all events have been processed.</simpara>
</note>
<bridgehead xml:id="Viewing_cloud_provider_event_timeline_osp" renderas="sect4">Viewing the cloud provider timeline in CloudForms</bridgehead>
<simpara>To view the cloud provider timeline:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guisubmenu>Clouds</guisubmenu> <guimenuitem>Providers</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the cloud provider to view its details.</simpara>
</listitem>
<listitem>
<simpara>Click <menuchoice><guimenu>Monitoring</guimenu> <guimenuitem>Timelines</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Select the following options:</simpara>
<itemizedlist>
<listitem>
<simpara>Events: <emphasis role="strong">Management Events</emphasis></simpara>
</listitem>
<listitem>
<simpara>Category: <emphasis role="strong">Select All</emphasis></simpara>
</listitem>
<listitem>
<simpara>Severity: <emphasis role="strong">Select All</emphasis></simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Apply</emphasis>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Creating_osp_conversion_hosts">
<title>Creating the conversion hosts</title>
<simpara>You can create the Red Hat OpenStack Platform conversion hosts with the conversion appliance (<literal>RHOSP V2V Image for Red Hat OpenStack Director</literal>). The number of conversion hosts you deploy depends on your migration size and infrastructure capabilities.</simpara>
<note>
<simpara>For optimal performance, deploy conversion hosts on compute nodes with nested virtualization enabled. See <link xlink:href="https://docs.openstack.org/devstack/latest/guides/devstack-with-nested-kvm.html">Configure DevStack with KVM-based Nested Virtualization</link>. Nested virtualization is a technology preview.</simpara>
</note>
<simpara>To create a Red Hat OpenStack Platform conversion host:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Navigate to <link xlink:href="https://access.redhat.com/downloads/">Red Hat Product Downloads</link>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">A-Z</emphasis> tab, click <emphasis role="strong">Red Hat OpenStack Platform</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click the green <emphasis role="strong">Download Latest</emphasis> button to go to the <emphasis role="strong">Download Red Hat OpenStack Platform</emphasis> page.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Product Software</emphasis> tab, locate the <literal>RHOSP V2V Image for Red Hat OpenStack Director 14.0.<emphasis>x</emphasis> (x86_64)</literal>, click <emphasis role="strong">Download Now</emphasis>, and save the image.</simpara>
<important>
<simpara>IMS 1.1 requires Red Hat OpenStack Director 14.0.2.</simpara>
<simpara>IMS 1.2 requires Red Hat OpenStack Director 14.0.3 or later.</simpara>
</important>
</listitem>
<listitem>
<simpara>Upload the image to Red Hat OpenStack Platform.</simpara>
</listitem>
<listitem>
<simpara>Launch the image as a conversion host instance, with the following resources:</simpara>
<itemizedlist>
<listitem>
<simpara>4 vCPUs</simpara>
</listitem>
<listitem>
<simpara>10 GB RAM, if you use the default maximum number of concurrent migrations per conversion host, which is <literal>10</literal>. If you increase the number of concurrent migrations, you must add 1 GB RAM for each additional concurrent migration. If you reduce the number, you can reduce the RAM but the conversion host cannot have less than 8 GB RAM.</simpara>
</listitem>
<listitem>
<simpara><literal>/tmp</literal> (10 GB, or 1 GB for each concurrent migration)</simpara>
</listitem>
<listitem>
<simpara><literal>/var/tmp</literal> (10 GB, or 1 GB for each concurrent migration)</simpara>
</listitem>
<listitem>
<simpara><literal>/var/logs</literal> (5 GB)</simpara>
<simpara>See <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/14/html-single/instances_and_images_guide/index#section-instances">Launch an Instance</link> in the <emphasis>Red Hat OpenStack Platform Instances and Images Guide</emphasis>.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Increase the disk space of the instance to accommodate its file system. See <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/14/html-single/instances_and_images_guide/index#section-resize-instance">Resize an Instance</link> in the <emphasis>Red Hat OpenStack Platform Instances and Images Guide</emphasis>.</simpara>
<simpara>The instance is created from an image, but the disk space defined in the image will not be sufficient. You can either extend the partition (and subsequently, extend the physical volume in the volume group) to the required size, or you can create a new partition and add it as a physical volume to the volume group.</simpara>
<note>
<simpara>You must resize <literal>lv_root</literal> to use all available disk space because the image will not use it by default.</simpara>
</note>
</listitem>
</orderedlist>
<simpara>Configure your conversion hosts with CloudForms to use the VMware Virtual Disk Development Kit (VDDK).</simpara>
<note>
<simpara>The virtual disks are converted with the VMware Virtual Disk Development Kit (VDDK). If you cannot use VDDK, SSH transformation is a fallback option. See <xref linkend="Configuring_the_osp_environment_for_ssh_transformation"/>.</simpara>
</note>
</section>
<section xml:id="Configuring_the_1_2_osp_conversion_hosts_for_vddk">
<title>Configuring the conversion hosts</title>
<itemizedlist>
<title>Prerequisite</title>
<listitem>
<simpara>Download and save the VMware Virtual Disk Development Kit.</simpara>
</listitem>
</itemizedlist>
<bridgehead xml:id="Downloading_vddk_for_osp" renderas="sect4">Downloading the VMware Virtual Disk Development Kit</bridgehead>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Navigate to <link xlink:href="https://www.vmware.com/support/pubs/">VMware Documentation</link>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">VMware SDK &amp; API Product Documentation</emphasis> to expand.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">VMware Virtual Disk Development Kit (VDDK)</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Latest Releases</emphasis> and select the latest VDDK release.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Download SDKs</emphasis> to download the VDDK archive file.</simpara>
</listitem>
<listitem>
<simpara>Save the VDDK archive file in an HTTP-accessible location and record its path.</simpara>
</listitem>
</orderedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>In CloudForms, click <menuchoice><guimenu>Compute</guimenu> <guisubmenu>Migration</guisubmenu> <guimenuitem>Migration Settings</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Conversion Hosts</emphasis> tab, click <emphasis role="strong">Configure Conversion Host</emphasis>. The <emphasis role="strong">Configure Conversion Host</emphasis> wizard is displayed.</simpara>
<simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/Conversion_host_configuration_ui.png"/>
</imageobject>
<textobject><phrase>Conversion host configuration ui</phrase></textobject>
</inlinemediaobject></simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Location</emphasis> screen, add the provider details:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Select a <emphasis role="strong">Provider Type</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select a <emphasis role="strong">Provider</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select a <emphasis role="strong">Project</emphasis> and click <emphasis role="strong">Next</emphasis>.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Host(s)</emphasis> screen, select one or more hosts from the dropdown list and click <emphasis role="strong">Next</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Authentication</emphasis> screen, add the conversion hosts' SSH key and the transformation method:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Click <emphasis role="strong">Browse</emphasis> to browse to the SSH private key or paste it in the <emphasis role="strong">Conversion host SSH private key</emphasis> field.</simpara>
<simpara>The Red Hat OpenStack Platform user uses a private SSH key to connect to the conversion hosts.</simpara>
</listitem>
<listitem>
<simpara>Select <emphasis role="strong">VDDK</emphasis> as the <emphasis role="strong">Transformation method</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Enter the path of the VDDK package in the <emphasis role="strong">VDDK library path</emphasis> field and click <emphasis role="strong">Validate</emphasis>. Wait for validation to complete.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Configure</emphasis>.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Results</emphasis> screen, wait for the conversion host configuration to finish and click <emphasis role="strong">Close</emphasis>.</simpara>
<simpara>The configured conversion hosts and status information, including error messages, appear in the <emphasis role="strong">Configured Conversion Hosts</emphasis> list.</simpara>
</listitem>
</orderedlist>
<simpara>If an error occurs, you can download a host’s log by clicking the <emphasis role="strong">More Actions</emphasis> icon (<inlinemediaobject>
<imageobject>
<imagedata fileref="images/More_actions_icon.png"/>
</imageobject>
<textobject><phrase>7</phrase></textobject>
</inlinemediaobject>) and selecting <emphasis role="strong">Download Log</emphasis>.</simpara>
<simpara>You can click the <emphasis role="strong">Retry</emphasis> button if the conversion host configuration failed for reasons unconnected with your environment.</simpara>
<simpara>(Optional) Click <emphasis role="strong">Remove</emphasis> to remove the configuration from a configured conversion host.</simpara>
<simpara>You can migrate your virtual machines.</simpara>
<simpara>(Optional) You can verify the conversion hosts in a browser. See <xref linkend="Verifying_osp_conversion_hosts_in_browser"/>.</simpara>
</section>
<section xml:id="Verifying_osp_conversion_hosts_in_browser">
<title>Verifying the conversion hosts in a browser</title>
<simpara>You can verify your conversion hosts in a browser by using the CloudForms API:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>In the address bar of a browser, enter the following:</simpara>
<screen>https://<emphasis>CloudForms_FQDN</emphasis>/api/conversion_hosts <co xml:id="CO4-1"/></screen>
<calloutlist>
<callout arearefs="CO4-1">
<para><literal>CloudForms_FQDN</literal> is the FQDN of the CloudForms machine.</para>
</callout>
</calloutlist>
<simpara>A log-in screen is displayed.</simpara>
</listitem>
<listitem>
<simpara>Enter your CloudForms <emphasis role="strong">Username</emphasis> and <emphasis role="strong">Password</emphasis> and click <emphasis role="strong">Sign in</emphasis>.</simpara>
<simpara>The conversion hosts and their IDs are displayed in JSON format:</simpara>
<screen>{"name":"conversion_hosts","count":3,"subcount":3,"pages":1,"resources":[{"href":"https://cloudforms.example.com/api/conversion_hosts/10000000000001"},{"href":"https://cloudforms.example.com/api/conversion_hosts/10000000000002"},{"href":"https://cloudforms.example.com/api/conversion_hosts/10000000000003"}],"actions":[{"name":"create","method":"post","href":"https://cloudforms.example.com/api/conversion_hosts"},{"name":"edit","method":"post","href":"https://cloudforms.example.com/api/conversion_hosts"},{"name":"delete","method":"post","href":"https://cloudforms.example.com/api/conversion_hosts"}],"links":{"self":"https://cloudforms.example.com/api/conversion_hosts?offset=0","first":"https://cloudforms.example.com/api/conversion_hosts?offset=0","last":"https://cloudforms.example.com/api/conversion_hosts?offset=0"}}</screen>
</listitem>
</orderedlist>
</section>
</section>
</chapter>
<chapter xml:id="Migrating_the_virtual_machines_osp">
<title>Migrating the virtual machines</title>
<simpara>Migrating the virtual machines involves the following key tasks:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Mapping the resources of your VMware and Red Hat OpenStack Platform environments. See <xref linkend="Creating_an_infrastructure_mapping_for_osp"/>.</simpara>
</listitem>
<listitem>
<simpara>Checking for migration conditions with prerequisites. See <xref linkend="Checking_for_migration_prerequisites_osp"/>.</simpara>
</listitem>
<listitem>
<simpara>Creating and running a migration plan. See <xref linkend="Creating_a_migration_plan_in_cloudforms_osp"/>.</simpara>
</listitem>
</orderedlist>
<simpara>Optionally, you can change the maximum number of concurrent migrations for conversion hosts or providers to control the migration process.</simpara>
<section xml:id="Creating_an_infrastructure_mapping_for_osp">
<title>Creating an infrastructure mapping</title>
<simpara>The infrastructure mapping maps the resources of your VMware and Red Hat OpenStack Platform environments.</simpara>
<important>
<simpara>If you add or remove providers or provider objects from an infrastructure mapping, the mapping will have missing resource errors. You must delete the infrastructure mapping and create a new one.</simpara>
</important>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guisubmenu>Migration</guisubmenu> <guimenuitem>Infrastructure Mappings</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Create Infrastructure Mapping</emphasis>. The <emphasis role="strong">Create Infrastructure Mapping</emphasis> wizard is displayed.</simpara>
<simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/Creating_infrastructure_mapping.png"/>
</imageobject>
<textobject><phrase>Creating infrastructure mapping</phrase></textobject>
</inlinemediaobject></simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">General</emphasis> screen, add the infrastructure mapping details:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Enter the infrastructure mapping <emphasis role="strong">Name</emphasis> and (optional) <emphasis role="strong">Description</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Target Provider</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Next</emphasis>.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Map Compute</emphasis> screen, map the source and target clusters:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Select a <emphasis role="strong">Source Provider \ Datacenter \ Cluster</emphasis> source cluster and a <emphasis role="strong">Target Provider \ Project</emphasis>.</simpara>
<simpara>If the target project does not contain a conversion host, a warning icon (<inlinemediaobject>
<imageobject>
<imagedata fileref="images/warning.png" contentdepth="15px"/>
</imageobject>
<textobject><phrase>warning</phrase></textobject>
</inlinemediaobject>) appears. You can create and save an infrastructure mapping, but you must configure the conversion hosts before running a migration plan.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Add Mapping</emphasis>. You can map additional projects.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Next</emphasis>.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Map Storage</emphasis> screen, map the source and target storage:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Select a <emphasis role="strong">Source Provider \ Datacenter \ Datastore</emphasis> and <emphasis role="strong">Target Provider \ Volume Type</emphasis>.</simpara>
<simpara>If the volume type is missing, check that the volume type has been set. Block storage requires at least one volume type. See <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/14/html-single/storage_guide/#section-create-volume">Create a Volume</link> and <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/14/html-single/storage_guide/#section-volume-retype">Changing a Volume’s Type (Volume Re-typing)</link> in the <emphasis>Red Hat OpenStack Platform Storage Guide</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Add Mapping</emphasis>. You can map additional datastores.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Next</emphasis>.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Map Networks</emphasis> screen, map the source and target networks:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Select a source cluster from the drop-down list.</simpara>
</listitem>
<listitem>
<simpara>Select one or more networks from <emphasis role="strong">Source Provider \ Datacenter \ Network</emphasis> and <emphasis role="strong">Target Project \ Network</emphasis>.</simpara>
<simpara>IMS supports both provider and tenant networks.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Add Mapping</emphasis>. You can map the networks of additional source clusters.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Create</emphasis>.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Results</emphasis> screen, click <emphasis role="strong">Close</emphasis>. The infrastructure mapping is saved in <menuchoice><guimenu>Compute</guimenu> <guisubmenu>Migration</guisubmenu> <guimenuitem>Infrastructure Mappings</guimenuitem></menuchoice>.</simpara>
</listitem>
</orderedlist>
<simpara>You can click an infrastructure mapping element to view its details:</simpara>
<formalpara>
<title>Infrastructure Mappings list</title>
<para><inlinemediaobject>
<imageobject>
<imagedata fileref="images/Infra_mappings_list.png"/>
</imageobject>
<textobject><phrase>Infra mappings list</phrase></textobject>
</inlinemediaobject></para>
</formalpara>
<simpara>After you have created an infrastructure mapping, check for migration prerequisites.</simpara>
<simpara>If these conditions do not apply, you can create a migration plan. See <xref linkend="Creating_a_migration_plan_in_cloudforms_osp"/>.</simpara>
</section>
<section xml:id="Checking_for_migration_prerequisites_osp">
<title>Checking for migration prerequisites</title>
<simpara>Check your migration for the following conditions, which have prerequisites:</simpara>
<variablelist>
<varlistentry>
<term>You are migrating previously migrated virtual machines</term>
<listitem>
<simpara>Add previously migrated machines to the migration plan with a CSV file. A CSV file is also recommended for large migrations.</simpara>
<simpara>See <xref linkend="Creating_a_csv_file_to_add_virtual_machines_to_the_migration_plan_osp"/>.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>You are using Ansible playbooks for premigration/postmigration tasks</term>
<listitem>
<simpara>Create an Ansible repository and add credentials and playbooks to CloudForms.</simpara>
<simpara>See <xref linkend="Adding_ansible_playbooks_to_cloudforms_osp"/>.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>You are migrating virtual machines running RHEL or other Linux operating system</term>
<listitem>
<simpara>Create a RHEL premigration playbook to preserve IP addresses and select this playbook when you create a migration plan.</simpara>
<simpara>See <xref linkend="Adding_ansible_playbooks_to_cloudforms_osp"/> and <xref linkend="Creating_a_rhel_premigration_playbook_osp"/>.</simpara>
</listitem>
</varlistentry>
</variablelist>
<section xml:id="Creating_a_csv_file_to_add_virtual_machines_to_the_migration_plan_osp">
<title>Creating a CSV file to add virtual machines to the migration plan</title>
<simpara>If you are migrating virtual machines that were migrated in the past, you should create a CSV file to add the virtual machines to the migration plan, because the migration plan cannot discover them automatically.</simpara>
<note>
<simpara>A CSV file is recommended for large migrations because it is faster than manually selecting the security group and flavor of each virtual machine.</simpara>
</note>
<table frame="all" rowsep="1" colsep="1">
<title>CSV file fields</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="75*"/>
<thead>
<row>
<entry align="left" valign="top">Field</entry>
<entry align="left" valign="top">Comments</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>Name</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Virtual machine name. <emphasis role="strong">Required</emphasis></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>Host</literal></simpara></entry>
<entry align="left" valign="top"><simpara><emphasis role="strong">Optional</emphasis>. Only required if virtual machines have identical <literal>Name</literal> fields.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>Provider</literal></simpara></entry>
<entry align="left" valign="top"><simpara><emphasis role="strong">Optional</emphasis>. Only required if virtual machines have identical <literal>Name</literal> and <literal>Host</literal> fields.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>Security Group</literal></simpara></entry>
<entry align="left" valign="top"><simpara><emphasis role="strong">Optional.</emphasis> The default is <literal>Default</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>Flavor</literal></simpara></entry>
<entry align="left" valign="top"><simpara><emphasis role="strong">Optional</emphasis> If you do not create flavors for the migration or if you leave this field blank, CloudForms tries to map the source virtual machines to existing flavors.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<formalpara>
<title>CSV file example</title>
<para>
<screen>Name,Host,Provider,Security Group,Flavor
vm01,host1,vSphere3,webservers,x1.medium
vm02,host1,vSphere3,webservers,x1.medium
vm03,host1,vSphere3,webservers,x1.medium</screen>
</para>
</formalpara>
</section>
<section xml:id="Adding_ansible_playbooks_to_cloudforms_osp">
<title>Adding Ansible playbooks to CloudForms for premigration and postmigration tasks</title>
<simpara>You can add Ansible playbooks to CloudForms to perform automated premigration and postmigration tasks on specific virtual machines, for example:</simpara>
<itemizedlist>
<listitem>
<simpara>Removing webservers from a load-balancing pool before migration and returning them to the pool after migration</simpara>
</listitem>
<listitem>
<simpara>Running <literal>fstrim</literal> after migration to reduce the space required by virtual machines migrating to Red Hat OpenStack Platform with Ceph storage</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Enable the <literal>Embedded Ansible</literal> server role in CloudForms. See <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_cloudforms/4.7/html/managing_providers/automation_management_providers#enabling-embedded-ansible-server-role">Enabling the Embedded Ansible Server Role</link> in <emphasis>Red Hat CloudForms: Managing Providers</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Add an Ansible playbook repository. See <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_cloudforms/4.7/html/managing_providers/automation_management_providers#adding-a-playbook-repository">Adding a Playbook Repository</link> in <emphasis>Red Hat CloudForms: Managing Providers</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Add the credentials of each virtual machine that you are migrating. See <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_cloudforms/4.7/html/managing_providers/automation_management_providers#ansible-credentials">Credentials</link> in <emphasis>Red Hat CloudForms: Managing Providers</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Add your playbook as an Ansible service catalog item. See <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_cloudforms/4.7/html-single/provisioning_virtual_machines_and_instances/#create-playbook-service-catalog-item">Creating an Ansible Playbook Service Catalog Item</link> in <emphasis>Red Hat CloudForms: Provisioning Virtual Machines and Instances</emphasis>.</simpara>
</listitem>
</orderedlist>
<simpara>You will select the playbooks and the virtual machines on which they run in the <emphasis role="strong">Advanced Options</emphasis> screen when you create the migration plan.</simpara>
</section>
<section xml:id="Creating_a_rhel_premigration_playbook_osp">
<title>Creating a <literal>RHEL premigration</literal> playbook for RHEL/Linux source virtual machines</title>
<simpara>If you are migrating virtual machines running RHEL or other Linux operating system, you can create a <literal>RHEL premigration</literal> playbook to ensure that the IP addresses are accessible after migration. The <literal>RHEL premigration</literal> playbook calls the Ansible <literal>ims.rhel_premigration</literal> role.</simpara>
<simpara>To install the role with Ansible Galaxy, see <link xlink:href="https://galaxy.ansible.com/fdupont_redhat/ims_rhel_pre_migration">ims_rhel_pre_migration</link>. This role is not included in the IMS installation.</simpara>
<simpara>The <literal>ims.rhel_premigration</literal> role performs the following tasks on the VMware virtual machines:</simpara>
<itemizedlist>
<listitem>
<simpara>Preserves the static IP address configuration by creating udev rules to associate the virtual machine’s MAC address with its interface name</simpara>
</listitem>
</itemizedlist>
<note>
<simpara>The <literal>ims.rhel_premigration</literal> role assumes that either the <literal>rhel-6-server-rpms</literal> or the <literal>rhel-7-server-rpms</literal> repository is enabled in the source virtual machine when it installs <literal>qemu-guest-agent</literal>. If you have disabled the repository, re-enable it in the RHEL premigration playbook.</simpara>
</note>
<formalpara>
<title><literal>RHEL premigration</literal> playbook example</title>
<para>
<programlisting language="yml" linenumbering="unnumbered">---
- hosts: all
  roles:
    - role: ims.rhel_pre_migration</programlisting>
</para>
</formalpara>
<simpara>You can create a migration plan. See <xref linkend="Creating_a_migration_plan_in_cloudforms_osp"/>.</simpara>
</section>
</section>
<section xml:id="Creating_a_migration_plan_in_cloudforms_osp">
<title>Creating and running a migration plan</title>
<simpara>Before you perform a large migration, you should perform several test migrations with different maximum numbers of concurrent migrations for your conversion hosts or providers. This will enable you to assess the capabilities of your environment’s infrastructure.</simpara>
<simpara>You can create and run a migration plan in CloudForms with the following options:</simpara>
<itemizedlist>
<listitem>
<simpara>Running a migration plan immediately</simpara>
</listitem>
<listitem>
<simpara><link linkend="Scheduling_a_saved_migration_plan_osp">Scheduling a migration plan to run in the future</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="Viewing_migration_plan_progress_osp">Viewing a migration plan in progress</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="Canceling_a_migration_plan_osp">Canceling a migration plan in progress</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="Retrying_a_failed_migration_plan_osp">Retrying a failed migration plan</link></simpara>
</listitem>
</itemizedlist>
<note>
<simpara>A CSV file is optional, but recommended, for large migrations because it is faster than manually selecting the security group and flavor of each virtual machine.</simpara>
</note>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guisubmenu>Migration</guisubmenu> <guimenuitem>Migration Plans</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Create Migration Plan</emphasis>. The <emphasis role="strong">Create Migration Plan</emphasis> wizard is displayed.</simpara>
<simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/Create_Migration_Plan_screen.png"/>
</imageobject>
<textobject><phrase>Create Migration Plan screen</phrase></textobject>
</inlinemediaobject></simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">General</emphasis> screen, add the details of the migration plan:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Select an infrastructure mapping from the drop-down list.</simpara>
</listitem>
<listitem>
<simpara>Enter the migration plan <emphasis role="strong">Name</emphasis> and (optional) <emphasis role="strong">Description</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select a virtual machine discovery method:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Choose from a list of VMs discovered in the selected infrastructure mapping</emphasis></simpara>
<simpara>If the virtual machines cannot be discovered, check that the source datastores and networks in the infrastructure mapping are correct.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Import a CSV file with a list of VMs to be migrated</emphasis>.</simpara>
<simpara>A CSV file is required for previously migrated source virtual machines and recommended for large migrations.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Next</emphasis>.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">VMs</emphasis> screen, select the virtual machines for migration:</simpara>
<itemizedlist>
<listitem>
<simpara>If you selected <emphasis role="strong">Choose from a list of VMs discovered in the selected infrastructure mapping</emphasis>, select the virtual machines for migration.</simpara>
<simpara>You can search for virtual machines by <emphasis role="strong">VM Name</emphasis>, <emphasis role="strong">Data Center</emphasis>, <emphasis role="strong">Cluster</emphasis>, and <emphasis role="strong">Folder</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>If you selected <emphasis role="strong">Import a CSV file with a list of VMs to be migrated</emphasis>:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Click <emphasis role="strong">Import</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Browse to the CSV file and click <emphasis role="strong">Open</emphasis>.</simpara>
<simpara>If the virtual machines cannot be added to the migration plan, check the CSV file format and fields for errors.</simpara>
<note>
<simpara>If the <emphasis role="strong">Create Migration Plan</emphasis> wizard freezes, refresh the web page, check the CSV file for errors (for example, virtual machines with duplicate <literal>Name</literal> fields and no other fields to distinguish them), and create a new migration plan.</simpara>
</note>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Next</emphasis>.</simpara>
</listitem>
</orderedlist>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Instance Properties</emphasis> screen, select the networks and/or flavors:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Click the pencil icon to edit the network or flavor of each selected virtual machine.</simpara>
<simpara>Flavors that are too small for the virtual machine are marked with an asterisk (<literal>*</literal>). If you have not created flavors for the migration, CloudForms tries to map the source virtual machines to existing flavors.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Next</emphasis>.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Advanced Options</emphasis> screen, select the playbook service options:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Select a premigration and/or postmigration playbook service from the dropdown lists.</simpara>
</listitem>
<listitem>
<simpara>Select the virtual machines on which to run the playbook services.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Next</emphasis>.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Schedule</emphasis> screen, select a schedule option and click <emphasis role="strong">Create</emphasis>:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Save migration plan to run later</emphasis></simpara>
<simpara>The migration plan is saved in <emphasis role="strong">Migration Plans Not Started</emphasis> and will not run unless you schedule it or click <emphasis role="strong">Migrate</emphasis> to run the scheduled migration plan immediately.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Start migration immediately</emphasis></simpara>
<simpara>The migration plan may take some time to complete. Progress bars indicate the amount of transferred data, the number of migrated virtual machines, and the elapsed time. See <xref linkend="Viewing_migration_plan_progress_osp"/> for details.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Results</emphasis> screen, click <emphasis role="strong">Close</emphasis>.</simpara>
</listitem>
</orderedlist>
<simpara>When the migration plan has finished, click <emphasis role="strong">Migration Plans Complete</emphasis> to view the status of the migration plan. The completed migration plan shows the status of the migrated virtual machines.</simpara>
<simpara>In the migration plans list, you can click the <emphasis role="strong">More Actions</emphasis> icon (<inlinemediaobject>
<imageobject>
<imagedata fileref="images/More_actions_icon.png"/>
</imageobject>
<textobject><phrase>7</phrase></textobject>
</inlinemediaobject>) to archive, edit, or delete a migration plan.</simpara>
<section xml:id="Scheduling_a_saved_migration_plan_osp">
<title>Scheduling a saved migration plan</title>
<simpara>To schedule a saved migration plan to run in the future:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <emphasis role="strong">Migration Plans Not Started</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Schedule</emphasis> button of a migration plan.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Schedule Migration Plan</emphasis> window, select a date and time and click <emphasis role="strong">Schedule</emphasis>. The plan’s status is <emphasis role="strong">Migration Scheduled</emphasis> with the date and time.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Viewing_migration_plan_progress_osp">
<title>Viewing a migration plan in progress</title>
<simpara>To view the progress of a migration plan:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <emphasis role="strong">Migration Plans in Progress</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click a migration plan name to view its details, including the status of the migrating virtual machines.</simpara>
</listitem>
</orderedlist>
<note>
<simpara>The counter in <menuchoice><guimenu>Compute</guimenu> <guisubmenu>Migration</guisubmenu> <guimenuitem>Migration Plans</guimenuitem></menuchoice> may be a few seconds ahead of the counter in the migration plan details view. This is because the <emphasis role="strong">Migration Plans</emphasis> counter displays the total time for running the migration plan, while the details counter displays the time for migrating the virtual machines.</simpara>
</note>
</section>
<section xml:id="Canceling_a_migration_plan_osp">
<title>Canceling a migration plan in progress</title>
<simpara>To cancel a migration plan in progress:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <emphasis role="strong">Migration Plans in Progress</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select a migration plan and click <emphasis role="strong">Cancel Migration</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Cancel Migrations</emphasis> to confirm the cancellation. The canceled migration appears in <emphasis role="strong">Migration Plans Complete</emphasis> with a red <literal>x</literal> indicating that the plan did not complete successfully.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Retrying_a_failed_migration_plan_osp">
<title>Retrying a failed migration plan</title>
<simpara>To retry a migration plan that failed because of external circumstances (for example, power outage):</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Delete all objects created by the failed migration plan:</simpara>
<itemizedlist>
<listitem>
<simpara>Delete newly created instances to avoid name conflicts with migrating VMware virtual machines.</simpara>
</listitem>
<listitem>
<simpara>Delete network ports of failed instances.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guisubmenu>Migration</guisubmenu> <guimenuitem>Migration Plans</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Migration Plans Complete</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Retry</emphasis> button beside the failed migration plan.</simpara>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="Changing_the_maximum_number_of_concurrent_migrations_osp">
<title>Changing the maximum number of concurrent migrations</title>
<simpara>You can change the maximum number of concurrent migrations for conversion hosts or providers to control the impact of the migration process on your infrastructure.</simpara>
<simpara>The provider setting has priority over the conversion host setting. For example, if the maximum number of concurrent migrations is <literal>20</literal> for a provider and <literal>3</literal> for five conversion hosts, the maximum number of concurrent migrations is <literal>20</literal>, not <literal>15</literal> (<literal>5</literal> conversion hosts <literal>x 3</literal> concurrent migrations per host).</simpara>
<simpara>An increase in the maximum number of concurrent migrations affects all migration plans immediately. Virtual machines that are queued to migrate will migrate in greater numbers.</simpara>
<simpara>A decrease maximum number of concurrent migrations affects only future migration plans. Migration plans that are in progress will use the limit that was set when the plan was created.</simpara>
<variablelist>
<varlistentry>
<term>Changing the maximum number of concurrent migrations for all conversion hosts or providers</term>
<listitem>
</listitem>
</varlistentry>
</variablelist>
<caution>
<simpara>Red Hat OpenStack Platform conversion hosts require an additional 1 GB RAM for each additional concurrent migration above <literal>10</literal>.</simpara>
<simpara>If you are using VDDK transformation, the number of concurrent migrations must not exceed <literal>20</literal>. Otherwise, network overload will cause the migration to fail.</simpara>
</caution>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guisubmenu>Migration</guisubmenu> <guimenuitem>Migration Settings</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Migration Throttling</emphasis> tab, select a value for <emphasis role="strong">Maximum concurrent migrations per conversion host</emphasis> or <emphasis role="strong">Maximum concurrent migrations per provider</emphasis> and click <emphasis role="strong">Apply</emphasis>.</simpara>
<simpara>The value of <emphasis role="strong">Maximum concurrent migrations per conversion host</emphasis> is constrained so that it cannot be greater than <emphasis role="strong">Maximum concurrent migrations per provider</emphasis>.</simpara>
<note>
<simpara>In the current release, the <emphasis role="strong">Maximum concurrent migrations per conversion host</emphasis> interface control does not work.</simpara>
</note>
</listitem>
</orderedlist>
<variablelist>
<varlistentry>
<term>Changing the maximum number of concurrent migrations for a specific conversion host</term>
<listitem>
<orderedlist numeration="arabic">
<listitem>
<simpara>Enter the following command:</simpara>
</listitem>
</orderedlist>
<screen># curl -sk -u <emphasis>username</emphasis>:_password_ <emphasis>https://<emphasis>CloudForms_FQDN</emphasis>/api/conversion_hosts/<emphasis>conversion_host_id</emphasis></emphasis> -X POST -d <emphasis>{"action": "edit", "resource": {"max_concurrent_tasks": <emphasis>15</emphasis>}}</emphasis> <co xml:id="CO5-1"/> <co xml:id="CO5-2"/> <co xml:id="CO5-3"/> <co xml:id="CO5-4"/></screen>
</listitem>
</varlistentry>
</variablelist>
<calloutlist>
<callout arearefs="CO5-1">
<para><literal>username</literal> and <literal>password</literal> are the username and password for CloudForms.</para>
</callout>
<callout arearefs="CO5-2">
<para><literal>CloudForms_FQDN</literal> is the FQDN of the CloudForms machine.</para>
</callout>
<callout arearefs="CO5-3">
<para>To obtain a <literal>conversion_host_id</literal>, enter the following command:</para>
<screen># curl -sk -u <emphasis>username:password</emphasis> <emphasis>https://<emphasis>CloudForms_FQDN</emphasis>/api/conversion_hosts/</emphasis></screen>
</callout>
<callout arearefs="CO5-4">
<para><literal>max_concurrent_tasks</literal> is the maximum number of concurrent migrations. The default is <literal>10</literal>.</para>
</callout>
</calloutlist>
</section>
</chapter>
<chapter xml:id="Troubleshooting_osp">
<title>Troubleshooting</title>
<simpara>To identify errors, you can review the migration logs. See <xref linkend="Migration_logs_osp"/>.</simpara>
<simpara>You can check these common issues and mistakes:</simpara>
<itemizedlist>
<listitem>
<simpara>Infrastructure mapping errors. See <xref linkend="Infrastructure_mapping_errors_osp"/>.</simpara>
</listitem>
<listitem>
<simpara>Migration plan errors. See <xref linkend="Migration_plan_errors_osp"/>.</simpara>
</listitem>
<listitem>
<simpara>IP address errors. See <xref linkend="IP_address_errors_osp"/>.</simpara>
</listitem>
<listitem>
<simpara>Environment configuration errors. See <xref linkend="Environment_configuration_errors_osp"/>.</simpara>
</listitem>
</itemizedlist>
<simpara><xref linkend="Known_issues_osp"/> provides information about issues that will be addressed in a future release.</simpara>
<section xml:id="Migration_logs_osp">
<title>Migration logs</title>
<simpara>You can check the following logs to identify the cause of a migration error:</simpara>
<itemizedlist>
<listitem>
<simpara>Conversion host logs. See <xref linkend="conversion_host_playbook_logs_osp"/>.</simpara>
</listitem>
<listitem>
<simpara>Playbook logs, if you are using premigration or postmigration Ansible playbooks. See <xref linkend="conversion_host_playbook_logs_osp"/>.</simpara>
</listitem>
<listitem>
<simpara>CloudForms migration log. See <xref linkend="Cloudforms_migration_log_osp"/>.</simpara>
</listitem>
</itemizedlist>
<section xml:id="conversion_host_playbook_logs_osp">
<title>Downloading the conversion host and playbook logs</title>
<simpara>You can download the conversion host and playbooks logs in CloudForms.</simpara>
<simpara>When disk migration starts, two logs are created in the conversion host:</simpara>
<itemizedlist>
<listitem>
<simpara><literal>virt-v2v</literal>: Debug output from <literal>virt-v2v</literal> itself. This log tracks the core of the virtual machine migration process, including <literal>libguestfs</literal> traces and disk migration details.</simpara>
</listitem>
<listitem>
<simpara><literal>virt-v2v-wrapper</literal>: Log of the daemonizing wrapper for <literal>virt-v2v</literal>. This log traces the orchestration of the virtual machine conversion on the conversion host, including disk migration percentages and <literal>virt-v2v</literal> error reporting.</simpara>
</listitem>
</itemizedlist>
<important>
<simpara>If you open a <link xlink:href="https://access.redhat.com/support/cases/#/case/new">Red Hat Support call</link>, you will need to submit both the <literal>virt-v2v</literal> log and <literal>virt-v2v-wrapper</literal> log for analysis and troubleshooting.</simpara>
</important>
<simpara>To access the conversion host logs and the playbook logs:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guisubmenu><emphasis role="strong">Migration</emphasis></guisubmenu> <guimenuitem>Migration Plans</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click a completed migration plan to view its details.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Download Log</emphasis> of a virtual machine and select a log from the dropdown list:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Premigration log</emphasis> This option only appears if a premigration playbook is used.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Migration log</emphasis> The <emphasis role="strong">Migration log</emphasis> is the <literal>virt-v2v</literal> log.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Virt-v2v-wrapper log</emphasis></simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Postmigration log</emphasis> This option only appears if a postmigration playbook is used.</simpara>
</listitem>
</itemizedlist>
</listitem>
</orderedlist>
</section>
<section xml:id="Cloudforms_migration_log_osp">
<title>Accessing the CloudForms migration log</title>
<orderedlist numeration="arabic">
<listitem>
<simpara>Log into the CloudForms machine using SSH.</simpara>
</listitem>
<listitem>
<simpara>The migration log is <literal>/var/www/miq/vmdb/log/automation.log</literal>.</simpara>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="Infrastructure_mapping_errors_osp">
<title>Infrastructure mapping errors</title>
<itemizedlist>
<listitem>
<simpara><literal>Networks missing</literal>, <literal>Datastores missing</literal>, and <literal>Clusters missing</literal> error messages: If you create an infrastructure mapping and then change a provider, the provider’s object IDs change. Delete the infrastructure mapping and create a new one.</simpara>
</listitem>
<listitem>
<simpara>Storage volume type not detected: Check that you have set at least one volume type. See <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/14/html-single/storage_guide/index#section-volumes-advanced-vol-type">Group Volume Settings with Volume Types</link> in the <emphasis>Red Hat OpenStack Platform Storage Guide</emphasis> for the storage.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="Migration_plan_errors_osp">
<title>Migration plan errors</title>
<itemizedlist>
<listitem>
<simpara>If the virtual machines are being migrated for the first time and are not discovered by the migration plan, check the source datastores and networks in the infrastructure mapping.</simpara>
</listitem>
<listitem>
<simpara>If the virtual machines have been migrated in the past, they cannot be discovered by the migration plan. Use a CSV file to add the virtual machines to the migration plan.</simpara>
</listitem>
<listitem>
<simpara>If the virtual machines cannot be added to the migration plan with a CSV file, check the CSV file format and fields. Create a new migration plan with the updated CSV file.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Create Migration Plan</emphasis> wizard hangs while importing a CSV file. This error is caused by an invalid CVS file (for example, virtual machines with a duplicate <literal>Name</literal> field and no <literal>Host</literal>/<literal>Provider</literal> field to distinguish them, or with a duplicate <literal>Name</literal> field and duplicate <literal>Host</literal>/<literal>Provider</literal> fields). Refresh the web page.</simpara>
</listitem>
<listitem>
<simpara><literal>Denied State</literal> error (IMS 1.1). If a migration plan fails immediately and the migration plan displays a <literal>Denied State</literal> error message, check that you have created and configured the conversion hosts correctly. Cancel the migration plan and run it again.</simpara>
</listitem>
<listitem>
<simpara><literal>Unable to migrate VMs because no conversion host was configured at the time of the attempted migration. See the product documentation for information on configuring conversion hosts.</literal> (IMS 1.2) You can create and save a migration plan whose infrastructure mapping does not contain conversion hosts, but you cannot run the migration plan without conversion hosts. Cancel the migration plan, create the conversion hosts, and run the migration plan again.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="IP_address_errors_osp">
<title>IP address errors</title>
<itemizedlist>
<listitem>
<simpara>If the IP address of a migrated RHEL (or other Linux-based operating system) virtual machine is not accessible, you must create a <literal>RHEL premigration</literal> playbook and add it to the migration plan.</simpara>
</listitem>
<listitem>
<simpara>If a migrated virtual machine does not have an IP address:</simpara>
<itemizedlist>
<listitem>
<simpara>Check that you installed VMware Tools on the VMware virtual machine before migration.</simpara>
</listitem>
<listitem>
<simpara>Check the VMware virtual machine for an interface configuration file mapped to a non-existent interface (for example, <literal>/etc/sysconfig/network-scripts/ifcfg-eth1</literal> exists, but <literal>eth1</literal> interface does not). Log example:</simpara>
<screen>CalledProcessError: Command '['openstack', u'--os-username=admin', u'--os-identity-api-version=3', u'--os-user-domain-name=default', u'--os-auth-url=http://<emphasis>osp.example.com</emphasis>:5000/v3', u'--os-project-name=admin', u'--os-password=****<emphasis role="strong">*</emphasis>*<emphasis>, u</emphasis>--os-project-id=0123456789abcdef0123456789abcdef', 'port', 'create', '--format', 'json', '--network', u'01234567-89ab-cdef-0123-456789abcdef', '--mac-address', u'00:50:56:01:23:45', '--enable', u'port_0', '--fixed-ip', '<emphasis role="strong">ip-address=None</emphasis>'"]' returned non-zero exit status 1
<emphasis>date</emphasis> <emphasis>time</emphasis>:ERROR: Command output:
BadRequestException: Unknown errors</screen>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
</section>
<section xml:id="Environment_configuration_errors_osp">
<title>Environment configuration errors</title>
<itemizedlist xml:id="VMware_environment_errors_osp">
<title>VMware</title>
<listitem>
<simpara>A VMware virtual machine cannot be migrated if it has any of the following conditions:</simpara>
<itemizedlist>
<listitem>
<simpara>Mounted ISO/CDROM disk</simpara>
</listitem>
<listitem>
<simpara>Encrypted disk</simpara>
</listitem>
<listitem>
<simpara>Invalid name, containing spaces or special characters</simpara>
</listitem>
<listitem>
<simpara>Powered off during migration</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>If you are performing more than ten concurrent migrations from a single VMware hypervisor, you must increase the hypervisor’s NFC service memory.</simpara>
</listitem>
</itemizedlist>
<itemizedlist xml:id="osp_environment_errors">
<title>Red Hat OpenStack Platform</title>
<listitem>
<simpara><literal>disallowed by policy</literal> error: The Red Hat OpenStack Platform <literal>admin</literal> user in CloudForms does not have <literal>admin</literal> role privileges within the target project. Add the <literal>admin</literal> user as <literal>member</literal> and <literal>admin</literal> to your target project. See <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/14/html-single/users_and_identity_management_guide/#edit_a_project">Edit a Project</link> in the <emphasis>Red Hat OpenStack Platform Users and Identity Management Guide</emphasis>.</simpara>
<screen>ERROR: Command exited with non-zero return code 1, output: HttpException: 403: Client Error for url: https://<emphasis>FQDN</emphasis>:13696/v2.0/ports, {"NeutronError": {"message": "((rule:create_port and rule:create_port:mac_address) and rule:create_port:fixed_ips) is disallowed by policy", "type": "PolicyNotAuthorized", "detail": ""}}</screen>
</listitem>
</itemizedlist>
</section>
<section xml:id="Known_issues_osp">
<title>Known Issues</title>
<simpara>The following issues will be addressed in a future release:</simpara>
<itemizedlist>
<listitem>
<simpara>BZ#1666799: <link xlink:href="https://bugzilla.redhat.com/show_bug.cgi?id=1666799">Canceling migration does not stop creating volume, instance, and network port on OpenStack Platform or VMs on Red Hat Virtualization</link></simpara>
</listitem>
<listitem>
<simpara>BZ#1678385: <link xlink:href="https://bugzilla.redhat.com/show_bug.cgi?id=1678385">Virtual machine with name containing spaces (<emphasis>rhel 7</emphasis>) fails to migrate using SSH and VDDK transformation</link></simpara>
</listitem>
<listitem>
<simpara>BZ#1699343: <link xlink:href="https://bugzilla.redhat.com/show_bug.cgi?id=1699343">Migration plan CSV import validation does not work if file contains empty/archived/orphan/invalid VM name</link></simpara>
</listitem>
<listitem>
<simpara>BZ#1698761: <link xlink:href="https://bugzilla.redhat.com/show_bug.cgi?id=1698761">"Maximum concurrent migrations per conversion host" interface control does not work</link></simpara>
</listitem>
<listitem>
<simpara>BZ#716283: <link xlink:href="https://bugzilla.redhat.com/show_bug.cgi?id=1716283">Migrating virtual machines are not distributed correctly among the conversion hosts</link></simpara>
</listitem>
<listitem>
<simpara>BZ#1726939: <link xlink:href="https://bugzilla.redhat.com/show_bug.cgi?id=1726939">Run the preflight check of migration task before waiting for a conversion host</link>. Currently, the preflight check that monitors the migration is performed after a conversion host is assigned to the task. As a result, the total volume of the Datastores reported in <emphasis role="strong">Migration Plans In Progress</emphasis> reflects the total volume of the virtual machines that are currently migrating, not the total volume of the migration plan. When all the virtual machines have started to migrate, the correct value of the total volume is displayed.</simpara>
</listitem>
<listitem>
<simpara>BZ#1668049: <link xlink:href="https://bugzilla.redhat.com/show_bug.cgi?id=1668049">Instance is not created after disk conversion</link></simpara>
</listitem>
<listitem>
<simpara>BZ#1669133: <link xlink:href="https://bugzilla.redhat.com/show_bug.cgi?id=1669133">Names of virtual machines migrated using SSH transformation are changed</link></simpara>
</listitem>
<listitem>
<simpara>CloudForms CFME 5.10.4 does not support migration. Use CFME 5.10.3.</simpara>
</listitem>
</itemizedlist>
</section>
</chapter>
<appendix xml:id="Configuring_the_osp_environment_for_ssh_transformation">
<title>Configuring the Red Hat OpenStack Platform environment for SSH transformation</title>
<simpara>You can configure your environment for SSH transformation if you cannot use VDDK.</simpara>
<simpara>Configuring your environment involves the following additional steps:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Configuring the VMware hypervisors. See <xref linkend="Configuring_the_vmware_hypervisors_for_ssh_transformation_osp"/>.</simpara>
</listitem>
<listitem>
<simpara>Configuring the conversion hosts. See <xref linkend="Configuring_the_osp_conversion_hosts_for_ssh"/>.</simpara>
</listitem>
<listitem>
<simpara>Copying the VMware keys to the conversion hosts. See <xref linkend="Copying_vmware_keys_to_osp_conversion_hosts"/>.</simpara>
</listitem>
</orderedlist>
<section xml:id="Configuring_the_vmware_hypervisors_for_ssh_transformation_osp">
<title>Configuring the VMware hypervisors for SSH transformation</title>
<simpara>For SSH transformation, you must configure the VMware hypervisors for passwordless access by sharing a conversion host’s public SSH key with the hypervisors.</simpara>
<important>
<simpara>A single SSH key pair is recommended because the key pair is used only for virtual machine conversion and it simplifies conversion host management.</simpara>
<simpara>If you wish to use a dedicated SSH key pair for each conversion host, you can copy the public key of each conversion host to all the VMware hypervisors.</simpara>
</important>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Enable SSH access on each VMware hypervisor. For instructions, navigate to <link xlink:href="https://docs.vmware.com/en/VMware-vSphere/index.html">VMware vSphere Documentation</link> and enter <literal>Enable ESXi Shell and SSH Access with the Direct Console User Interface]</literal> in the <emphasis role="strong">Search</emphasis> field.</simpara>
<simpara>You can collect the SSH public keys of the VMware hypervisors at this stage, to copy to the conversion hosts.</simpara>
</listitem>
<listitem>
<simpara>Generate an SSH key pair without a passphrase:</simpara>
<screen># ssh-keygen -N ''</screen>
</listitem>
<listitem>
<simpara>Copy the public SSH key to <literal>/etc/ssh/keys-root/authorized_keys</literal> on <emphasis role="strong">each</emphasis> VMware hypervisor.</simpara>
<simpara>You will use the private SSH key to configure the conversion hosts.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Configuring_the_osp_conversion_hosts_for_ssh">
<title>Configuring the conversion hosts</title>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>In CloudForms, click <menuchoice><guimenu>Compute</guimenu> <guisubmenu>Migration</guisubmenu> <guimenuitem>Migration Settings</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Conversion Hosts</emphasis> tab, click <emphasis role="strong">Configure Conversion Host</emphasis>. The <emphasis role="strong">Configure Conversion Host</emphasis> wizard is displayed.</simpara>
<simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/Conversion_host_configuration_ui.png"/>
</imageobject>
<textobject><phrase>Conversion host configuration ui</phrase></textobject>
</inlinemediaobject></simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Location</emphasis> screen, add the provider details:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Select a <emphasis role="strong">Provider Type</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select a <emphasis role="strong">Provider</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select a <emphasis role="strong">Project</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Next</emphasis>.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Host(s)</emphasis> screen, select one or more hosts from the dropdown list and click <emphasis role="strong">Next</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Authentication</emphasis> screen, add the conversion hosts' SSH key and the transformation method:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Click <emphasis role="strong">Browse</emphasis> to browse to the SSH private key or paste it in the <emphasis role="strong">Conversion host SSH private key</emphasis> field.</simpara>
<simpara>The Red Hat OpenStack Platform user uses a private SSH key to connect to the conversion hosts.</simpara>
</listitem>
<listitem>
<simpara>Select <emphasis role="strong">SSH</emphasis> as the <emphasis role="strong">Transformation method</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Browse</emphasis> to browse to the SSH private key you created for enabling SSH access on the VMware hypervisors or paste it in the <emphasis role="strong">VMware hypervisors SSH private key</emphasis> field.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Configure</emphasis>.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Results</emphasis> screen, wait for the conversion host configuration to finish and click <emphasis role="strong">Close</emphasis>.</simpara>
<simpara>The configured conversion hosts and status information, including error messages, appear in the <emphasis role="strong">Configured Conversion Hosts</emphasis> list.</simpara>
</listitem>
</orderedlist>
<simpara>If an error occurs, you can download a host’s log by clicking the <emphasis role="strong">More Actions</emphasis> icon (<inlinemediaobject>
<imageobject>
<imagedata fileref="images/More_actions_icon.png"/>
</imageobject>
<textobject><phrase>7</phrase></textobject>
</inlinemediaobject>) and selecting <emphasis role="strong">Download Log</emphasis>.</simpara>
<simpara>You can click the <emphasis role="strong">Retry</emphasis> button if the conversion host configuration failed for reasons unconnected with your environment.</simpara>
<simpara>(Optional) Click <emphasis role="strong">Remove</emphasis> to remove the configuration from a configured conversion host.</simpara>
</section>
<section xml:id="Copying_vmware_keys_to_osp_conversion_hosts">
<title>Copying the VMware SSH keys to the conversion hosts</title>
<simpara>Copy the SSH public keys of the VMware hypervisors to the conversion hosts. You can collect the VMware keys either when you configure the VMware hypervisors for SSH transformation or by using <literal>ssh-keyscan</literal>:</simpara>
<itemizedlist>
<listitem>
<simpara><link linkend="Copying_collected_ssh_keys_osp">Copying keys collected during VMware hypervisor configuration</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="Copying_keys_ssh_keyscan_osp">Copying keys collected with <literal>ssh-keyscan</literal></link></simpara>
</listitem>
</itemizedlist>
<section xml:id="Copying_collected_ssh_keys_osp">
<title>Copying keys collected during VMware hypervisor configuration</title>
<orderedlist numeration="arabic">
<listitem>
<simpara>Copy the VMware keys to <literal>/root/.ssh/known_hosts</literal> on each conversion host.</simpara>
</listitem>
<listitem>
<simpara>On each conversion host, verify the SSH connection by connecting to each VMware hypervisor as <literal>cloud-user</literal>:</simpara>
<screen># sudo -u cloud-user ssh root@<emphasis>esx1.example.com</emphasis></screen>
<simpara>If the connection fails, check that the VMware hypervisor has SSH access enabled and that you copied the correct keys.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Copying_keys_ssh_keyscan_osp">
<title>Copying keys collected with <literal>ssh-keyscan</literal></title>
<caution>
<simpara>You must run <literal>ssh-keyscan</literal> for each VMware hypervisor. Otherwise your conversion hosts will not have all the VMware hypervisor keys and the migration will fail.</simpara>
</caution>
<orderedlist numeration="arabic">
<listitem>
<simpara>Run <literal>ssh-keyscan</literal> for each VMware hypervisor and copy its public key to <literal>known_hosts</literal>, as in the following example:</simpara>
<screen># ssh-keyscan <emphasis>esx1_IP</emphasis> &gt; /root/.ssh/known_hosts <co xml:id="CO6-1"/>
# ssh-keyscan <emphasis>esx2_IP</emphasis> &gt;&gt; /root/.ssh/known_hosts
# ssh-keyscan <emphasis>esx3_IP</emphasis> &gt;&gt; /root/.ssh/known_hosts</screen>
<calloutlist>
<callout arearefs="CO6-1">
<para>You must use the IP address, not the host name, of the VMware hypervisor.</para>
</callout>
</calloutlist>
</listitem>
<listitem>
<simpara>On each conversion host, verify the SSH connection by connecting to each VMware hypervisor as <literal>cloud-user</literal>:</simpara>
<screen># sudo -u cloud-user ssh root@<emphasis>esx1.example.com</emphasis></screen>
<simpara>If the connection fails, check that the VMware hypervisor has SSH access enabled and that you copied the correct keys.</simpara>
</listitem>
</orderedlist>
</section>
</section>
</appendix>
</part>
</book>