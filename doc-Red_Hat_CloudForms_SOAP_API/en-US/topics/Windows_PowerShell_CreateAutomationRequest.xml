<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "../Red_Hat_CloudForms_SOAP_API.ent">
%BOOK_ENTITIES;
]>
<section id="Windows_PowerShell_CreateAutomationRequest" remap="TID_14691">
	<title>Windows PowerShell: CreateAutomationRequest</title>
	<programlisting>
<![CDATA[
[System.Net.ServicePointManager]::ServerCertificateValidationCallback = { $true }
$ip = "https://evm_appl_address"
$userid, $password = "admin", "smartvm"
$cred = New-Object System.Management.Automation.PsCredential $userid, (convertto-securestring $password -asplaintext -force)

trap {Write-Host $Error[0]; break}

$Error.Clear()
Write-Host "Connecting to EVM integrate web-services at $($ip)/vmdbws/wsdl"
$miqvmdb = New-WebServiceProxy -uri "$($ip)/vmdbws/wsdl" -Credential $cred -ErrorAction Stop -Namespace VmdbWs
Write-Host "Successfully connected to EVM integrate web-services"

################
#
# Parameter1 - version
#
################
$version = "1.1"

################
#
# Parameter2 - uri_parts
#
################
$uri_parts = @()
$uri_parts += "namespace=Sample"
$uri_parts += "class=Methods"
$uri_parts += "instance=InspectME"
$uri_parts += "message=create"
$uri_parts = [string]::join("|", $uri_parts)

################
#
# Parameter3 - parameters
#
################ 
$parameters = @()
$parameters += "parm1=1"
$parameters += "parm2=2" 
$parameters = [string]::join("|", $parameters)

################
#
# Parameter4 - requester
#
################ 
$requester = @()
$requester += "owner_email=kmorey@redhat.com"
$requester += "user_name=admin"
$requester += "auto_approve=true"
$requester = [string]::join("|", $requester)

$result = $miqvmdb.CreateAutomationRequest($version, $uri_parts, $parameters, $requester)
Write-Host "CreateAutomationRequest ID:"  $result 

Write-Host "done"
]]>
</programlisting>
</section>