<?xml version='1.0' encoding='utf-8' ?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "Security_Guide.ent">
%BOOK_ENTITIES;
]>
<section id="chap-Red_Hat_CloudForms-Security_Guide-HBAC" lang="en-US">
  <title>Configuring Host-Based Access Control Rules on your IPA Server</title>
  <para>
    Red Hat CloudForms provides support for external authentication using an IPA server. However, there are certain recommendations to secure access to your appliance, such as creating a specific user group and host group that can access the appliance authentication service.
  </para>
  <para>
    Run the following steps on your IPA server.
  </para>
  <itemizedlist>
    <listitem>
      <para>
        Create a user group and restrict access to only the Red Hat CloudForms users
      </para>
      <screen>
[root@ipa ~]# ipa group-add cloudforms_users --desc="CloudForms Users"
[root@ipa ~]# ipa group-add-member cloudforms_users --users=testuser1,testuser2
      </screen>
    </listitem>
    <listitem>
      <para>
         Create a host group and restrict access to your appliance hosts:
      </para>
      <screen>
[root@ipa ~]# ipa hostgroup-add cloudforms_hosts --desc "CloudForms hosts"
[root@ipa ~]# ipa hostgroup-add-member cloudforms_hosts --hosts=appliance1.example.com,appliance2.example.com
      </screen>
    </listitem>
    <listitem>
      <para>
        Add rules to allow the host group and user group access to the Red Hat CloudForms HTTP service:
      </para>
      <screen>
[root@ipa ~]# ipa hbacrule-add cloudforms_access --srchostcat=all
[root@ipa ~]# ipa hbacrule-add-service cloudforms_access --hbacsvcs httpd-auth
[root@ipa ~]# ipa hbacrule-add-user cloudforms_access --groups cloudforms_users
[root@ipa ~]# ipa hbacrule-add-host cloudforms_access --hostgroups cloudforms_hosts
      </screen>
    </listitem>
    <listitem>
      <para>
        Remove the default rule on your IPA server to allow access to all:
      </para>
      <screen>
[root@ipa ~]# ipa hbacrule-disable allow_all
      </screen>
    </listitem>
  </itemizedlist>
  <para>
    This ensures only users in the <literal>cloudforms_users</literal> group can access the authentication service (<literal>http-auth</literal>) on the appliances in the <literal>cloudforms_hosts</literal> host group.
  </para>
</section>

