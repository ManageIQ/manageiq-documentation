<?xml version='1.0' encoding='utf-8' ?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "Security_Guide.ent">
%BOOK_ENTITIES;
]>
<section id="chap-Red_Hat_CloudForms-Security_Guide-SSL_Certs" lang="en-US">
	<title>Generating SSL Certificates for Your Appliance and Database</title>
  <para>
    It is important to enhance the security of SSL communication of your appliances, which, depending on your setup, may include your database appliance. The appliance image ships with a default SSL certificate. It is recommended to replace this certificate with your own certificate, either signed by a trusted Certificate Authority (CA) or self-signed.
  </para>
  <section id="Creating_a_Certificate_Signing_Request">
  <title>Creating a Certificate Signing Request</title>
  <para>The first step is to determine the host name of your appliance or database appliance by running the following command:</para>
  <screen>
$ hostname
  </screen>
  <para>
    The next step is to create a Certificate Signing Request (CSR) using the <command>openssl</command> command:
  </para>
  <screen>
[root@ ~]# openssl req -new -newkey rsa:2048 -out appliance.csr -keyout appliance.key
  </screen>
  <para>
    This command generates a 2048-bit RSA private key and asks for a passphrase for the key.
  </para>
  <screen>
Generating a 2048 bit RSA private key
..................+++
...........................+++
writing new private key to 'appliance.key'
Enter PEM pass phrase: **********
Verifying - Enter PEM pass phrase: **********
  </screen>
  <para>
    The command then provides a questionnaire requesting certain details for the key. Fill out this questionnaire. Use the output of the <command>hostname</command> command to specify the <literal>Common Name</literal>.
  </para>
  <para>For example:</para>
  <screen>
Country Name (2 letter code) [XX]:US
State or Province Name (full name) []:North Carolina
Locality Name (eg, city) [Default City]:Raleigh
Organization Name (eg, company) [Default Company Ltd]:CloudForms
Organizational Unit Name (eg, section) []:Customer Content Services
Common Name (eg, your name or your server's hostname) []:$(hostname)
Email Address []:example@example.com

Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []:
An optional company name []:
  </screen>
  <para>
    Running the command produces two files:
  </para>
  <itemizedlist>
    <listitem>
      <para>
        <filename>appliance.key</filename> - The private key
      </para>
    </listitem>
    <listitem>
      <para>
        <filename>appliance.csr</filename> - The Certificate Signing Request (CSR)
      </para>
    </listitem>
  </itemizedlist>
  <para>
    At this stage, you would send the CSR to a trusted Certificate Authority (CA) and in return they would send you a signed certificate.
  </para>
  </section>
  <section id="Creating_a_Self-signed_Certificate">
    <title>Creating a Self-signed Certificate</title>
  <para>
    As an alternative to obtaining a signed certificate, you can use the <filename>appliance.key</filename> and <filename>appliance.csr</filename> files to create a self-signed certificate by running the following <command>openssl</command> commands:
  </para>
  <screen>
[root@ ~]# openssl rsa -in appliance.key -out server.cer.key
[root@ ~]# openssl x509 -in appliance.csr -out server.cer -req -signkey server.cer.key -days 3650
  </screen>
  <para>
    This produces two files:
  </para>
  <itemizedlist>
    <listitem>
      <para>
        <filename>server.cer.key</filename> - The private key for your signed certificate
      </para>
    </listitem>
    <listitem>
      <para>
        <filename>server.cer</filename> - The self-signed certificate
      </para>
    </listitem>
  </itemizedlist>
  </section>
  <section id="Enabling_the_Appliance_to_Use_Your_Certificate">
    <title>Enabling Your Certificate</title>
  <para>
    Despite whether you used a trusted CA or self-signed the certificate, you should now have your own certificate for your appliance.
  </para>
  <para>
    Copy the certificate and key files to the certificate directory on the appliance:
  </para>
  <screen>
[root@ ~]# cp ~/server.cer.key /var/www/miq/vmdb/certs/server.cer.key
[root@ ~]# cp ~/server.cer /var/www/miq/vmdb/certs/server.cer
  </screen>
  <para>
    After the certificate and key files have been copied, restart the appliance:
  </para>
  <screen>
[root@ ~]# service evmserverd restart
  </screen>
  <para>
    The appliance now uses your own certificate.
  </para>
  <para>If your environment consists of multiple appliances connecting to a single database appliance, you can use your certificate and key files to set up SSL for the database connection. For more information, see <xref linkend="chap-Red_Hat_CloudForms-Security_Guide-Setting_SSL_for_the_Database_Appliance" />.</para>
  <important>
    <para>
      Updates from the Red Hat Content Delivery Network might overwrite these certificate and key files. Make sure to copy your own certificate and key files to the certificate directory after performing an update to your appliance.
    </para>
  </important>
  <note>
    <para>
      See also the following article for information on replacing SSL certificates in CloudForms Management Engine: <ulink url="https://access.redhat.com/articles/449033">https://access.redhat.com/articles/449033</ulink>.
    </para>
  </note>
  </section>
</section>

