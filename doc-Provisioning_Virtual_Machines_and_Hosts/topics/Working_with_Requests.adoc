[[working-with-requests]]
== Working with Requests

[[provisioning-request-approval-methods]]
=== Provisioning Request Approval Methods

In this chapter, you will learn about the different approval methods. The request can be approved manually in the {product-title} console, set for automatic approval by setting options in the *Automate Explorer*, or by using an external method.
image:2348.png[]
When using an external method, the approval actually takes place on the external system and is sent directly for execution. This chapter discusses how to view and edit requests in the {product-title} Console, how to approve a request, and how to set automatic approval parameters.

[[working-with-provisioning-requests]]
=== Working with Provisioning Requests

After a provisioning request is sent, if you have proper authority, you can copy, edit, delete, approve, or deny a request.

After submission, the appliance assigns each provision request a *Request ID*. If an error occurs during the approval or provisioning process, use this ID to locate the request in the appliance logs. The *Request ID* consists of the region associated with the request followed by the request number. As regions define a range of one trillion database IDs, this number can be several digits long.

*Request ID Format*

*Request 99* in *region 123* results in *Request ID 123000000000099*.

[[reloading-the-status-of-provisioning-requests]]
==== Reloading the Status of Provisioning Requests

. Navigate to menu:Services[Requests].
. Click image:2106.png[](*Reload the current display*).

[[approving-a-provisioning-request]]
==== Approving a Provisioning Request

After a user creates provisioning request, administrators have the ability to approve the request and allow {product-title} to complete virtual machine or instance creation.

. Navigate to menu:Services[Requests].
. Click on the request you want to approve.
. Type in a *Reason* for the approval.
. Click image:1852.png[](*Approve this request*).

[[denying-a-provisioning-request]]
==== Denying a Provisioning Request

. Navigate to menu:Services[Requests].
. Click on the request you want to deny.
. Type in a *Reason* for the denial.
. Click image:2009.png[](*Deny this request*).

[[copying-a-provisioning-request]]
==== Copying a Provisioning Request

. Navigate to menu:Services[Requests].
. Click on the request you want to copy.
. Click image:1859.png[](*Copy original provision request*).
. Make changes to the request.
. Click *Submit*.
[NOTE]
====
If the logged in user is not same as the requester or the request has been already approved or denied, you cannot edit or delete the request.
====

[[editing-a-provisioning-request]]
==== Editing a Provisioning Request

. Navigate to menu:Services[Requests].
. Click on the request you want to edit.
. Click image:1851.png[](*Edit the original provision request*).
. Make changes to the request.
. Click *Submit*.

[[deleting-a-provisioning-request]]
==== Deleting a Provisioning Request

. Navigate to menu:Services[Requests].
. Click on the request you want to delete.
. Click image:1861.png[](*Delete this request*).
. Click *OK* to confirm.

[[automatically-approving-requests]]
==== Automatically Approving Requests

You can set thresholds for automatic approval of provisioning requests and, therefore, remove the requirement to manually approve the request. You can do this either as a global default or on a per template basis.

[[enabling-global-defaults-for-automatic-approval]]
===== Enabling Global Defaults for Automatic Approval

To enable a global set of default approval values, edit the defaults instance by navigating to menu:Automate[Explorer], then menu:DOMAIN[Cloud|Infrastructure > VM > Provisioning > StateMachines > ProvisionRequestApproval] in the accordion menu. The parameters in this instance are used by the methods in that same class. By default, the maximum number of virtual machines or instances that can be automatically approved for provisioning is 1. To skip the check for the maximum number of virtual machines, set this field to 0. Set this field to -1 to force manual approval. At a minimum, you must change this parameter for all others to be validated.

. Navigate to menu:Automate[Explorer],.
. From the tree in the accordion menu, select menu:DOMAIN[Cloud > VM > Provisioning > StateMachines > ProvisionRequestApproval Class].
+
[NOTE]
====
DOMAIN must be a user-defined Domain and not the locked ManageIQ Domain. If necessary, you can copy the class from the ManageIQ domain into a custom domain.

This example uses the *Cloud* Namespace but can also use the *Infrastructure* namespace.
====
+
. Click image:1847.png[](*Configuration*), then image:1851.png[](*Edit this instance*).
image:6280.png[]
+
[NOTE]
====
Do not change any values other than those listed below. Doing so may prevent the automatic approval process from running.
====
+
* Use *max_cpus* to set the number of CPUs allowed to approve automatically the provisioning request.
* Use *max_vms* to set the maximum number of virtual machines or instances that are allowed to be provisioned automatically approve the request. If this is set to blank, no requests will be automatically approved.
* Use *max_memory* to set the maximum memory allowed to approve automatically the provisioning request.
* Use *max_retirement_days* to set the maximum number of days until the virtual machine or instance is retired to automatically approve this request.
* If a value is blank or *0*, the parameter is ignored.
. Click *Save*.

The thresholds for automatic approval are set. The next time a provision request is created these thresholds will be checked. If the requirements are met, the provisioning request will be approved with no user intervention.

[[template-specific-approval-defaults]]
===== Template Specific Approval Defaults

{product-title} provides tags that can be used to set default automatic approval values on a per template or image basis. These values *supersede* those in the *Automate* model. Use these tags to eliminate the need for manual approval for all provisioning requests. To enable automatic approval, assign the tags directly to templates or images.

[width="100%",cols="40%,60%",options="header",]
|====
|Category Display Name (Name)|Use (Sample values)
|Auto Approve Max CPU (prov_max_cpus)|Sets the maximum number of CPUs that can be automatically approved in a single provisioning request. (Sample Values: 1, 2, 3, 4, 5)
|Auto Approve Max Memory (prov_max_memory)|Sets the maximum number of memory that can be automatically approved in a single provisioning request. Sample Values: 1, 2, 4, 8 (in GB)
|Auto Approve Max Retirement Days (prov_max_retirement_days)|Sets the maximum number of days until retirement that can be automatically approved in a single provisioning request. Sample Values: 30, 60, 90, 180 (in days)
|Auto Approve Max VM (prov_max_vms)|Sets the maximum number of virtual machines or instances that can be automatically approved in a single provisioning request. Sample Values: 1, 2, 3, 4, 5
|====

[[assigning-tags-to-a-template-for-auto-approval]]
===== Assigning Tags to a Template for Auto Approval

. Navigate to menu:Compute[Infrastructure > Virtual Machines].
. Click the *Templates* accordion, and select the templates that you want to tag.
. Click image:1941.png[](*Policy*), and then image:1851.png[](*Edit Tags*).
. Select a customer tag from the first dropdown, and then a value for the tag.

The thresholds for automatic approval for a specific template are set. The next time a provision request is created for this template these thresholds will be checked. If the requirements are met, the provisioning request will be approved with no user intervention.

[[setting-provisioning-notification-email-addresses]]
===== Setting Provisioning Notification Email Addresses

{product-title} contains a set of Automate instances for provisioning. These Automate instances also include email fields to set the sender and recipient of provisioning notifications, such as requests. These fields are set to *evmadmin@company.com* as a default.

. Navigate to menu:Automate[Explorer].
. Choose the following Namespace: menu:DOMAIN[Cloud > VM > Provisioning > Email].
+
[NOTE]
====
*DOMAIN* must be a user-defined Domain and not the locked ManageIQ Domain. If necessary, you can copy the class from the ManageIQ domain into a custom domain.

This example uses the *Cloud* Namespace, but can also use the *Infrastructure* namespace.
====
+
. Select an instance within the chosen class.
. Click image:1847.png[](*Configuration*), then image:1851.png[](*Edit this instance*).
. Type the desired email addresses in the *to_email_address* and *from_email_address* fields.
. Click *Save*.
+
image:6282.png[]






