<?xml version='1.0' encoding='utf-8' ?>
<!DOCTYPE book [
<!ENTITY % BOOK_ENTITIES SYSTEM "master.ent">
%BOOK_ENTITIES;
<!ENTITY % sgml.features "IGNORE">
<!ENTITY % xml.features "INCLUDE">
<!ENTITY % DOCBOOK_ENTS PUBLIC "-//OASIS//ENTITIES DocBook Character Entities V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/dbcentx.mod">
%DOCBOOK_ENTS;
]>
<book version="5.0" xml:lang="en-US" xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">
	<?asciidoc-toc maxdepth="3"?>
	<info>
		<title>Integration with ServiceNow</title>
		<subtitle>A short guide to managing CloudForms ServiceNow CMDB integration</subtitle>
		 <date>2015-10-16</date>
		<xi:include href="Author_Group.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
		<authorinitials>CDT</authorinitials><productname>Red Hat CloudForms</productname>
		<productnumber>4.0</productnumber>
		<abstract>
			<para>
				This guide provides instructions for using the CloudForms Management Engine features relevant to non-administrative users. It establishes basic system and operational concepts through task based scenarios and examples.
			</para>
		</abstract>

	</info>
	<chapter xml:id="Overview">
		<title>Overview</title>
		<simpara>
			Red Hat CloudForms' integration with ServiceNow enables authentication with an existing ServiceNow database and add/amend items in the ServiceNow database during state machine processing, for example, the VM provision state machine. Note that information in this guide assumes you have credentials and access to a ServiceNow database instance.
		</simpara>
		<simpara>
			The following new namespace and class delivers support for the management of ServiceNow Configuration Management Database (CMDB) records using ServiceNow’s RESTful web service.
		</simpara>
		
<screen>/RedHat/Integration/ServiceNow/CMDB</screen>
		<simpara>
			You can manage records in the CMDB_CI_SERVER table, including create, update, and/or delete. The following methods are included:
		</simpara>
		<section xml:id="cmdb_ci_server">
			<title>CMDB_CI_SERVER</title>
			<informaltable colsep="1" frame="all" rowsep="1">
				<?dbhtml table-width="50%"?><?dbfo table-width="50%"?><?dblatex table-width="50%"?>
				<tgroup cols="3">
					<colspec colname="col_1" colwidth="70*"></colspec>
					<colspec colname="col_2" colwidth="70*"></colspec>
					<colspec colname="col_3" colwidth="70*"></colspec>
					<thead>
						<row>
							<entry align="left" valign="top">Method</entry>
							<entry align="left" valign="top">Action</entry>
							<entry align="left" valign="top"></entry>
						</row>
					</thead>
					<tbody>
						<row>
							<entry align="left" valign="top">
							<simpara>
								create
							</simpara>
							</entry>
							<entry align="left" valign="top">
							<simpara>
								Create record in specified ServiceNow table.
							</simpara>
							</entry>
							<entry align="left" valign="top"></entry>
						</row>
						<row>
							<entry align="left" valign="top">
							<simpara>
								delete
							</simpara>
							</entry>
							<entry align="left" valign="top">
							<simpara>
								Delete record in specified ServiceNow table.
							</simpara>
							</entry>
							<entry align="left" valign="top"></entry>
						</row>
						<row>
							<entry align="left" valign="top">
							<simpara>
								get
							</simpara>
							</entry>
							<entry align="left" valign="top">
							<simpara>
								Get record from specified ServiceNow table and list its attributes.
							</simpara>
							</entry>
							<entry align="left" valign="top"></entry>
						</row>
						<row>
							<entry align="left" valign="top">
							<simpara>
								get_all
							</simpara>
							</entry>
							<entry align="left" valign="top">
							<simpara>
								Get all records in ServiceNow and list attributes.
							</simpara>
							</entry>
							<entry align="left" valign="top"></entry>
						</row>
						<row>
							<entry align="left" valign="top">
							<simpara>
								update
							</simpara>
							</entry>
							<entry align="left" valign="top">
							<simpara>
								Get specified record, update required attributes and post updated record.
							</simpara>
							</entry>
							<entry align="left" valign="top"></entry>
						</row>
						<row>
							<entry align="left" valign="top">
							<simpara>
								update_patch
							</simpara>
							</entry>
							<entry align="left" valign="top">
							<simpara>
								Post required attributes to specified record.
							</simpara>
							</entry>
							<entry align="left" valign="top">
							<simpara>
								+ [Note] ======= Configuration item (CI) and record are used interchangeably and refer to items in a ServiceNow database table. ======= +
							</simpara>
							<simpara>
								<anchor xml:id="Managing_Record_Attributes" xreflabel="[Managing_Record_Attributes]"></anchor> == Managing Record Attributes
							</simpara>
							<simpara>
								You can specify any attribute via the <literal>URI</literal> or <literal>CMDB</literal> class instance. If neither exists, the value is determined from the CloudForms <literal>VM</literal> or <literal>miq_provision</literal> objects.
							</simpara>
							<simpara>
								The attributes can be reduced or extended as required by amending the Ruby methods.
							</simpara>
							<simpara>
								+ [Note] ======= Some attributes are not free-text (variable) fields, that is, they must be specific values. For example, Vendor value must already exist in the ServiceNow Vendor table beforehand. =======
							</simpara>
							<simpara>
								=== Create and Update (_patch) Record You can use the following attributes when creating and/or updating a record.
							</simpara>
							<simpara>
								==== Attribute [width="50%"]
							</simpara>
							</entry>
						</row>
					</tbody>
				</tgroup>
			</informaltable>
			<simpara>
				|Attribute |Value |
			</simpara>
			<simpara>
				|virtual |Boolean true or false, set to true. |
			</simpara>
			<simpara>
				|name VM’s |Virtual Infrastructure name. |
			</simpara>
			<simpara>
				|short_description |CloudForms VM GUID. |
			</simpara>
			<simpara>
				|host_name |VM’s Operating System hostname. |
			</simpara>
			<simpara>
				|cpu_count |VM’s CPU count. |
			</simpara>
			<simpara>
				|ram |VM’s memory. |
			</simpara>
			<simpara>
				|vendor |VM’s hardware vendor (provider). |
			</simpara>
			<simpara>
				|sys_id <footnote xml:id="a">
				<simpara>
					sys_id attribute is not required during create. Its value is returned from create request and the CloudForms object custom attribute servicenow_sys_id is created and updated.
				</simpara>
				</footnote> |ServiceNow record unique system ID. |=================================================== |
			</simpara>
		</section>
		<section xml:id="get_and_delete_record">
			<title>Get and Delete Record</title>
			<simpara>
				You can use the following attribute for getting or deleting a record.
			</simpara>
			<itemizedlist>
				<listitem>
					<simpara>
						Attribute
					</simpara>
				</listitem>
				<listitem>
					<simpara>
						Value
					</simpara>
				</listitem>
				<listitem>
					<simpara>
						sys_id
					</simpara>
				</listitem>
			</itemizedlist>
			<simpara>
				ServiceNow record unique system ID.
			</simpara>
		</section>
		<section xml:id="get_all_records">
			<title>Get All Records</title>
			<simpara>
				There are no attributes required to get all records. Method gets all records in the specified ServiceNow table and writes their attributes to automation.log.
			</simpara>
		</section>
	</chapter>
	<chapter xml:id="Configuring_ServiceNow_Connection">
		<title>Configuring ServiceNow Connection</title>
		<simpara>
			Configure the connection to the ServiceNow database by specifying the credentials in the CMDB schema or instances within.
		</simpara>
		<simpara>
			The following methods are included:
		</simpara>
		<section xml:id="attribute">
			<title>Attribute</title>
			<informaltable colsep="1" frame="all" rowsep="1">
				<?dbhtml table-width="50%"?><?dbfo table-width="50%"?><?dblatex table-width="50%"?>
				<tgroup cols="3">
					<colspec colname="col_1" colwidth="70*"></colspec>
					<colspec colname="col_2" colwidth="70*"></colspec>
					<colspec colname="col_3" colwidth="70*"></colspec>
					<thead>
						<row>
							<entry align="left" valign="top">snow_server</entry>
							<entry align="left" valign="top">ServiceNow database IP address or resolvable hostname.</entry>
							<entry align="left" valign="top"></entry>
						</row>
					</thead>
					<tbody>
						<row>
							<entry align="left" valign="top">
							<simpara>
								snow_user
							</simpara>
							</entry>
							<entry align="left" valign="top">
							<simpara>
								ServiceNow user account with the necessary permissions.
							</simpara>
							</entry>
							<entry align="left" valign="top"></entry>
						</row>
						<row>
							<entry align="left" valign="top">
							<simpara>
								snow_password
							</simpara>
							</entry>
							<entry align="left" valign="top">
							<simpara>
								Associated user account password.
							</simpara>
							</entry>
							<entry align="left" valign="top"></entry>
						</row>
						<row>
							<entry align="left" valign="top">
							<simpara>
								table_name
							</simpara>
							</entry>
							<entry align="left" valign="top">
							<simpara>
								ServiceNow cmdb_ci_server database table.
							</simpara>
							</entry>
							<entry align="left" valign="top">
							<simpara>
								The table name cannot be changed unless there is a specific requirement to manage records elsewhere. Entries in this table appear in the Configuration → Base Items → Servers menu in the ServiceNow web user interface.
							</simpara>
							<simpara>
							</simpara>
							<simpara>
								<anchor xml:id="Use_Cases" xreflabel="[Use_Cases]"></anchor> == Use Cases
							</simpara>
							<simpara>
								See the following use case examples of how ServiceNow can be integrated with automation workflow.
							</simpara>
							<simpara>
								=== Provision VM from Template The Cloud and Infrastructure Provision VM from Template state machines contain RegisterCMDB and ActivateCMDB states.
							</simpara>
							<simpara>
								To create a new ServiceNow record during VM provisioning, amend the ActiveCMDB state to call the create method, for example: ------- /Integration/ServiceNow/CMDB/create ------- 
								<inlinemediaobject>
									<imageobject>
										<imagedata fileref="images/6667.png" format="PNG" />
									</imageobject>
									<textobject>
										<phrase>StateActiveCMDBActiveCMDBstate</phrase>
									</textobject>
								</inlinemediaobject>
							</simpara>
							<simpara>
								=== VM Retirement
							</simpara>
							<simpara>
								The Cloud and Infrastructure Default retirement state machines contain DeactivateCMDB and RemoveFromCMDB states.
							</simpara>
							<simpara>
								To update a VM ServiceNow record during VM retirement, amend the DeactivateCMDB state to call the update_patch method, for example: ------- Integration/ServiceNow/CMDB/update_patch?description=VM%20${/#vm.guid}%20retired%20from%20CloudForms ------- 
								<inlinemediaobject>
									<imageobject>
										<imagedata fileref="images/6668.png" format="PNG" />
									</imageobject>
									<textobject>
										<phrase>StateActiveCMDBDeactiveCMDBstate</phrase>
									</textobject>
								</inlinemediaobject>
							</simpara>
							<simpara>
							</simpara>
							<simpara>
								To delete a VM ServiceNow record during VM retirement, amend the RemoveFromCMDB state to call the delete method, for example: ------- /Integration/ServiceNow/CMDB/delete ------- 
								<inlinemediaobject>
									<imageobject>
										<imagedata fileref="images/6669.png" format="PNG" />
									</imageobject>
									<textobject>
										<phrase>StateRemoveFromCMDBRemovefromCMDBstate</phrase>
									</textobject>
								</inlinemediaobject>
							</simpara>
							<simpara>
							</simpara>
							<simpara>
								=== VM Reconfiguration (VMware Only)
							</simpara>
							<simpara>
								Create a new System Event instance to update the ServiceNow record after a VM reconfiguration request has been approved and completed.
							</simpara>
							<simpara>
								Create a new /System/Event/ReconfigVM_Task_Complete instance with a relationship value: ------- /Integration/ServiceNow/CMDB/update_patch ------- 
								<inlinemediaobject>
									<imageobject>
										<imagedata fileref="images/6670.png" format="PNG" />
									</imageobject>
									<textobject>
										<phrase>ReconfigVMTaskComplete</phrase>
									</textobject>
								</inlinemediaobject>
							</simpara>
							</entry>
						</row>
					</tbody>
				</tgroup>
			</informaltable>
		</section>
	</chapter>
</book>

