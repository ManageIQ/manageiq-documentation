<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "../Insight_Guide.ent">
%BOOK_ENTITIES;
]>
<section id="Notes_on_Capacity_and_Utilization_Collection_for_RHEVM_3.1" remap="TID_15401">
	<title>Data Collection for Red Hat Enterprise Virtualization 3.1 and 3.2</title>
	<para>
		To collect capacity and utilization data for Red Hat Enterprise Virtualization 3.1 and 3.2, you must add CloudForms Management Engine as a user to the RHEV-M database.
	</para>
	<para>
		Perform this procedure on the PostgreSQL server where the history database is located. Usually, this is the RHEV-M server.
	</para>
	<procedure>
		<step>
			<para>
				Using SSH, access the RHEV-M database server as the root user:
			</para>
			<screen>$ ssh root@example.postgres.server</screen>
		</step>
		<step>
			<para>
				Access the database prompt:
			</para>
			<screen># psql -U postgres</screen>
		</step>
		<step>
			<para>
				Create a new user for the CloudForms Management Engine:
			</para>
			<screen>postgres=# CREATE ROLE newuser LOGIN UNENCRYPTED PASSWORD 'newuserpassword' SUPERUSER VALID UNTIL 'infinity'</screen>
		</step>
		<step>
			<para>
				Exit to the RHEV-M database server prompt:
			</para>
			<screen>postgres=# \q</screen>
		</step>
		<step>
			<para>
				Update the server's firewall to accept TCP communication on port 5432:
			</para>
			<screen># iptables -I INPUT -p tcp -m tcp --dport 5432 -j ACCEPT
# service iptables save</screen>
		</step>
		<step>
			<para>
				Enable external md5 authentication by appending the following line to <filename>/var/lib/pgsql/data/pg_hba.conf</filename>:
			</para>
			<screen>host    all      all    0.0.0.0/0     md5 </screen>
		</step>
		<step>
			<para>
				Enable PostgreSQL to listen for remote connections by updating the <literal>listen_address</literal> line in <filename>/var/lib/pgsql/data/postgresql.conf</filename>:
			</para>
			<screen>listen_addresses  =  '*'</screen>
		</step>
		<step>
			<para>
				Reload the PostgreSQL configuration:
			</para>
			<screen>service postgresql reload</screen>
		</step>
	</procedure>
</section>