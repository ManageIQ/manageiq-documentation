= Adding OpenStack Providers

// see topics/Adding_an_OpenStack_Infrastructure_Provider.adoc for singlesourcable

{product-title} supports operating with the OpenStack `admin` tenant.
When creating an OpenStack provider in {product-title}, select the OpenStack provider's `admin` user because it is the default administrator of the OpenStack `admin` tenant.
When using the `admin` credentials, a user in {product-title} provisions into the `admin` tenant, and sees images, networks, and instances that are associated with the `admin` tenant.

[NOTE]
=====
You can set whether {product-title} should use the Telemetry service or Advanced Message Queueing Protocol (AMQP) for event monitoring. If you choose Telemetry, you should first configure the *ceilometer* service on the overcloud to store events. See xref:openstack-events-oc[] for instructions.

For more information, see https://access.redhat.com/documentation/en/red-hat-openstack-platform/8/architecture-guide/chapter-1-components#comp-telemetry[OpenStack Telemetry (ceilometer)] in the Red Hat OpenStack Platform _Architecture Guide_.
=====

. Navigate to menu:Compute[Clouds > Providers].

. Click  image:1847.png[] (*Configuration*), then click  image:1848.png[] (*Add a New Cloud Provider*).

. Enter a *Name* for the provider.

. From the *Type* drop down menu select *OpenStack*.

. Select the appropriate *API Version* from the list. The default is `Keystone v2`.
+
If you select `Keystone v3`, enter the `Keystone V3 Domain ID` that {product-title} should use. This is the domain of the user account you will be specifying later in the *Default* tab. If domains are not configured in the provider, enter *default*.
+
NOTE: With Keystone API v3, domains are used to determine administrative boundaries of service entities in OpenStack. Domains allow you to group users together for various purposes, such as setting domain-specific configuration or security options. For more information, see https://access.redhat.com/documentation/en/red-hat-openstack-platform/8/architecture-guide/chapter-1-components#comp-identity[OpenStack Identity (keystone)] in the Red Hat OpenStack Platform _Architecture Guide_.

. Select the appropriate *Zone* for the provider. By default, the zone is set to *default*.
+
NOTE: For more information, see the definition of host aggregates and availability zones in  https://access.redhat.com/documentation/en/red-hat-openstack-platform/8/architecture-guide/chapter-1-components#comp-compute[OpenStack Compute (nova)] in the Red Hat OpenStack Platform _Architecture Guide_.

. In the *Default* tab, under *Endpoints*, configure the host and authentication details of your OpenStack provider:
.. In *Hostname (or IPv4 or IPv6 address)*, enter the public IP or fully qualified domain name of the OpenStack Keystone service. 
+
NOTE: The hostname required here is also the *OS_AUTH_URL* value in the *~/overcloudrc* file generated by the director (see https://access.redhat.com/documentation/en/red-hat-openstack-platform/8/single/director-installation-and-usage/#sect-Accessing_the_Overcloud[Accessing the Overcloud] in Red Hat OpenStack Platform _Director Installation and Usage_ or the *~/keystonerc_admin* file generated by Packstack (see https://access.redhat.com/articles/1127153[Evaluating OpenStack: Single-Node Deployment]).
.. In *API Port*, set the public port used by the OpenStack Keystone service. By default, OpenStack uses port 5000 for this.
.. Select the appropriate *Security Protocol* used for authenticating with your OpenStack provider.
.. In the *Username* field, enter the name of an OpenStack user with privileged access (for example, *admin*). Then, provide its corresponding password in the *Password* and *Confirm Password* fields.
.. Click *Validate* to confirm {product-title} can connect to the OpenStack provider.

. Next, configure how {product-title} should receive events from the OpenStack provider. Click the *Events* tab in the *Endpoints* section to start.
* To use the Telemetry service of the OpenStack provider, select *Ceilometer*. Before you do so, the provider must first be configured accordingly. See xref:openstack-events-oc[] for details.
* If you prefer to use the AMQP Messaging bus instead, select *AMQP*. When you do:
 In *Hostname (or IPv4 or IPv6 address)* (of the *Events* tab, under *Endpoints*), enter the public IP or fully qualified domain name of the AMQP host.
** In the *API Port*, set the public port used by AMQP. By default, OpenStack uses port 5672 for this.
** In the *Username* field, enter the name of an OpenStack user with privileged access (for example, *admin*). Then, provide its corresponding password in the *Password* and *Confirm Password* fields.
** Click *Validate* to confirm the credentials.

. Click *Add* after configuring the cloud provider.

[NOTE]
====
To collect inventory and metrics from an OpenStack environment, the {product-title} appliance requires that the adminURL endpoint for the OpenStack environment should be on a non-private network.
Hence, the OpenStack adminURL endpoint should be assigned an IP address other than `192.168.x.x`. Additionally, all the Keystone endpoints must be accessible, otherwise refresh will fail.
====


[[openstack-events-oc]]
== Configuring the Overcloud to Store Events

By default, the Telemetry service does not store events emitted by other services in a Red Hat OpenStack Platform environment. The following procedure outlines how to enable the Telemetry service on your OpenStack cloud provider to store such events. This ensures that events are exposed to {product-title} when a Red Hat OpenStack Platform environment is added as a cloud provider.

// . On the director node, edit _undercloud.conf_, and set _store_events_ to _true_.
. Log in to the undercloud host.
. Create an environment file called _ceilometer.yaml_, and add the following contents:
+
------
parameter_defaults:
  CeilometerStoreEvents: true
------
+
. Add the environment file to the _overcloud deploy_ command:
+
------
# openstack overcloud deploy --templates -e ~/ceilometer.yaml
------

If your OpenStack cloud provider was not deployed through the undercloud, you can also set this manually. To do so:

. Log in to your Controller node.
. Edit _/etc/ceilometer/ceilometer.conf_, and specify the following option:
+
------
store_events = True
------
+
. Edit _/etc/heat/heat.conf_, and specify the following options:
+
------
notification_driver=glance.openstack.common.notifier.rpc_notifier
notification_topics=notifications
------
+
. Edit _/etc/nova/nova.conf_, and specify the following options:
+
------
notification_driver=messaging
notification_topics=notifications
------
+
. Restart the Compute service and Orchestration services:
+
------
# systemctl restart openstack-heat-api.service \
  openstack-heat-api-cfn.service \
  openstack-heat-engine.service \
  openstack-heat-api-cloudwatch.service
# systemctl restart openstack-nova-compute.service
------











